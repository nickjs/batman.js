(function(t){function r(n){if(e[n])return e[n].exports;var o=e[n]={exports:{},id:n,loaded:!1};return t[n].call(o.exports,o,o.exports,r),o.loaded=!0,o.exports}var e={};return r.m=t,r.c=e,r.p="dist/",r(0)})([function(t,e,r){var n,o,i,s,a,u,c,p,l,h,f;u=r(1),p=r(2),c=r(3),a=r(4),l=r(5),i=r(6),s=function(){return function(t,e,r){r.prototype=t.prototype;var n=new r,o=t.apply(n,e);return Object(o)===o?o:n}(u.BatmanObject,arguments,function(){})},u.mixin(s,u,p,{Object:u.BatmanObject,Event:u.BatmanEvent},c,c.Translate,a,l,i),s.redirect=function(t,e){var r;return null==e&&(e=!1),null!=(r=s.navigator)?r.redirect(t,e):void 0},(s.container=function(){return this}()).Batman=s,s.developer.addFilters(),n=[],o=function(){return s}.apply(null,n),!(void 0!==o&&(t.exports=o)),null==(h=s.container).$context&&(h.$context=function(t){for(var e;t;){if(e=s._data(t,"backingView")||s._data(t,"view"))return e;t=t.parentNode}}),null==(f=s.container).$subviews&&(f.$subviews=function(t){var e;return null==t&&(t=s.currentApp.layout),e=[],t.subviews.forEach(function(t){var r,n;return r=s.mixin({},t),r.constructor=t.constructor,r.subviews=(null!=(n=t.subviews)?n.length:void 0)?$subviews(t):null,s.unmixin(r,{_batman:!0}),e.push(r)}),e}),s.config={pathToApp:"/",usePushState:!0,pathToHTML:"html",fetchRemoteHTML:!0,cacheViews:!1,minificationErrors:!0,protectFromCSRF:!1},window.zest=r(7),window.reqwest=r(8),r(9),r(10),t.exports=s},function(t,e,r){var n,o;o=r(89),n={BatmanEvent:r(92),EventEmitter:r(93),Property:r(94),Keypath:r(95),Observable:r(96),BatmanObject:r(97),TerminalAccessible:r(98),Accessible:r(99),Proxy:r(100),Enumerable:r(90),SimpleHash:r(101),Hash:r(102),SimpleSet:r(103),Set:r(104),SetProxy:r(105),SetObserver:r(106),SetSort:r(107),SetIndex:r(108),UniqueSetIndex:r(109),SetMapping:r(110),SetIntersection:r(111),SetComplement:r(112),SetUnion:r(113),developer:r(91)},o.extend(n,o),t.exports=n},function(t,e,r){var n,o;n=r(14),t.exports=o={Inflector:r(15),helpers:r(16),URI:r(17),StateMachine:r(18),DelegatingStateMachine:r(19),Request:r(20),LifecycleEvents:r(21),setImmediate:n.setImmediate,clearImmediate:n.clearImmediate}},function(t,e,r){var n;n={Association:r(25),SingularAssociation:r(26),BelongsToAssociation:r(27),PolymorphicBelongsToAssociation:r(28),HasOneAssociation:r(29),PluralAssociation:r(30),HasManyAssociation:r(31),PolymorphicHasManyAssociation:r(32),AssociationSet:r(33),PolymorphicAssociationSet:r(34),AssociationSetIndex:r(35),PolymorphicAssociationSetIndex:r(36),UniqueAssociationSetIndex:r(37),UniquePolymorphicAssociationSetIndex:r(38),AssociationProxy:r(39),BelongsToProxy:r(40),PolymorphicBelongsToProxy:r(41),HasOneProxy:r(42),AssociationCurator:r(43),StorageAdapter:r(44),LocalStorage:r(45),SessionStorage:r(46),RestStorage:r(47),Transaction:r(48),TransactionAssociationSet:r(49),ValidationError:r(50),ErrorsSet:r(51),Validator:r(52),Validators:r(53),AssociatedFieldValidator:r(54),AssociatedValidator:r(55),ConfirmationValidator:r(56),EmailValidator:r(57),ExclusionValidator:r(58),InclusionValidator:r(59),LengthValidator:r(60),NumericValidator:r(61),PresenceValidator:r(62),RegExpValidator:r(63),ErrorMessages:r(64),Encoders:r(22),Model:r(23),Translate:r(24)},t.exports=n},function(t,e,r){var n,o,i,s;n={Controller:r(84),ControllerActionFrame:r(85),RenderCache:r(86)},o=r(87);for(i in o)s=o[i],n[i]=s;t.exports=n},function(t,e,r){var n,o,i,s,a,u,c,p,l,h,f,d={}.hasOwnProperty;o=r(76),o.events=r(77),o.Yield=r(78),o.readers=r(79),o.attrReaders=r(80),o.AttrReaderBindingDefinition=r(81),o.ReaderBindingDefinition=r(82),n=r(65);for(u in n)d.call(n,u)&&(l=n[u],o[u]=l);for(a={BindingParser:r(66),DOM:o,Filters:r(67),View:r(68),BackingView:r(69),SelectView:r(70),IterationView:r(71),IteratorView:r(72),HTMLStore:r(73),Tracking:r(74)},s=r(75),i=r(83),p=[s,i],h=0,f=p.length;f>h;h++){c=p[h];for(u in c)d.call(c,u)&&(l=c[u],a[u]=l)}t.exports=a},function(t,e,r){var n;n={App:r(88)},t.exports=n},function(t,e){(function(e){(function(){var e=this,r=this.document,n=this.zest,o=function(){return r.compareDocumentPosition?function(t,e){return t.compareDocumentPosition(e)}:function(t,e){for(var r=t.ownerDocument.getElementsByTagName("*"),n=r.length;n--;){if(r[n]===t)return 2;if(r[n]===e)return 4}return 1}}(),i=function(t,e){return 2&o(t,e)?1:-1},s=function(t){for(;(t=t.nextSibling)&&1!==t.nodeType;);return t},a=function(t){for(;(t=t.previousSibling)&&1!==t.nodeType;);return t},u=function(t){if(t=t.firstChild)for(;1!==t.nodeType&&(t=t.nextSibling););return t},c=function(t){if(t=t.lastChild)for(;1!==t.nodeType&&(t=t.previousSibling););return t},p=function(t){if(!t)return t;var e=t[0];return'"'===e||"'"===e?t.slice(1,-1):t},l=function(){return Array.prototype.indexOf?Array.prototype.indexOf:function(t,e){for(var r=this.length;r--;)if(this[r]===e)return r;return-1}}(),h=function(t,e){var r=b.inside.source.replace(/</g,t).replace(/>/g,e);return RegExp(r)},f=function(t,e,r){return t=t.source,t=t.replace(e,r.source||r),RegExp(t)},d=function(t,e){return t.replace(/^(?:\w+:\/\/|\/+)/,"").replace(/(?:\/+|\/*#.*?)$/,"").split("/",e).join("/")},y=function(t){var r,t=t.replace(/\s+/g,"");return"even"===t?t="2n+0":"odd"===t?t="2n+1":~t.indexOf("n")||(t="0n"+t),r=/^([+-])?(\d+)?n([+-])?(\d+)?$/.exec(t),{group:"-"===r[1]?-(r[2]||1):+(r[2]||1),offset:r[4]?"-"===r[3]?-r[4]:+r[4]:0}},m=function(t,e,r){var t=y(t),n=t.group,o=t.offset,i=r?c:u,p=r?a:s;return function(t){if(1===t.parentNode.nodeType)for(var r=i(t.parentNode),s=0;r;){if(e(r,t)&&s++,r===t)return s-=o,n&&s?!(s%n)&&0>s==0>n:!s;r=p(r)}}},g={"*":function(){return function(){var t=r.createElement("div");return t.appendChild(r.createComment("")),!!t.getElementsByTagName("*")[0]}()?function(t){return 1===t.nodeType?!0:void 0}:function(){return!0}}(),type:function(t){return t=t.toLowerCase(),function(e){return e.nodeName.toLowerCase()===t}},attr:function(t,e,r,n){return e=v[e],function(o){var i;switch(t){case"for":i=o.htmlFor;break;case"class":i=o.className,""===i&&null==o.getAttribute("class")&&(i=null);break;case"href":i=o.getAttribute("href",2);break;case"title":i=o.getAttribute("title")||null;break;case"id":if(o.getAttribute){i=o.getAttribute("id");break}default:i=null!=o[t]?o[t]:o.getAttribute&&o.getAttribute(t)}if(null!=i)return i+="",n&&(i=i.toLowerCase(),r=r.toLowerCase()),e(i,r)}},":first-child":function(t){return!a(t)&&1===t.parentNode.nodeType},":last-child":function(t){return!s(t)&&1===t.parentNode.nodeType},":only-child":function(t){return!a(t)&&!s(t)&&1===t.parentNode.nodeType},":nth-child":function(t,e){return m(t,function(){return!0},e)},":nth-last-child":function(t){return g[":nth-child"](t,!0)},":root":function(t){return t.ownerDocument.documentElement===t},":empty":function(t){return!t.firstChild},":not":function(t){var e=E(t);return function(t){return!e(t)}},":first-of-type":function(t){if(1===t.parentNode.nodeType){for(var e=t.nodeName;t=a(t);)if(t.nodeName===e)return;return!0}},":last-of-type":function(t){if(1===t.parentNode.nodeType){for(var e=t.nodeName;t=s(t);)if(t.nodeName===e)return;return!0}},":only-of-type":function(t){return g[":first-of-type"](t)&&g[":last-of-type"](t)},":nth-of-type":function(t,e){return m(t,function(t,e){return t.nodeName===e.nodeName},e)},":nth-last-of-type":function(t){return g[":nth-of-type"](t,!0)},":checked":function(t){return!(!t.checked&&!t.selected)},":indeterminate":function(t){return!g[":checked"](t)},":enabled":function(t){return!t.disabled&&"hidden"!==t.type},":disabled":function(t){return!!t.disabled},":target":function(t){return t.id===e.location.hash.substring(1)},":focus":function(t){return t===t.ownerDocument.activeElement},":matches":function(t){return E(t)},":nth-match":function(t,e){var r=t.split(/\s*,\s*/),n=r.shift(),o=E(r.join(","));return m(n,o,e)},":nth-last-match":function(t){return g[":nth-match"](t,!0)},":links-here":function(t){return t+""==e.location+""},":lang":function(t){return function(e){for(;e;){if(e.lang)return 0===e.lang.indexOf(t);e=e.parentNode}}},":dir":function(t){return function(e){for(;e;){if(e.dir)return e.dir===t;e=e.parentNode}}},":scope":function(t,e){var r=e||t.ownerDocument;return 9===r.nodeType?t===r.documentElement:t===r},":any-link":function(t){return"string"==typeof t.href},":local-link":function(t){if(t.nodeName)return t.href&&t.host===e.location.host;var r=+t+1;return function(t){if(t.href){var n=e.location+"",o=t+"";return d(n,r)===d(o,r)}}},":default":function(t){return!!t.defaultSelected},":valid":function(t){return t.willValidate||t.validity&&t.validity.valid},":invalid":function(t){return!g[":valid"](t)},":in-range":function(t){return t.value>t.min&&t.value<=t.max},":out-of-range":function(t){return!g[":in-range"](t)},":required":function(t){return!!t.required},":optional":function(t){return!t.required},":read-only":function(t){if(t.readOnly)return!0;var e=t.getAttribute("contenteditable"),r=t.contentEditable,n=t.nodeName.toLowerCase();return n="input"!==n&&"textarea"!==n,(n||t.disabled)&&null==e&&"true"!==r},":read-write":function(t){return!g[":read-only"](t)},":hover":function(){throw Error(":hover is not supported.")},":active":function(){throw Error(":active is not supported.")},":link":function(){throw Error(":link is not supported.")},":visited":function(){throw Error(":visited is not supported.")},":column":function(){throw Error(":column is not supported.")},":nth-column":function(){throw Error(":nth-column is not supported.")},":nth-last-column":function(){throw Error(":nth-last-column is not supported.")},":current":function(){throw Error(":current is not supported.")},":past":function(){throw Error(":past is not supported.")},":future":function(){throw Error(":future is not supported.")},":contains":function(t){return function(e){var r=e.innerText||e.textContent||e.value||"";return!!~r.indexOf(t)}},":has":function(t){return function(e){return T(t,e).length>0}}},v={"-":function(){return!0},"=":function(t,e){return t===e},"*=":function(t,e){return-1!==t.indexOf(e)},"~=":function(t,e){var n,o,r=t.indexOf(e);if(-1!==r)return n=t[r-1],o=t[r+e.length],!(n&&" "!==n||o&&" "!==o)},"|=":function(t,e){var n,r=t.indexOf(e);if(0===r)return n=t[r+e.length],"-"===n||!n},"^=":function(t,e){return 0===t.indexOf(e)},"$=":function(t,e){return t.indexOf(e)+e.length===t.length},"!=":function(t,e){return t!==e}},_={" ":function(t){return function(e){for(;e=e.parentNode;)if(t(e))return e}},">":function(t){return function(e){return t(e=e.parentNode)&&e}},"+":function(t){return function(e){return t(e=a(e))&&e}},"~":function(t){return function(e){for(;e=a(e);)if(t(e))return e}},noop:function(t){return function(e){return t(e)&&e}},ref:function(t,e){function n(t){for(var e=t.ownerDocument,o=e.getElementsByTagName("*"),i=o.length;i--;)if(r=o[i],n.test(t))return r=null,!0;r=null}var r;return n.combinator=function(n){if(r&&r.getAttribute){var o=r.getAttribute(e)||"";return"#"===o[0]&&(o=o.substring(1)),o===n.id&&t(r)?r:void 0}},n}},b={qname:/^ *([\w\-]+|\*)/,simple:/^(?:([.#][\w\-]+)|pseudo|attr)/,ref:/^ *\/([\w\-]+)\/ */,combinator:/^(?: +([^ \w*]) +|( )+|([^ \w*]))(?! *$)/,attr:/^\[([\w\-]+)(?:([^\w]?=)(inside))?\]/,pseudo:/^(:[\w\-]+)(?:\((inside)\))?/,inside:/(?:"(?:\\"|[^"])*"|'(?:\\'|[^'])*'|<[^"'>]*>|\\["'>]|[^"'>])*/};b.inside=f(b.inside,"[^\"'>]*",b.inside),b.attr=f(b.attr,"inside",h("\\[","\\]")),b.pseudo=f(b.pseudo,"inside",h("\\(","\\)")),b.simple=f(b.simple,"pseudo",b.pseudo),b.simple=f(b.simple,"attr",b.attr);var w=function(t){for(var e,o,i,s,a,u,t=t.replace(/^\s+|\s+$/g,""),r=[],n=[];t;){if(s=b.qname.exec(t))t=t.substring(s[0].length),i=s[1],n.push(x(i,!0));else{if(!(s=b.simple.exec(t)))throw Error("Invalid selector.");t=t.substring(s[0].length),i="*",n.push(x(i,!0)),n.push(x(s))}for(;s=b.simple.exec(t);)t=t.substring(s[0].length),n.push(x(s));if("!"===t[0]&&(t=t.substring(1),o=A(),o.qname=i,n.push(o.simple)),s=b.ref.exec(t))t=t.substring(s[0].length),u=_.ref(O(n),s[1]),r.push(u.combinator),n=[];else{if(s=b.combinator.exec(t)){if(t=t.substring(s[0].length),a=s[1]||s[2]||s[3],","===a){r.push(_.noop(O(n)));break}}else a="noop";r.push(_[a](O(n))),n=[]}}return e=B(r),e.qname=i,e.sel=t,o&&(o.lname=e.qname,o.test=e,o.qname=o.qname,o.sel=e.sel,e=o),u&&(u.test=e,u.qname=e.qname,u.sel=e.sel,e=u),e},x=function(t,e){if(e)return"*"===t?g["*"]:g.type(t);if(t[1])return"."===t[1][0]?g.attr("class","~=",t[1].substring(1)):g.attr("id","=",t[1].substring(1));if(t[2])return t[3]?g[t[2]](p(t[3])):g[t[2]];if(t[4]){var r;return t[6]&&(r=t[6].length,t[6]=t[6].replace(/ +i$/,""),r=r>t[6].length),g.attr(t[4],t[5]||"-",p(t[6]),r)}throw Error("Unknown Selector.")},O=function(t){var r,e=t.length;return 2>e?t[0]:function(n){if(n){for(r=0;e>r;r++)if(!t[r](n))return;return!0}}},B=function(t){return 2>t.length?function(e){return!!t[0](e)}:function(e){for(var r=t.length;r--;)if(!(e=t[r](e)))return;return!0}},A=function(){function e(r){for(var n=r.ownerDocument,o=n.getElementsByTagName(e.lname),i=o.length;i--;)if(e.test(o[i])&&t===r)return t=null,!0;t=null}var t;return e.simple=function(e){return t=e,!0},e},E=function(t){for(var e=w(t),r=[e];e.sel;)e=w(e.sel),r.push(e);return 2>r.length?e:function(t){for(var e=r.length,n=0;e>n;n++)if(r[n](t))return!0}},S=function(t,e){for(var a,r=[],n=w(t),o=e.getElementsByTagName(n.qname),s=0;a=o[s++];)n(a)&&r.push(a);if(n.sel){for(;n.sel;)for(n=w(n.sel),o=e.getElementsByTagName(n.qname),s=0;a=o[s++];)n(a)&&!~l.call(r,a)&&r.push(a);r.sort(i)}return r},C=function(){var t=function(){try{return Array.prototype.slice.call(r.getElementsByTagName("zest")),Array.prototype.slice}catch(t){return t=null,function(){for(var t=[],e=0,r=this.length;r>e;e++)t.push(this[e]);return t}}}();return r.querySelectorAll?function(e,r){try{return t.call(r.querySelectorAll(e))}catch(n){return S(e,r)}}:function(e,r){try{if("#"===e[0]&&/^#[\w\-]+$/.test(e))return[r.getElementById(e.substring(1))];if("."===e[0]&&/^\.[\w\-]+$/.test(e))return e=r.getElementsByClassName(e.substring(1)),t.call(e);if(/^[\w\-]+$/.test(e))return t.call(r.getElementsByTagName(e))}catch(n){}return S(e,r)}}(),T=function(t,n){try{t=C(t,n||r)}catch(o){e.ZEST_DEBUG&&console.log(o.stack||o+""),t=[]}return t};T.selectors=g,T.operators=v,T.combinators=_,T.compile=E,T.matches=function(t,e){return!!E(e)(t)},T.cache=function(){if(!w.raw){var t=w,e={};w=function(r){return e[r]||(e[r]=t(r))},w.raw=t,T._cache=e}},T.noCache=function(){w.raw&&(w=w.raw,delete T._cache)},T.noConflict=function(){return e.zest=n,T},T.noNative=function(){C=S},t.exports=T,e.ZEST_DEBUG?T.noNative():T.cache()}).call(function(){return this||("undefined"!=typeof window?window:e)}())}).call(e,function(){return this}())},function(module,exports,__webpack_require__){!function(t,e){module.exports=e()}("reqwest",function(){function handleReadyState(t,e,r){return function(){t&&4==t[readyState]&&(twoHundo.test(t.status)?e(t):r(t))}}function setHeaders(t,e){var n,r=e.headers||{};r.Accept=r.Accept||defaultHeaders.accept[e.type]||defaultHeaders.accept["*"],e.crossOrigin||r[requestedWith]||(r[requestedWith]=defaultHeaders.requestedWith),r[contentType]||(r[contentType]=e.contentType||defaultHeaders.contentType);for(n in r)r.hasOwnProperty(n)&&t.setRequestHeader(n,r[n])}function generalCallback(t){lastValue=t}function urlappend(t,e){return t+(/\?/.test(t)?"&":"?")+e}function handleJsonp(t,e,r,n){var o=uniqid++,i=t.jsonpCallback||"callback",s=t.jsonpCallbackName||"reqwest_"+o,a=RegExp("((^|\\?|&)"+i+")=([^&]+)"),u=n.match(a),c=doc.createElement("script"),p=0;u?"?"===u[3]?n=n.replace(a,"$1="+s):s=u[3]:n=urlappend(n,i+"="+s),win[s]=generalCallback,c.type="text/javascript",c.src=n,c.async=!0,c.onreadystatechange!==void 0&&(c.event="onclick",c.htmlFor=c.id="_reqwest_"+o),c.onload=c.onreadystatechange=function(){return c[readyState]&&"complete"!==c[readyState]&&"loaded"!==c[readyState]||p?!1:(c.onload=c.onreadystatechange=null,c.onclick&&c.onclick(),t.success&&t.success(lastValue),lastValue=void 0,head.removeChild(c),p=1,void 0)},head.appendChild(c)}function getRequest(t,e,r){var s,n=(t.method||"GET").toUpperCase(),o="string"==typeof t?t:t.url,i=t.processData!==!1&&t.data&&"string"!=typeof t.data?reqwest.toQueryString(t.data):t.data||null;return"jsonp"!=t.type&&"GET"!=n||!i||(o=urlappend(o,i),i=null),"jsonp"==t.type?handleJsonp(t,e,r,o):(s=xhr(),s.open(n,o,!0),setHeaders(s,t),s.onreadystatechange=handleReadyState(s,e,r),t.before&&t.before(s),s.send(i),s)}function Reqwest(t,e){this.o=t,this.fn=e,init.apply(this,arguments)}function setType(t){var e=t.match(/\.(json|jsonp|html|xml)(\?|$)/);return e?e[1]:"js"}function init(o,fn){function complete(t){o.timeout&&clearTimeout(self.timeout),self.timeout=null,o.complete&&o.complete(t)}function success(resp){var r=resp.responseText;if(r)switch(type){case"json":try{resp=win.JSON?win.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case"js":resp=eval(r);break;case"html":resp=r}fn(resp),o.success&&o.success(resp),complete(resp)}function error(t,e,r){o.error&&o.error(t,e,r),complete(t)}this.url="string"==typeof o?o:o.url,this.timeout=null;var type=o.type||setType(this.url),self=this;fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){self.abort()},o.timeout)),this.request=getRequest(o,success,error)}function reqwest(t,e){return new Reqwest(t,e)}function normalize(t){return t?t.replace(/\r?\n/g,"\r\n"):""}function serial(t,e){var r=t.name,n=t.tagName.toLowerCase(),o=function(t){t&&!t.disabled&&e(r,normalize(t.attributes.value&&t.attributes.value.specified?t.value:t.text))};if(!t.disabled&&r)switch(n){case"input":if(!/reset|button|image|file/i.test(t.type)){var i=/checkbox/i.test(t.type),s=/radio/i.test(t.type),a=t.value;(!(i||s)||t.checked)&&e(r,normalize(i&&""===a?"on":a))}break;case"textarea":e(r,normalize(t.value));break;case"select":if("select-one"===t.type.toLowerCase())o(t.selectedIndex>=0?t.options[t.selectedIndex]:null);else for(var u=0;t.length&&t.length>u;u++)t.options[u].selected&&o(t.options[u])}}function eachFormElement(){var e,r,n,t=this,o=function(e,r){for(var o=0;r.length>o;o++){var i=e[byTag](r[o]);for(n=0;i.length>n;n++)serial(i[n],t)}};for(r=0;arguments.length>r;r++)e=arguments[r],/input|select|textarea/i.test(e.tagName)&&serial(e,t),o(e,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var t={};return eachFormElement.apply(function(e,r){e in t?(t[e]&&!isArray(t[e])&&(t[e]=[t[e]]),t[e].push(r)):t[e]=r},arguments),t}var context=this,win=window,doc=document,old=context.reqwest,twoHundo=/^20\d$/,byTag="getElementsByTagName",readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",head=doc[byTag]("head")[0],uniqid=0,lastValue,xmlHttpRequest="XMLHttpRequest",isArray="function"==typeof Array.isArray?Array.isArray:function(t){return t instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"},requestedWith:xmlHttpRequest},xhr=win[xmlHttpRequest]?function(){return new XMLHttpRequest}:function(){return new ActiveXObject("Microsoft.XMLHTTP")};return Reqwest.prototype={abort:function(){this.request.abort()},retry:function(){init.call(this,this.o,this.fn)}},reqwest.serializeArray=function(){var t=[];return eachFormElement.apply(function(e,r){t.push({name:e,value:r})},arguments),t},reqwest.serialize=function(){if(0===arguments.length)return"";var t,e,r=Array.prototype.slice.call(arguments,0);return t=r.pop(),t&&t.nodeType&&r.push(t)&&(t=null),t&&(t=t.type),e="map"==t?serializeHash:"array"==t?reqwest.serializeArray:serializeQueryString,e.apply(null,r)},reqwest.toQueryString=function(t){var r,e="",n=encodeURIComponent,o=function(t,r){e+=n(t)+"="+n(r)+"&"};if(isArray(t))for(r=0;t&&t.length>r;r++)o(t[r].name,t[r].value);else for(var i in t)if(Object.hasOwnProperty.call(t,i)){var s=t[i];if(isArray(s))for(r=0;s.length>r;r++)o(i,s[r]);else o(i,t[i])}return e.replace(/&$/,"").replace(/%20/g,"+")},reqwest.compat=function(t,e){return t&&(t.type&&(t.method=t.type)&&delete t.type,t.dataType&&(t.type=t.dataType),t.jsonpCallback&&(t.jsonpCallbackName=t.jsonpCallback)&&delete t.jsonpCallback,t.jsonp&&(t.jsonpCallback=t.jsonp)),new Reqwest(t,e)},reqwest})},function(t,e,r){r(11)(r(12))},function(t,e,r){r(11)(r(13))},function(t){t.exports=function(t){window.execScript?window.execScript(t):eval.call(null,t)}},function(t){t.exports="var SAFARI_CONTAINS_IS_BROKEN, version;\n\nif (/Safari/.test(navigator.userAgent)) {\n  version = /WebKit\\/(\\S+)/.exec(navigator.userAgent);\n  if (version && parseFloat(version) < 540) {\n    SAFARI_CONTAINS_IS_BROKEN = true;\n  }\n}\n\nwindow.containsNode = function(parent, child) {\n  if (parent === child) {\n    return true;\n  }\n  if (parent.contains && !SAFARI_CONTAINS_IS_BROKEN) {\n    return parent.contains(child);\n  }\n  if (parent.compareDocumentPosition) {\n    return !!(parent.compareDocumentPosition(child) & 16);\n  }\n  while (child && parent !== child) {\n    child = child.parentNode;\n  }\n  return child === parent;\n};\n"},function(t){t.exports="Batman.extend(Batman.DOM, {\n  querySelectorAll: function(node, selector) {\n    return zest(selector, node);\n  },\n  querySelector: function(node, selector) {\n    return zest(selector, node)[0];\n  },\n  setInnerHTML: function(node, html) {\n    return node != null ? node.innerHTML = html : void 0;\n  },\n  containsNode: function(parent, child) {\n    if (!child) {\n      child = parent;\n      parent = document.body;\n    }\n    return window.containsNode(parent, child);\n  },\n  textContent: function(node) {\n    var _ref;\n    return (_ref = node.textContent) != null ? _ref : node.innerText;\n  },\n  destroyNode: function(node) {\n    var _ref;\n    Batman.DOM.cleanupNode(node);\n    return node != null ? (_ref = node.parentNode) != null ? _ref.removeChild(node) : void 0 : void 0;\n  }\n});\n\nBatman.extend(Batman.Request.prototype, {\n  _parseResponseHeaders: function(xhr) {\n    var headers;\n    return headers = xhr.getAllResponseHeaders().split('\\n').reduce(function(acc, header) {\n      var key, matches, value;\n      if (matches = header.match(/([^:]*):\\s*(.*)/)) {\n        key = matches[1];\n        value = matches[2];\n        acc[key] = value;\n      }\n      return acc;\n    }, {});\n  },\n  send: function(data) {\n    var options, xhr, _ref;\n    if (data == null) {\n      data = this.get('data');\n    }\n    this.fire('loading');\n    options = {\n      url: this.get('url'),\n      method: this.get('method'),\n      type: this.get('type'),\n      headers: this.get('headers'),\n      success: (function(_this) {\n        return function(response) {\n          _this.mixin({\n            xhr: xhr,\n            response: response,\n            status: typeof xhr !== \"undefined\" && xhr !== null ? xhr.status : void 0,\n            responseHeaders: _this._parseResponseHeaders(xhr)\n          });\n          return _this.fire('success', response);\n        };\n      })(this),\n      error: (function(_this) {\n        return function(xhr) {\n          _this.mixin({\n            xhr: xhr,\n            response: xhr.responseText || xhr.content,\n            status: xhr.status,\n            responseHeaders: _this._parseResponseHeaders(xhr)\n          });\n          xhr.request = _this;\n          return _this.fire('error', xhr);\n        };\n      })(this),\n      complete: (function(_this) {\n        return function() {\n          return _this.fire('loaded');\n        };\n      })(this)\n    };\n    if ((_ref = options.method) === 'PUT' || _ref === 'POST') {\n      if (this.hasFileUploads()) {\n        options.data = this.constructor.objectToFormData(data);\n      } else {\n        options.contentType = this.get('contentType');\n        options.data = Batman.URI.queryFromParams(data);\n      }\n    } else {\n      options.data = data;\n    }\n    return xhr = (reqwest(options)).request;\n  }\n});\n"},function(t,e,r){(function(e){var r,n,o=[].indexOf||function(t){for(var e=0,r=this.length;r>e;e++)if(e in this&&this[e]===t)return e;return-1};n=function(t){var r,n,i,s,a,u,c;return r=function(){var e,r;return t.postMessage?(e=!0,r=t.onmessage,t.onmessage=function(){return e=!1},t.postMessage("","*"),t.onmessage=r,e):!1},c=new Batman.SimpleHash,n=0,s=function(){return"go"+ ++n},t.setImmediate&&t.clearImmediate?(Batman.setImmediate=function(){return t.setImmediate.apply(t,arguments)},Batman.clearImmediate=function(){return t.clearImmediate.apply(t,arguments)}):r()?(u="com.batman.",a=function(t){var e,r;if("string"==typeof t.data&&~t.data.search(u))return e=t.data.substring(u.length),"function"==typeof(r=c.unset(e))?r():void 0},t.addEventListener?t.addEventListener("message",a,!1):t.attachEvent("onmessage",a),Batman.setImmediate=function(e){var r;return c.set(r=s(),e),t.postMessage(u+r,"*"),r},Batman.clearImmediate=function(t){return c.unset(t)}):"undefined"!=typeof document&&o.call(document.createElement("script"),"onreadystatechange")>=0?(Batman.setImmediate=function(){var e,r;return e=s(),r=document.createElement("script"),r.onreadystatechange=function(){var t;return"function"==typeof(t=c.get(e))&&t(),r.onreadystatechange=null,r.parentNode.removeChild(r),r=null},document.documentElement.appendChild(r),e},Batman.clearImmediate=function(t){return c.unset(t)}):(e!==void 0&&null!==e?e.nextTick:void 0)?(i={},Batman.setImmediate=function(t){var r;return r=s(),i[r]=t,e.nextTick(function(){return"function"==typeof i[r]&&i[r](),delete i[r]}),r},Batman.clearImmediate=function(t){return delete i[t]}):(Batman.setImmediate=function(t){return setTimeout(t,0)},Batman.clearImmediate=function(t){return clearTimeout(t)})},t.exports=r={setImmediate:function(){return n(Batman.container),Batman.setImmediate.apply(this,arguments)},clearImmediate:function(){return n(Batman.container),Batman.clearImmediate.apply(this,arguments)}}}).call(e,r(160))},function(t){var n,o=[].slice,i=[].indexOf||function(t){for(var e=0,r=this.length;r>e;e++)if(e in this&&this[e]===t)return e;return-1};t.exports=n=function(){function t(){this._plural=[],this._singular=[],this._uncountable=[],this._human=[]}return t.prototype.plural=function(t,e){return this._plural.unshift([t,e])},t.prototype.singular=function(t,e){return this._singular.unshift([t,e])},t.prototype.human=function(t,e){return this._human.unshift([t,e])},t.prototype.uncountable=function(){var t;return t=arguments.length>=1?o.call(arguments,0):[],this._uncountable=this._uncountable.concat(t.map(function(t){return RegExp(""+t+"$","i")}))},t.prototype.irregular=function(t,e){return t.charAt(0)===e.charAt(0)?(this.plural(RegExp("("+t.charAt(0)+")"+t.slice(1)+"$","i"),"$1"+e.slice(1)),this.plural(RegExp("("+t.charAt(0)+")"+e.slice(1)+"$","i"),"$1"+e.slice(1)),this.singular(RegExp("("+e.charAt(0)+")"+e.slice(1)+"$","i"),"$1"+t.slice(1))):(this.plural(RegExp(""+t+"$","i"),e),this.plural(RegExp(""+e+"$","i"),e),this.singular(RegExp(""+e+"$","i"),t))},t.prototype.ordinalize=function(t,e){var r,n;if(null==e&&(e=10),t=parseInt(t,e),r=Math.abs(t),n=r%100,i.call([11,12,13],n)>=0)return t+"th";switch(r%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd";default:return t+"th"}},t.prototype.pluralize=function(t){var e,r,n,o,i,s,a,u,c,p;for(u=this._uncountable,o=0,s=u.length;s>o;o++)if(n=u[o],n.test(t))return t;for(c=this._plural,i=0,a=c.length;a>i;i++)if(p=c[i],e=p[0],r=p[1],e.test(t))return t.replace(e,r);return t},t.prototype.singularize=function(t){var e,r,n,o,i,s,a,u,c,p;for(u=this._uncountable,o=0,s=u.length;s>o;o++)if(n=u[o],n.test(t))return t;for(c=this._singular,i=0,a=c.length;a>i;i++)if(p=c[i],e=p[0],r=p[1],e.test(t))return t.replace(e,r);return t},t.prototype.humanize=function(t){var e,r,n,o,i,s;for(i=this._human,n=0,o=i.length;o>n;n++)if(s=i[n],e=s[0],r=s[1],e.test(t))return t.replace(e,r);return t},t}()},function(t,e,r){var n,o,i,s,a,u,c,p,l,h;n=r(15),o=/(?:^|_|\-)(.)/g,p=/(^|\s)([a-z])/g,l=/([A-Z]+)([A-Z][a-z])/g,h=/([a-z\d])([A-Z])/g,s=/_id$/,a=/_|-|\./g,u=/^\w/g,t.exports=i={ordinalize:function(){return i.inflector.ordinalize.apply(i.inflector,arguments)},singularize:function(){return i.inflector.singularize.apply(i.inflector,arguments)},pluralize:function(t,e,r,n){var o;return null==n&&(n=!0),2>arguments.length?i.inflector.pluralize(t):(o=1===+t?e:r||i.inflector.pluralize(e),n&&(o=""+(t||0)+" "+o),o)},camelize:function(t,e){return t=t.replace(o,function(t,e){return e.toUpperCase()}),e?t.substr(0,1).toLowerCase()+t.substr(1):t},underscore:function(t){return t.replace(l,"$1_$2").replace(h,"$1_$2").replace("-","_").toLowerCase()},titleize:function(t){return t.replace(p,function(t,e,r){return e+r.toUpperCase()})},capitalize:function(t){return t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()},trim:function(t){return t?t.trim():""},interpolate:function(t,e){var r,n,o;"object"==typeof t?(n=t[e.count],n||(n=t.other)):n=t;for(r in e)o=e[r],n=n.replace(RegExp("%\\{"+r+"\\}","g"),o);return n},humanize:function(t){return t=Batman.helpers.underscore(t),t=Batman.helpers.inflector.humanize(t),t.replace(s,"").replace(a," ").replace(u,function(t){return t.toUpperCase()})},toSentence:function(t){var e,r;return 3>t.length?t.join(" and "):(t=t.slice(),r=t.pop(),e=t.join(", "),e+=", and "+r)},coerceInteger:function(t,e){var r;if(null==e&&(e=!1),"string"==typeof t&&null===t.match(/[^0-9]/)&&""+(r=parseInt(t,10))===t)return r;if(e)throw""+t+" was passed to Batman.helpers.coerceInteger but couldn't be coerced!";return t}},c=new n,i.inflector=c,c.plural(/$/,"s"),c.plural(/s$/i,"s"),c.plural(/(ax|test)is$/i,"$1es"),c.plural(/(octop|vir)us$/i,"$1i"),c.plural(/(octop|vir)i$/i,"$1i"),c.plural(/(alias|status)$/i,"$1es"),c.plural(/(bu)s$/i,"$1ses"),c.plural(/(buffal|tomat)o$/i,"$1oes"),c.plural(/([ti])um$/i,"$1a"),c.plural(/([ti])a$/i,"$1a"),c.plural(/sis$/i,"ses"),c.plural(/(?:([^f])fe|([lr])f)$/i,"$1$2ves"),c.plural(/(hive)$/i,"$1s"),c.plural(/([^aeiouy]|qu)y$/i,"$1ies"),c.plural(/(x|ch|ss|sh)$/i,"$1es"),c.plural(/(matr|vert|ind)(?:ix|ex)$/i,"$1ices"),c.plural(/([m|l])ouse$/i,"$1ice"),c.plural(/([m|l])ice$/i,"$1ice"),c.plural(/^(ox)$/i,"$1en"),c.plural(/^(oxen)$/i,"$1"),c.plural(/(quiz)$/i,"$1zes"),c.singular(/s$/i,""),c.singular(/(n)ews$/i,"$1ews"),c.singular(/([ti])a$/i,"$1um"),c.singular(/((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$/i,"$1$2sis"),c.singular(/(^analy)ses$/i,"$1sis"),c.singular(/([^f])ves$/i,"$1fe"),c.singular(/(hive)s$/i,"$1"),c.singular(/(tive)s$/i,"$1"),c.singular(/([lr])ves$/i,"$1f"),c.singular(/([^aeiouy]|qu)ies$/i,"$1y"),c.singular(/(s)eries$/i,"$1eries"),c.singular(/(m)ovies$/i,"$1ovie"),c.singular(/(x|ch|ss|sh)es$/i,"$1"),c.singular(/([m|l])ice$/i,"$1ouse"),c.singular(/(bus)es$/i,"$1"),c.singular(/(o)es$/i,"$1"),c.singular(/(shoe)s$/i,"$1"),c.singular(/(cris|ax|test)es$/i,"$1is"),c.singular(/(octop|vir)i$/i,"$1us"),c.singular(/(alias|status)es$/i,"$1"),c.singular(/^(ox)en/i,"$1"),c.singular(/(vert|ind)ices$/i,"$1ex"),c.singular(/(matr)ices$/i,"$1ix"),c.singular(/(quiz)zes$/i,"$1"),c.singular(/(database)s$/i,"$1"),c.irregular("person","people"),c.irregular("man","men"),c.irregular("child","children"),c.irregular("sex","sexes"),c.irregular("move","moves"),c.irregular("cow","kine"),c.irregular("zombie","zombies"),c.uncountable("equipment","information","rice","money","species","series","fish","sheep","jeans")},function(t,e,r){var n,o;o=r(1).typeOf,t.exports=n=function(){function f(e){var r,n;for(n=h.exec(e),r=14;r--;)this[t[r]]=n[r]||"";this.queryParams=this.constructor.paramsFromQuery(this.query),delete this.authority,delete this.userInfo,delete this.relative,delete this.directory,delete this.file,delete this.query}var t,e,r,n,i,s,a,u,c,p,l,h;return h=/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,t=["source","protocol","authority","userInfo","user","password","hostname","port","relative","path","directory","file","query","hash"],f.prototype.queryString=function(){return this.constructor.queryFromParams(this.queryParams)
},f.prototype.toString=function(){return[this.protocol?""+this.protocol+":":void 0,this.authority()?"//":void 0,this.authority(),this.relative()].join("")},f.prototype.userInfo=function(){return[this.user,this.password?":"+this.password:void 0].join("")},f.prototype.authority=function(){return[this.userInfo(),this.user||this.password?"@":void 0,this.hostname,this.port?":"+this.port:void 0].join("")},f.prototype.relative=function(){var t;return t=this.queryString(),[this.path,t?"?"+t:void 0,this.hash?"#"+this.hash:void 0].join("")},f.prototype.directory=function(){var t;return t=this.path.split("/"),t.length>1?t.slice(0,t.length-1).join("/")+"/":""},f.prototype.file=function(){var t;return t=this.path.split("/"),t[t.length-1]},f.paramsFromQuery=function(t){var e,n,o,i,a,c;for(n={},c=t.split("&"),i=0,a=c.length;a>i;i++)o=c[i],(e=o.match(s))?u(n,r(e[1]),r(e[2])):u(n,r(o),null);return n},f.decodeQueryComponent=r=function(t){return decodeURIComponent(t.replace(c,"%20"))},a=/^[\[\]]*([^\[\]]+)\]*(.*)/,e=[/^\[\]\[([^\[\]]+)\]$/,/^\[\](.+)$/],c=/\+/g,l=/%20/g,s=/^([^=]*)=(.*)/,u=function(t,r,n){var i,s,c,p,l;if(l=r.match(a)){if(c=l[1],i=l[2],""===i)t[c]=n;else if("[]"===i){if(null==t[c]&&(t[c]=[]),"Array"!==o(t[c]))throw Error("expected Array (got "+o(t[c])+') for param "'+c+'"');t[c].push(n)}else if(l=i.match(e[0])||i.match(e[1])){if(s=l[1],null==t[c]&&(t[c]=[]),"Array"!==o(t[c]))throw Error("expected Array (got "+o(t[c])+') for param "'+c+'"');p=t[c][t[c].length-1],"Object"!==o(p)||s in p?t[c].push(u({},s,n)):u(p,s,n)}else{if(null==t[c]&&(t[c]={}),"Object"!==o(t[c]))throw Error("expected Object (got "+o(t[c])+') for param "'+c+'"');t[c]=u(t[c],i,n)}return t}},f.queryFromParams=p=function(t,e){var r,n,s,a;if(null==t)return e;if(a=o(t),null==e&&"Object"!==a)throw Error("value must be an Object");switch(a){case"Array":return function(){var n,o;if(r=[],0===t.length)r.push(p(null,""+e+"[]"));else for(n=0,o=t.length;o>n;n++)s=t[n],r.push(p(s,""+e+"[]"));return r}().join("&");case"Object":return function(){var r;r=[];for(n in t)s=t[n],r.push(p(s,e?""+e+"["+i(n)+"]":i(n)));return r}().join("&");default:return null!=e?""+e+"="+i(t):i(t)}},f.encodeComponent=n=function(t){return null!=t?encodeURIComponent(t):""},f.encodeQueryComponent=i=function(t){return n(t).replace(l,"+")},f}()},function(t,e,r){var n,o,i,s,a,u,c={}.hasOwnProperty,p=function(t,e){function n(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},l=[].slice;a=r(16),u=r(1),n=u.BatmanObject,o=u.Property,s=u.extend,t.exports=i=function(t){function e(t){this.nextEvents=[],this.set("_state",t)}return p(e,t),e.InvalidTransitionError=function(t){this.message=null!=t?t:""},e.InvalidTransitionError.prototype=Error(),e.transitions=function(t){var e,r,n,o,i,u,c,p,h,f;for(n in t)p=t[n],p.from&&p.to&&(o={},p.from.forEach?p.from.forEach(function(t){return o[t]=p.to}):o[p.from]=p.to,t[n]=o);this.prototype.transitionTable=s({},this.prototype.transitionTable,t),i=[],e=function(t){return function(e){var r;return r="is"+a.titleize(e),null==t.prototype[r]?(i.push(r),t.prototype[r]=function(){return this.get("state")===e}):void 0}}(this),f=this.prototype.transitionTable,h=function(t){return function(e){return t.prototype[e]=function(){return this.startTransition(e)}}}(this);for(n in f)if(c=f[n],!this.prototype[n]){h(n);for(r in c)u=c[r],e(r),e(u)}return i.length&&this.accessor.apply(this,l.call(i).concat([function(t){return this[t]()}])),this},e.accessor("state",function(){return this.get("_state")}),e.prototype.isTransitioning=!1,e.prototype.transitionTable={},e.prototype._transitionEvent=function(t,e){return""+t+"->"+e},e.prototype._enterEvent=function(t){return"enter "+t},e.prototype._exitEvent=function(t){return"exit "+t},e.prototype._beforeEvent=function(t){return"before "+t},e.prototype.onTransition=function(t,e,r){return this.on(this._transitionEvent(t,e),r)},e.prototype.onEnter=function(t,e){return this.on(this._enterEvent(t),e)},e.prototype.onExit=function(t,e){return this.on(this._exitEvent(t),e)},e.prototype.onBefore=function(t,e){return this.on(this._beforeEvent(t),e)},e.prototype.offTransition=function(t,e,r){return this.off(this._transitionEvent(t,e),r)},e.prototype.offEnter=function(t,e){return this.off(this._enterEvent(t),e)},e.prototype.offExit=function(t,e){return this.off(this._exitEvent(t),e)},e.prototype.offBefore=function(t,e){return this.off(this._beforeEvent(t),e)},e.prototype.startTransition=o.wrapTrackingPrevention(function(t){var e,r;return this.isTransitioning?(this.nextEvents.push(t),void 0):(r=this.get("state"),(e=this.nextStateForEvent(t))?(this.fire(this._beforeEvent(e)),this.isTransitioning=!0,this.fire(this._exitEvent(r)),this.set("_state",e),this.fire(this._transitionEvent(r,e)),this.fire(this._enterEvent(e)),this.fire(t),this.isTransitioning=!1,this.nextEvents.length>0&&this.startTransition(this.nextEvents.shift()),!0):!1)}),e.prototype.canStartTransition=function(t,e){return null==e&&(e=this.get("state")),!!this.nextStateForEvent(t,e)},e.prototype.nextStateForEvent=function(t,e){var r;return null==e&&(e=this.get("state")),null!=(r=this.transitionTable[t])?r[e]:void 0},e}(n)},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=r(18),t.exports=n=function(t){function e(t,r){this.base=r,e.__super__.constructor.call(this,t)}return s(e,t),e.prototype.fire=function(){var t,r;return t=e.__super__.fire.apply(this,arguments),(r=this.base).fire.apply(r,arguments),t},e}(o)},function(t,e,r){var n,o,i,s,a,u,c={}.hasOwnProperty,p=function(t,e){function n(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};i=r(17),u=r(1),n=u.BatmanObject,s=u.developer,a=u.typeOf,t.exports=o=function(t){function r(t){var e,n,o,i;n={};for(o in t)e=t[o],("success"===o||"error"===o||"loading"===o||"loaded"===o)&&(n[o]=e,delete t[o]);r.__super__.constructor.call(this,t);for(o in n)e=n[o],this.on(o,e);(null!=(i=this.get("url"))?i.length:void 0)>0?this.autosend&&this.send():this.observe("url",function(t){return null!=t?this.send():void 0})}var e;return p(r,t),r.objectToFormData=function(t){var e,r,n,o,i,s,u,c;for(n=function(t,e,r){var o,i,s;return null==r&&(r=!1),e instanceof Batman.container.File?[[t,e]]:i=function(){switch(a(e)){case"Object":return i=function(){var i;i=[];for(o in e)s=e[o],i.push(n(r?o:""+t+"["+o+"]",s));return i}(),i.reduce(function(t,e){return t.concat(e)},[]);case"Array":return e.reduce(function(e,r){return e.concat(n(""+t+"[]",r))},[]);default:return[[t,null!=e?e:""]]}}()},e=new Batman.container.FormData,u=n("",t,!0),i=0,s=u.length;s>i;i++)c=u[i],r=c[0],o=c[1],e.append(r,o);return e},r.dataHasFileUploads=e=function(t){var r,n,o,i,s;if("undefined"!=typeof File&&null!==File&&t instanceof File)return!0;switch(n=Batman.typeOf(t)){case"Object":for(r in t)if(o=t[r],e(o))return!0;break;case"Array":for(i=0,s=t.length;s>i;i++)if(o=t[i],e(o))return!0}return!1},r.wrapAccessor("method",function(t){return{set:function(e,r){return t.set.call(this,e,null!=r?"function"==typeof r.toUpperCase?r.toUpperCase():void 0:void 0)}}}),r.prototype.method="GET",r.prototype.hasFileUploads=function(){return e(this.data)},r.prototype.contentType="application/x-www-form-urlencoded",r.prototype.autosend=!0,r.prototype.send=function(){return s.error("You must add a platform library to implement Batman.Request (for example, batman.jquery)")},r.set("pendingRequestCount",0),r.classAccessor("requestIsPending",function(){return this.get("pendingRequestCount")>0}),r.prototype.on("loading",function(){return r.increment("pendingRequestCount")}),r.prototype.on("loaded",function(){return r.decrement("pendingRequestCount")}),r}(n)},function(t,e,r){var n,o,i,s,a=[].slice;s=r(1).typeOf,i=r(16),n={initialize:function(){return this.prototype.fireLifecycleEvent=o},lifecycleEvent:function(t,e){var r,n,o;return o="before"+i.camelize(t),n="after"+i.camelize(t),r=function(t){return function(r,n){var o,i,a,u,c;return"Object"===s(r)&&(c=[n,r],r=c[0],n=c[1]),o="String"===s(r)?function(){return this[r].apply(this,arguments)}:r,n=("function"==typeof e?e(n):void 0)||n,a=this.prototype||this,a.initializeBatman(),i=(u=a._batman)[t]||(u[t]=[]),i.push({options:n,callback:o})}},this[o]=r(o),this.prototype[o]=r(o),this[n]=r(n),this.prototype[n]=r(n)}},o=function(){var t,e,r,n,o,i,s,u;if(n=arguments[0],t=arguments.length>=2?a.call(arguments,1):[],r=this._batman.get(n))for(i=0,s=r.length;s>i;i++)if(u=r[i],o=u.options,e=u.callback,!((null!=o?o["if"]:false)&&!o["if"].apply(this,t)||(null!=o?o.unless:void 0)&&o.unless.apply(this,t)||e.apply(this,t)!==!1))return!1},t.exports=n},function(t,e,r){var n,o;n=r(1).BatmanObject,t.exports=o=new n},function(t,e,r){var n,o,i,s,a,u,c,p,l,h,f,d,y,m,g,v,_,b,w,x,O,B,A,E,S,C,T,I,k,P={}.hasOwnProperty,F=function(t,e){function n(){this.constructor=t}for(var r in e)P.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},N=[].slice;for(y=r(48),g=r(53),a=r(51),o=r(33),m=r(49),n=r(43),T=r(1),i=T.BatmanObject,p=T.Property,h=T.SimpleHash,f=T.SimpleSet,u=T.Hash,l=T.Set,_=T.developer,B=T.mixin,A=T.typeOf,b=T.extend,w=T.functionName,x=T.getPath,I=r(2),O=I.helpers,s=I.DelegatingStateMachine,d=I.StateMachine,c=function(t){function C(t){null==t&&(t={}),_.assert(this instanceof i,"constructors must be called with new"),"Object"===A(t)?C.__super__.constructor.call(this,t):(C.__super__.constructor.call(this),this.set("id",t))}var e,r,n,c,v,E,S;for(F(C,t),C.storageKey=null,C.primaryKey="id",C.prototype.coerceIntegerPrimaryKey=!0,C.persist=function(){var t,e;return t=arguments[0],e=arguments.length>=2?N.call(arguments,1):[],this.prototype.initializeBatman(),t=t.isStorageAdapter?t:new t(this),e.length>0&&B.apply(null,[t].concat(N.call(e))),this.prototype._batman.storage=t,t},C.storageAdapter=function(){return this.prototype.initializeBatman(),this.prototype._batman.storage},C.encode=function(){var t,e,r,n,o,i,s,a,u;switch(o=arguments.length>=2?N.call(arguments,0,s=arguments.length-1):(s=0,[]),r=arguments[s++],this.prototype.initializeBatman(),(i=this.prototype._batman).encoders||(i.encoders=new h),t={},A(r)){case"String":o.push(r);break;case"Function":t.encode=r;break;default:t=r}for(a=0,u=o.length;u>a;a++)n=o[a],e=b({as:n},this.defaultEncoder,t),this.prototype._batman.encoders.set(n,e)},C.defaultEncoder={encode:function(t){return t},decode:function(t){return t}},C.observeAndFire("primaryKey",function(t,e){return this.encode(e,{encode:!1,decode:!1}),this.encode(t,{encode:!1,decode:this.defaultEncoder.decode})}),C.validate=function(){var t,e,r,n,o,i,s,a,u;if(t=arguments.length>=2?N.call(arguments,0,s=arguments.length-1):(s=0,[]),r=arguments[s++],this.prototype.initializeBatman(),o=(i=this.prototype._batman).validators||(i.validators=[]),"function"==typeof r)o.push({keys:t,callback:r});else for(a=0,u=g.length;u>a;a++)n=g[a],(e=n.matches(r))&&o.push({keys:t,validator:new n(e),"if":r["if"],unless:r.unless})},C.classAccessor("resourceName",{get:function(){return null!=this.resourceName?this.resourceName:null!=this.prototype.resourceName?(Batman.config.minificationErrors&&_.error("Please define the resourceName property of the "+w(this)+" on the constructor and not the prototype. (For example, `@resourceName: '"+O.underscore(w(this))+"'`)"),this.prototype.resourceName):(Batman.config.minificationErrors&&_.error("Please define "+w(this)+".resourceName in order for your model to be minification safe. (For example, `@resourceName: '"+O.underscore(w(this))+"'`)"),O.underscore(w(this)))}}),C.classAccessor("all",{get:function(){return this._batman.check(this),this.prototype.hasStorage()&&!this._batman.allLoadTriggered&&(this.load(),this._batman.allLoadTriggered=!0),this.get("loaded")},set:function(t,e){return this.set("loaded",e)}}),C.classAccessor("loaded",{get:function(){return this._loaded||(this._loaded=new l)},set:function(t,e){return this._loaded=e}}),C.classAccessor("first",function(){return this.get("all").toArray()[0]}),C.classAccessor("last",function(){var t;return t=this.get("all").toArray(),t[t.length-1]}),C.clear=function(){var t,e;return this.initializeBatman(),t=this.get("loaded").clear(),null!=(e=this._batman.get("associations"))&&e.reset(),this._resetPromises(),t},C.find=function(t,e){return this.findWithOptions(t,void 0,e)},C.findWithOptions=function(t,e,r){var n,o;return null==e&&(e={}),this._pending||(this._pending={}),o=this._loadIdentity(t)||this._pending[t],null==o&&(o=new this,o._withoutDirtyTracking(function(){return this.set("id",t)}),this._pending[t]=o),n=o.loadWithOptions(e,function(e){return function(){return delete e._pending[t],null!=r?r.apply(e,arguments):void 0}}(this))},C.load=function(t,e){var r;return"function"==(r=typeof t)||"undefined"===r?(e=t,t={}):t={data:t},this.loadWithOptions(t,e)},C.loadWithOptions=function(t,e){return this.fire("loading",t),new Promise(function(r){return function(n,o){return r._doStorageOperation("readAll",t,function(t,i,s){return null!=t?(r.fire("error",t),"function"==typeof e&&e(t,[]),o(t)):(r.fire("loaded",i,s),"function"==typeof e&&e(t,i,s),n(i))})}}(this))},C.create=function(t,e){var r,n;return e||(n=[{},t],t=n[0],e=n[1]),r=new this(t),r.save(e),r},C.findOrCreate=function(t,e){var r;return r=this._loadIdentity(t[this.primaryKey]),r?(r.mixin(t),e(void 0,r)):(r=new this(t),r.save(e)),r},C.createFromJSON=function(t){return this._makeOrFindRecordFromData(t)},C.createMultipleFromJSON=function(t){return this._makeOrFindRecordsFromData(t)},C._loadIdentity=function(t){return this.coerceIntegerPrimaryKey&&(t=O.coerceInteger(t)),this.get("loaded.indexedByUnique.id").get(t)},C._loadRecord=function(t){var e,r;return(e=t[this.primaryKey])&&(r=this._loadIdentity(e)),r||(r=new this),r._withoutDirtyTracking(function(){return this.fromJSON(t)}),r},C._makeOrFindRecordFromData=function(t){var e;return e=this._loadRecord(t),this._mapIdentity(e)},C._makeOrFindRecordsFromData=function(t){var e,r;return r=function(){var r,n,o;for(o=[],r=0,n=t.length;n>r;r++)e=t[r],o.push(this._loadRecord(e));return o}.call(this),this._mapIdentities(r),r},C._mapIdentity=function(t){var e,r,n;return null!=(r=t.get("id"))&&((e=this._loadIdentity(r))?(n=e.get("lifecycle"),n.load(),e._withoutDirtyTracking(function(){var e,r;return e=null!=(r=t.get("attributes"))?r.toObject():void 0,e?this.mixin(e):void 0}),n.loaded(),t=e):this.get("loaded").add(t)),t},C._mapIdentities=function(t){var e,r,n,o,i,s,a,u;for(i=[],n=a=0,u=t.length;u>a;n=++a)s=t[n],null!=(r=s.get("id"))&&((e=this._loadIdentity(r))?(o=e.get("lifecycle"),o.load(),e._withoutDirtyTracking(function(){var t,e;return t=null!=(e=s.get("attributes"))?e.toObject():void 0,t?this.mixin(t):void 0}),o.loaded(),t[n]=e):i.push(s));return i.length&&this.get("loaded").addArray(i),t},C._doStorageOperation=function(t,e,r){var n;return _.assert(this.prototype.hasStorage(),"Can't "+t+" model "+w(this)+" without any storage adapters!"),n=this.prototype._batman.get("storage"),n.perform(t,this,e,r)},E=["find","load","create"],r=0,c=E.length;c>r;r++)e=E[r],C[e]=p.wrapTrackingPrevention(C[e]);for(C.InstanceLifecycleStateMachine=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return F(e,t),e.transitions({load:{from:["dirty","clean"],to:"loading"},create:{from:["dirty","clean"],to:"creating"},save:{from:["dirty","clean"],to:"saving"},destroy:{from:["dirty","clean"],to:"destroying"},failedValidation:{from:["saving","creating"],to:"dirty"},loaded:{loading:"clean"},created:{creating:"clean"},saved:{saving:"clean"},destroyed:{destroying:"destroyed"},set:{from:["dirty","clean"],to:"dirty"},error:{from:["saving","creating","loading","destroying"],to:"error"}}),e}(s),C.accessor("lifecycle",function(){return this.lifecycle||(this.lifecycle=new C.InstanceLifecycleStateMachine("clean",this))}),C.accessor("attributes",function(){return this.attributes||(this.attributes=new u)}),C.accessor("dirtyKeys",function(){return this.dirtyKeys||(this.dirtyKeys=new u)}),C.accessor("_dirtiedKeys",function(){return this._dirtiedKeys||(this._dirtiedKeys=new f)}),C.accessor("errors",function(){return this.errors||(this.errors=new a)}),C.accessor("isNew",function(){return this.isNew()}),C.accessor("isDirty",function(){return this.isDirty()}),C.accessor(C.defaultAccessor={get:function(t){return x(this,["attributes",t])},set:function(t,e){return this._willSet(t)?this.get("attributes").set(t,e):this.get(t)},unset:function(t){return this.get("attributes").unset(t)}}),C.wrapAccessor("id",function(t){return{get:function(){var e;return e=this.constructor.primaryKey,"id"===e?t.get.apply(this,arguments):this.get(e)},set:function(e,r){var n;return n=this.constructor.primaryKey,this.coerceIntegerPrimaryKey&&(r=O.coerceInteger(r)),"id"===n?(this._willSet(e),t.set.call(this,e,r)):this.set(n,r)}}}),C.prototype.isNew=function(){return this.get("id")===void 0},C.prototype.isDirty=function(){return"dirty"===this.get("lifecycle.state")},C.prototype.updateAttributes=function(t){return this.mixin(t),this},C.prototype.toString=function(){return""+this.constructor.get("resourceName")+": "+this.get("id")},C.prototype.toParam=function(){return this.get("id")},C.prototype.toJSON=function(){var t,e;return t=this._batman.get("encoders"),!t||t.isEmpty()?{}:(e={},t.forEach(function(t){return function(r,n){var o,i,s;if(n.encode&&void 0!==(i=t.get(r)))return void 0!==(o=n.encode(i,r,e,t))?e[null!=(s="function"==typeof n.as?n.as(r,i,e,t):void 0)?s:n.as]=o:void 0}}(this)),e)},C.prototype.fromJSON=function(t){var e,r,n,o;if(n={},e=this._batman.get("encoders"),e&&!e.isEmpty()&&e.some(function(t,e){return null!=e.decode}))e.forEach(function(e){return function(r,i){var s,a;if(i.decode&&(s=null!=(a="function"==typeof i.as?i.as(r,t[r],n,e):void 0)?a:i.as,o=t[s],void 0!==o&&(null!==o||null==e._associationForAttribute(s))))return n[r]=i.decode(o,s,t,n,e)}}(this));else for(r in t)o=t[r],n[r]=o;return"id"!==this.constructor.primaryKey&&(n.id=t[this.constructor.primaryKey]),_["do"](function(t){return function(){return!e||1>=e.length?_.warn("Warning: Model "+w(t.constructor)+" has suspiciously few decoders!"):void 0}}(this)),this.mixin(n)},C.prototype.hasStorage=function(){return null!=this._batman.get("storage")},C.prototype.load=function(t,e){var r;return e?t={data:t}:(r=[{},t],t=r[0],e=r[1]),this.loadWithOptions(t,e)},C.prototype.loadWithOptions=function(t,e){var r,n,o,i,s;return o=0!==Object.keys(t).length,"destroying"===(s=this.get("lifecycle.state"))||"destroyed"===s?(n=Error("Can't load a destroyed record!"),"function"==typeof e&&e(n),Promise.reject(n)):(i=function(n){return function(){return new Promise(function(i,s){return n._doStorageOperation("read",t,function(t,a,u){var c,p;for(t?n.get("lifecycle").error():(n.get("lifecycle").loaded(),a=n.constructor._mapIdentity(a),a.get("errors").clear()),o||(n._currentLoad=null,n._currentLoadPromise=null),c=0,p=r.length;p>c;c++)e=r[c],e(t,a,u);return null!=t?s(t):i(a)})})}}(this),this.get("lifecycle").load()?(r=[],null!=e&&r.push(e),o?i():(this._currentLoad=r,this._currentLoadPromise||(this._currentLoadPromise=i()))):"loading"!==this.get("lifecycle.state")||o?(n=new d.InvalidTransitionError("Can't load while in state "+this.get("lifecycle.state")),"function"==typeof e&&e(n),Promise.reject(n)):(null!=e&&this._currentLoad.push(e),this._currentLoadPromise))},C.prototype.save=function(t,e){var r,n,o,i,s,u,c;return e||(u=[{},t],t=u[0],e=u[1]),o=this.isNew(),c=o?["create","create","created"]:["save","update","saved"],i=c[0],s=c[1],r=c[2],this.get("lifecycle").startTransition(i)?new Promise(function(n){return function(o,i){return n.validate(function(u,c){var p,l,h;return u||c.length?(n.get("lifecycle").failedValidation(),h=u||c,"function"==typeof e&&e(h,n),i(h)):(n.fire("validated"),p=n.constructor._batman.get("associations"),n._withoutDirtyTracking(function(){var t;return null!=p?null!=(t=p.getByType("belongsTo"))?t.forEach(function(t){return function(e){return e.apply(t)}}(this)):void 0:void 0}),l=b({},t,{data:t}),n._doStorageOperation(s,l,function(t,s,u){return null!=t?t instanceof a?n.get("lifecycle").failedValidation():n.get("lifecycle").error():(n.get("dirtyKeys").clear(),n.get("_dirtiedKeys").clear(),p&&s._withoutDirtyTracking(function(){var e,r;return null!=(e=p.getByType("hasOne"))&&e.forEach(function(e){return e.apply(t,s)}),null!=(r=p.getByType("hasMany"))?r.forEach(function(e){return e.apply(t,s)}):void 0}),s.isTransaction||(s=n.constructor._mapIdentity(s)),n.get("lifecycle").startTransition(r)),"function"==typeof e&&e(t,s||n,u),null!=t?i(t):o(s)}))})}}(this)):(n=new d.InvalidTransitionError("Can't save while in state "+this.get("lifecycle.state")),"function"==typeof e&&e(n),Promise.reject(n))},C.prototype.destroy=function(t,e){var r,n;return e||(n=[{},t],t=n[0],e=n[1]),this.get("lifecycle").destroy()?new Promise(function(r){return function(n,o){var i;return i=B({},t,{data:t}),r._doStorageOperation("destroy",i,function(t,i,s){return t?r.get("lifecycle").error():(r.constructor.get("loaded").remove(r),r.get("lifecycle").destroyed()),"function"==typeof e&&e(t,i,s),null!=t?o(t):n(i)})}}(this)):(r=new d.InvalidTransitionError("Can't destroy while in state "+this.get("lifecycle.state")),"function"==typeof e&&e(r),Promise.reject(r))},C.prototype.validate=function(t){var e,r,n,o,i,s,a,u,c,p,l,h,f,d;if(i=this.get("errors"),i.clear(),c=this._batman.get("validators")||[],!c||0===c.length)return"function"==typeof t&&t(void 0,i),!0;for(n=c.reduce(function(t,e){return t+e.keys.length},0),s=function(e){return null==e&&(e=1),n-=e,0===n?"function"==typeof t?t(void 0,i):void 0:void 0},p=0,h=c.length;h>p;p++)if(u=c[p],!u["if"]||(r="string"==typeof u["if"]?this.get(u["if"]):u["if"].call(this,i,this,a)))if(u.unless&&(r="string"==typeof u.unless?this.get(u.unless):u.unless.call(this,i,this,a)))s(u.keys.length);else for(d=u.keys,l=0,f=d.length;f>l;l++){a=d[l],e=[i,this,a,s];try{u.validator?u.validator.validateEach.apply(u.validator,e):u.callback.apply(u,e)}catch(y){o=y,"function"==typeof t&&t(o,i)}}else s(u.keys.length)},C.prototype.associationProxy=function(t){var e,r,n;return this.initializeBatman(),e=(r=this._batman).associationProxies||(r.associationProxies={}),e[n=t.label]||(e[n]=new t.proxyClass(t,this)),e[t.label]},C.prototype._willSet=function(t){return this._pauseDirtyTracking?!0:this.get("lifecycle").startTransition("set")?(this.get("_dirtiedKeys").has(t)||(this.set("dirtyKeys."+t,this.get(t)),this.get("_dirtiedKeys").add(t)),!0):!1},C.prototype._associationForAttribute=function(t){var e;return null!=(e=this.constructor._batman.get("associations"))?e.get(t):void 0},C.prototype._doStorageOperation=function(t,e,r){var n;return _.assert(this.hasStorage(),"Can't "+t+" model "+w(this.constructor)+" without any storage adapters!"),n=this._batman.get("storage"),n.perform(t,this,e,function(){return function(){return r.apply(null,arguments)}}(this))},C.prototype._withoutDirtyTracking=function(t){var e;return this._pauseDirtyTracking?t.call(this):(this._pauseDirtyTracking=!0,e=t.call(this),this._pauseDirtyTracking=!1,e)},S=["load","save","validate","destroy"],n=0,v=S.length;v>n;n++)e=S[n],C.prototype[e]=p.wrapTrackingPrevention(C.prototype[e]);return C.prototype.reflectOnAllAssociations=function(t){var e;return e=this.constructor._batman.get("associations"),null!=t?null!=e?e.getByType(t):void 0:null!=e?e.getAll():void 0},C.prototype.reflectOnAssociation=function(t){var e;return null!=(e=this.constructor._batman.get("associations"))?e.getByLabel(t):void 0},C.prototype.transaction=function(){return this._transaction([],[])},C.prototype._transaction=function(t,e){var r,n,i,s,a,u,c,p,l,h,f;if(i=t.indexOf(this),-1!==i)return e[i];if(t.push(this),e.push(c=new this.constructor),n=this.reflectOnAllAssociations("hasMany"))for(n=n.filter(function(t){return t.options.includeInTransaction}),f=n.mapToProperty("label"),l=0,h=f.length;h>l;l++)a=f[l],this.get(a);r=this.get("attributes").toObject();for(s in r)P.call(r,s)&&(p=r[s],p instanceof C&&!p.isTransaction?r[s]=p._transaction(t,e):p instanceof o&&!p.isTransaction?(u=new m(p,t,e),r[s]=u):"Object"===A(p)&&_.warn("You're passing a mutable object ("+s+", "+w(p.constructor)+") in a "+this.constructor.name+" transaction:",p));c._withoutDirtyTracking(function(){return c.updateAttributes(r)}),c._batman.base=this;for(s in y)p=y[s],c[s]=p;return c.accessor("isTransaction",function(){return this.isTransaction}),c.accessor("base",function(){return this.base()}),c},C}(i),k=n.availableAssociations,E=function(){return function(t){return c[t]=function(e,r){var o,i;return this.initializeBatman(),o=(i=this._batman).associations||(i.associations=new n(this)),o.add(new(Batman[""+O.titleize(t)+"Association"])(this,e,r))}}}(this),S=0,C=k.length;C>S;S++)v=k[S],E(v);t.exports=c},function(t,e,r){var n;n={translate:function(t,e){var r;return null==e&&(e={}),r=Batman.get(Batman.translate.messages,t),Batman.helpers.interpolate(r,e)},t:function(){return Batman.translate.apply(Batman,arguments)}},n.translate.messages=r(64),t.exports=n},function(t,e,r){var n,o,i,s,a,u,c;c=r(1),o=c.developer,s=c.functionName,u=c.mixin,i=c.extend,a=r(2).helpers,t.exports=n=function(){function t(t,e,r){var n,c,p;this.model=t,this.label=e,null==r&&(r={}),null!=r.extend&&i(this,r.extend),this.options=u({},this.provideDefaults(),r),this.options.nestUrl&&(null==this.model.urlNestsUnder&&o.error("You must persist the model "+s(this.model)+" to use the url helpers on an association"),this.model.urlNestsUnder(a.underscore(this.getRelatedModel().get("resourceName")))),c={encode:this.options.saveInline?this.encoder():!1,decode:this.decoder()},this.model.encode(this.options.encoderKey,c),n=this,p=function(){return n.getAccessor.call(this,n,this.model,this.label)},this.model.accessor(this.label,{get:p,set:t.defaultAccessor.set,unset:t.defaultAccessor.unset})}return t.prototype.associationType="",t.prototype.isPolymorphic=!1,t.prototype.provideDefaults=function(){return{encoderKey:this.label,saveInline:!1,autoload:!0,nestUrl:!1,includeInTransaction:!0,encodeWithIndexes:!1}},t.prototype.scope=function(){return this.options.namespace||Batman.currentApp},t.prototype.getRelatedModel=function(){var t,e,r;return r=this.scope(),t=this.options.name,e=null!=r?r[t]:void 0,o["do"](function(){var r,n;return e||"test"===Batman.env?void 0:(r=(null!=(n=this.options)?n.namespace:void 0)?""+this.options.namespace+".":"Batman.currentApp. Is your app running with `MyApp.run()`?",o.warn("Related model "+t+" wasn't found in namespace "+r))}),e},t.prototype.getFromAttributes=function(t){return t.get("attributes."+this.label)},t.prototype.setIntoAttributes=function(t,e){return t.get("attributes").set(this.label,e)},t.prototype.inverse=function(){var t,e;return(e=this.getRelatedModel()._batman.get("associations"))?this.options.inverseOf?e.getByLabel(this.options.inverseOf):(t=null,e.forEach(function(e){return function(r,n){return n.getRelatedModel()===e.model?t=n:void 0}}(this)),t):void 0},t.prototype.reset=function(){return delete this.index,!0},t}()},function(t,e,r){var n,o,i,s,a,u,c,p={}.hasOwnProperty,l=function(t,e){function n(){this.constructor=t}for(var r in e)p.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(25),s=r(37),c=r(1),o=c.Property,u=c.mixin,a=r(2).helpers,t.exports=i=function(t){function e(t,r,n){this.model=t,this.label=r,null==n&&(n={}),e.__super__.constructor.apply(this,arguments),this.foreignKey=this.options.foreignKey,this.primaryKey=this.options.primaryKey}return l(e,t),e.prototype.isSingular=!0,e.prototype.provideDefaults=function(){return u(e.__super__.provideDefaults.apply(this,arguments),{name:a.camelize(this.label)})},e.prototype.getAccessor=function(t){var n,i,s;return(s=t.getFromAttributes(this))?s:(t.getRelatedModel()&&(i=this.associationProxy(t),n=o.withoutTracking(function(){return i.get("loaded")}),!n&&t.options.autoload&&o.withoutTracking(function(){return i.load()})),i)},e.prototype.setIndex=function(){return this.index||(this.index=new s(this,this[this.indexRelatedModelOn]))},e}(n)},function(t,e,r){var n,o,i,s,a,u={}.hasOwnProperty,c=function(t,e){function n(){this.constructor=t}for(var r in e)u.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};s=r(26),o=r(40),i=r(31),a=r(1).mixin,t.exports=n=function(t){function e(t,r,n){return(null!=n?n.polymorphic:void 0)?(delete n.polymorphic,function(t,e,r){r.prototype=t.prototype;var n=new r,o=t.apply(n,e);return Object(o)===o?o:n}(Batman.PolymorphicBelongsToAssociation,arguments,function(){})):(e.__super__.constructor.apply(this,arguments),this.options.encodeForeignKey&&this.model.encode(this.foreignKey),void 0)}return c(e,t),e.prototype.associationType="belongsTo",e.prototype.proxyClass=o,e.prototype.indexRelatedModelOn="primaryKey",e.prototype.provideDefaults=function(){return a(e.__super__.provideDefaults.apply(this,arguments),{encodeForeignKey:!0,foreignKey:""+this.label+"_id",primaryKey:"id"})},e.prototype.encoder=function(){return function(t){return t.toJSON()}},e.prototype.decoder=function(){var t;return t=this,function(e,r,n,o,s){var a,u,c;return c=t.getRelatedModel(),u=c.createFromJSON(e),t.options.inverseOf&&(a=t.inverse())&&(a instanceof i?s.set(t.foreignKey,u.get(t.primaryKey)):u.set(a.label,s)),s.set(t.label,u),u}},e.prototype.apply=function(t){var e,r;return(r=t.get(this.label))&&(e=r.get(this.primaryKey),void 0!==e)?t.set(this.foreignKey,e):void 0},e}(s)},function(t,e,r){var n,o,i,s,a,u,c,p,l,h,f={}.hasOwnProperty,d=function(t,e){function n(){this.constructor=t}for(var r in e)f.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(27),i=r(41),a=r(38),s=r(32),h=r(1),u=h.Property,c=h.developer,l=h.mixin,p=r(2).helpers,t.exports=o=function(t){function e(){e.__super__.constructor.apply(this,arguments),this.foreignTypeKey=this.options.foreignTypeKey,this.options.encodeForeignTypeKey&&this.model.encode(this.foreignTypeKey),this.typeIndices={}}return d(e,t),e.prototype.isPolymorphic=!0,e.prototype.proxyClass=i,e.prototype.getRelatedModel=!1,e.prototype.setIndex=!1,e.prototype.inverse=!1,e.prototype.provideDefaults=function(){return l(e.__super__.provideDefaults.apply(this,arguments),{encodeForeignTypeKey:!0,foreignTypeKey:""+this.label+"_type"})},e.prototype.apply=function(t){var r,n;return e.__super__.apply.apply(this,arguments),(n=t.get(this.label))?(r=n instanceof i?n.get("foreignTypeValue"):n.constructor.get("resourceName"),t.set(this.foreignTypeKey,r)):void 0},e.prototype.getAccessor=function(t){var n,o;return(o=t.getFromAttributes(this))?o:t.getRelatedModelForType(this.get(t.foreignTypeKey))?(n=this.associationProxy(t),u.withoutTracking(function(){return!n.get("loaded")&&t.options.autoload?n.load():void 0}),n):void 0},e.prototype.url=function(t){var e,r,n,o,i,s,a,u;return s=null!=(a=t.data)?a[this.foreignTypeKey]:void 0,s&&(o=this.inverseForType(s))?(i=p.pluralize(s).toLowerCase(),n=null!=(u=t.data)?u[this.foreignKey]:void 0,r=o.isSingular?"singularize":"pluralize",e=p[r](o.label),"/"+i+"/"+n+"/"+e):void 0},e.prototype.getRelatedModelForType=function(t){var e,r;return r=this.scope(),t&&(e=null!=r?r[t]:void 0,e||(e=null!=r?r[p.camelize(t)]:void 0)),c["do"](function(){return null==Batman.currentApp||e?void 0:c.warn("Related model "+t+" for belongsTo polymorphic association "+this.label+" not found.")}),e},e.prototype.setIndexForType=function(t){var e;return(e=this.typeIndices)[t]||(e[t]=new a(this,t,this.primaryKey)),this.typeIndices[t]},e.prototype.inverseForType=function(t){var e,r,n;return(r=null!=(n=this.getRelatedModelForType(t))?n._batman.get("associations"):void 0)?this.options.inverseOf?r.getByLabel(this.options.inverseOf):(e=null,r.forEach(function(t){return function(r,n){return n.getRelatedModel()===t.model?e=n:void 0
}}(this)),e):void 0},e.prototype.decoder=function(){var t;return t=this,function(e,r,n,o,i){var a,u,c,p;return a=n[t.foreignTypeKey]||i.get(t.foreignTypeKey),p=t.getRelatedModelForType(a),c=p.createFromJSON(e),t.options.inverseOf&&(u=t.inverseForType(a))&&(u instanceof s?(i.set(t.foreignKey,c.get(t.primaryKey)),i.set(t.foreignTypeKey,a)):c.set(u.label,i)),i.set(t.label,c),c}},e}(n)},function(t,e,r){var n,o,i,s,a,u={}.hasOwnProperty,c=function(t,e){function n(){this.constructor=t}for(var r in e)u.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};i=r(26),o=r(42),s=r(2).helpers,a=r(1).mixin,t.exports=n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return c(e,t),e.prototype.associationType="hasOne",e.prototype.proxyClass=o,e.prototype.indexRelatedModelOn="foreignKey",e.prototype.provideDefaults=function(){return a(e.__super__.provideDefaults.apply(this,arguments),{primaryKey:"id",foreignKey:""+s.underscore(this.model.get("resourceName"))+"_id"})},e.prototype.apply=function(t,e){var r;return!t&&(r=this.getFromAttributes(e))?r.set(this.foreignKey,e.get(this.primaryKey)):void 0},e.prototype.encoder=function(){var t;return t=this,function(e,r,n,o){var i;if(t.options.saveInline)return(i=e.toJSON())&&(i[t.foreignKey]=o.get(t.primaryKey)),i}},e.prototype.decoder=function(){var t;return t=this,function(e,r,n,o,i){var s,a;if(e)return a=t.getRelatedModel(),s=a.createFromJSON(e),t.options.inverseOf&&s.set(t.options.inverseOf,i),s}},e}(i)},function(t,e,r){var n,o,i,s,a,u,c,p,l,h={}.hasOwnProperty,f=function(t,e){function n(){this.constructor=t}for(var r in e)h.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(25),o=r(33),i=r(35),l=r(1),a=l.Property,u=l.SimpleHash,p=l.mixin,c=r(2).helpers,t.exports=s=function(t){function e(t,r,n){this.model=t,this.label=r,null==n&&(n={}),e.__super__.constructor.apply(this,arguments),this._resetSetHashes()}return f(e,t),e.prototype.proxyClass=o,e.prototype.isSingular=!1,e.prototype.provideDefaults=function(){return p(e.__super__.provideDefaults.apply(this,arguments),{name:c.camelize(c.singularize(this.label))})},e.prototype.setForRecord=function(t){var e,r;return r=this.indexValueForRecord(t),e=this.setIndex(),a.withoutTracking(function(e){return function(){return e._setsByRecord.getOrSet(t,function(){var t,n;return null!=r&&(t=e._setsByValue.get(r),null!=t)?t:(n=e.proxyClassInstanceForKey(r),null!=r&&e._setsByValue.set(r,n),n)})}}(this)),null!=r?e.get(r):this._setsByRecord.get(t)},e.prototype.setForKey=a.wrapTrackingPrevention(function(t){var e,r;return r=this._setsByRecord.find(function(e){return function(r){return e.indexValueForRecord(r)===t}}(this)),null!=r?(e=this._setsByRecord.get(r),e.foreignKeyValue=t,e):this._setsByValue.getOrSet(t,function(e){return function(){return e.proxyClassInstanceForKey(t)}}(this))}),e.prototype.proxyClassInstanceForKey=function(t){return new this.proxyClass(t,this)},e.prototype.getAccessor=function(t){var n,o;if(t.getRelatedModel())return(o=t.getFromAttributes(this))?o:(n=t.setForRecord(this),t.setIntoAttributes(this,n),a.withoutTracking(function(e){return function(){return!t.options.autoload||e.isNew()||n.loaded?void 0:n.load(function(t){if(t)throw t})}}(this)),n)},e.prototype.parentSetIndex=function(){return this.parentIndex||(this.parentIndex=this.model.get("loaded").indexedByUnique(this.primaryKey)),this.parentIndex},e.prototype.setIndex=function(){return this.index||(this.index=new i(this,this[this.indexRelatedModelOn])),this.index},e.prototype.indexValueForRecord=function(t){return t.get(this.primaryKey)},e.prototype.reset=function(){return e.__super__.reset.apply(this,arguments),this._resetSetHashes()},e.prototype._resetSetHashes=function(){return this._setsByRecord=new u,this._setsByValue=new u},e}(n)},function(t,e,r){var n,o,i,s,a,u,c,p={}.hasOwnProperty,l=function(t,e){function n(){this.constructor=t}for(var r in e)p.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=r(30),c=r(1),i=c.Property,s=c.developer,u=c.mixin,a=r(2).helpers,t.exports=n=function(t){function e(t,r,n){return(null!=n?n.as:void 0)?function(t,e,r){r.prototype=t.prototype;var n=new r,o=t.apply(n,e);return Object(o)===o?o:n}(Batman.PolymorphicHasManyAssociation,arguments,function(){}):(e.__super__.constructor.apply(this,arguments),this.primaryKey=this.options.primaryKey,this.foreignKey=this.options.foreignKey,void 0)}return l(e,t),e.prototype.associationType="hasMany",e.prototype.indexRelatedModelOn="foreignKey",e.prototype.provideDefaults=function(){return u(e.__super__.provideDefaults.apply(this,arguments),{primaryKey:"id",foreignKey:""+a.underscore(this.model.get("resourceName"))+"_id",replaceFromJSON:!0})},e.prototype.apply=function(t,e){var r,n,o;return t||((n=this.getFromAttributes(e))&&(r=e.get(this.primaryKey),n.forEach(function(t){return function(e){return e.set(t.foreignKey,r)}}(this))),e.set(this.label,o=this.setForRecord(e)),"creating"!==e.lifecycle.get("state"))?void 0:o.markAsLoaded()},e.prototype.encoder=function(){return this.options.encodeWithIndexes?this._objectEncoder.bind(this):this._arrayEncoder.bind(this)},e.prototype._objectEncoder=function(t,e,r,n){var o,i,s,a;if(null!=t){i={},t instanceof Array||(t=t.toArray());for(o in t)s=t[o],a=s.toJSON(),(!this.inverse()||this.inverse().options.encodeForeignKey)&&(a[this.foreignKey]=n.get(this.primaryKey)),i[o]=a;return i}},e.prototype._arrayEncoder=function(t,e,r,n){var o;return null!=t?(o=[],t.forEach(function(t){return function(e){var r;return r=e.toJSON(),(!t.inverse()||t.inverse().options.encodeForeignKey)&&(r[t.foreignKey]=n.get(t.primaryKey)),o.push(r)}}(this)),o):void 0},e.prototype.decoder=function(){var t;return t=this,function(e,r,n,o,i){var a,u,c,p,l,h,f,d,y;if(!(y=t.getRelatedModel()))return s.error("Can't decode model "+t.options.name+" because it hasn't been loaded yet!"),void 0;u=t.setForRecord(i),h=u.filter(function(t){return t.isNew()}).toArray(),d=[],a=[];for(c in e)l=e[c],p=l[y.primaryKey],f=y._loadIdentity(p),null==f&&(f=h.length>0?h.shift():new y,null!=p&&d.push(f)),a.push(f),f._withoutDirtyTracking(function(){return this.fromJSON(l),t.options.inverseOf?f.set(t.options.inverseOf,i):void 0});return y.get("loaded").addArray(d),t.options.replaceFromJSON?u.replace(a):u.addArray(a),u.markAsLoaded(),u}},e}(o)},function(t,e,r){var n,o,i,s,a,u,c,p,l={}.hasOwnProperty,h=function(t,e){function n(){this.constructor=t}for(var r in e)l.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(31),o=r(34),i=r(36),p=r(1),a=p.developer,c=p.mixin,u=r(2).helpers,t.exports=s=function(t){function e(t,r,n){this.foreignLabel=n.as,delete n.as,e.__super__.constructor.call(this,t,r,n),this.foreignTypeKey=n.foreignTypeKey||""+this.foreignLabel+"_type",this.model.encode(this.foreignTypeKey)}return h(e,t),e.prototype.proxyClass=o,e.prototype.isPolymorphic=!0,e.prototype.provideDefaults=function(){return c({},e.__super__.provideDefaults.apply(this,arguments),{inverseOf:this.foreignLabel,foreignKey:""+this.foreignLabel+"_id"})},e.prototype.apply=function(t,r){var n;t||(n=this.getFromAttributes(r))&&(e.__super__.apply.apply(this,arguments),n.forEach(function(t){return function(e){return e.set(t.foreignTypeKey,t.modelType())}}(this)))},e.prototype.proxyClassInstanceForKey=function(t){return new this.proxyClass(t,this.modelType(),this)},e.prototype.getRelatedModelForType=function(t){var e,r;return r=this.scope(),t?(e=null!=r?r[t]:void 0,e||(e=null!=r?r[u.camelize(t)]:void 0)):e=this.getRelatedModel(),a["do"](function(){return null==Batman.currentApp||e?void 0:a.warn("Related model "+t+" for hasMany polymorphic association "+this.label+" not found.")}),e},e.prototype.modelType=function(){return this.model.get("resourceName")},e.prototype.setIndex=function(){return this.typeIndex||(this.typeIndex=new i(this,this.modelType(),this[this.indexRelatedModelOn]))},e.prototype.encoder=function(){var t;return t=this,function(e,r,n,o){var i;return null!=e&&(i=[],e.forEach(function(e){var r;return r=e.toJSON(),r[t.foreignKey]=o.get(t.primaryKey),r[t.foreignTypeKey]=t.modelType(),i.push(r)})),i}},e.prototype.decoder=function(){var t;return t=this,function(e,r,n,o,i){var s,u,c,p,l,h,f,d,y,m;for(u=t.getFromAttributes(i)||t.setForRecord(i),l=u.filter(function(t){return t.isNew()}).toArray(),s=[],y=0,m=e.length;m>y;y++){if(p=e[y],d=p[t.options.foreignTypeKey],!(f=t.getRelatedModelForType(d)))return a.error("Can't decode model "+t.options.name+" because it hasn't been loaded yet!"),void 0;c=p[f.primaryKey],h=f._loadIdentity(c),null!=h?(h._withoutDirtyTracking(function(){return this.fromJSON(p)}),s.push(h)):(l.length>0?(h=l.shift(),h._withoutDirtyTracking(function(){return this.fromJSON(p)}),h=f._mapIdentity(h)):h=f.createFromJSON(p),s.push(h)),t.options.inverseOf&&h._withoutDirtyTracking(function(){return h.set(t.options.inverseOf,i)})}return t.options.replaceFromJSON?u.replace(s):u.addArray(s),u.markAsLoaded(),u}},e}(n)},function(t,e,r){var n,o,i,s,a,u,c={}.hasOwnProperty,p=function(t,e){function n(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};u=r(1),s=u.SetSort,i=u.Set,o=u.Property,a=u.extend,t.exports=n=function(t){function e(t,r){var n;this.foreignKeyValue=t,this.association=r,n=new i,e.__super__.constructor.call(this,n,"_batmanID")}return p(e,t),e.prototype.loaded=!1,e.accessor("loaded",o.defaultAccessor),e.prototype.load=function(t,e){var r;return r=this._getLoadOptions(),e?r.data=a(r.data,t):e=t,null==this.foreignKeyValue?("function"==typeof e&&e(void 0,this),Promise.resolve(this)):this.association.getRelatedModel().loadWithOptions(r,function(t){return function(r,n,o){return r||t.markAsLoaded(),"function"==typeof e?e(r,t,o):void 0}}(this))},e.prototype._getLoadOptions=function(){var t;return t={data:{}},t.data[this.association.foreignKey]=this.foreignKeyValue,this.association.options.url&&(t.collectionUrl=this.association.options.url,t.urlContext=this.get("parentRecord")),t},e.prototype.markAsLoaded=function(){return this.set("loaded",!0),this.fire("loaded")},e.accessor("parentRecord",function(){return this.association.parentSetIndex().get(this.foreignKeyValue)}),e.prototype.build=function(t){var e,r,n,o,i;return null==t&&(t={}),r={},r[this.association.foreignKey]=this.foreignKeyValue,i=this.association.options,null!=i.inverseOf&&(r[i.inverseOf]=this.get("parentRecord")),e=this.association.getRelatedModel(),n=a(r,t),o=new e(n),this.add(o),o},e}(s)},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(33),t.exports=o=function(t){function e(t,r,n){this.foreignKeyValue=t,this.foreignTypeKeyValue=r,this.association=n,e.__super__.constructor.call(this,this.foreignKeyValue,this.association)}return s(e,t),e.prototype._getLoadOptions=function(){var t;return t={data:{}},t.data[this.association.foreignKey]=this.foreignKeyValue,t.data[this.association.foreignTypeKey]=this.foreignTypeKeyValue,this.association.options.url&&(t.collectionUrl=this.association.options.url,t.urlContext=this.association.parentSetIndex().get(this.foreignKeyValue)),t},e}(n)},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=r(1).SetIndex,t.exports=n=function(t){function e(t,r){this.association=t,e.__super__.constructor.call(this,this.association.getRelatedModel().get("loaded"),r)}return s(e,t),e.prototype._resultSetForKey=function(t){return this.association.setForKey(t)},e.prototype.forEach=function(t,e){return this.association.proxies.forEach(function(r){return function(n,o){var i;return i=r.association.indexValueForRecord(n),o.get("length")>0?t.call(e,i,o,r):void 0}}(this))},e.prototype.toArray=function(){var t;return t=[],this.forEach(function(e){return t.push(e)}),t},e}(o)},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=r(1).SetIndex,t.exports=n=function(t){function e(t,r,n){this.association=t,this.type=r,e.__super__.constructor.call(this,this.association.getRelatedModel().get("loaded"),n)}return s(e,t),e.prototype._resultSetForKey=function(t){return this.association.setForKey(t)},e.prototype._addItemsToKey=function(t,r){return e.__super__._addItemsToKey.call(this,t,this._filteredItems(r))},e.prototype._removeItemsFromKey=function(t,r){return e.__super__._removeItemsFromKey.call(this,t,this._filteredItems(r))},e.prototype._filteredItems=function(t){var e,r,n,o;for(o=[],r=0,n=t.length;n>r;r++)e=t[r],this.type===e.get(this.association.foreignTypeKey)&&o.push(e);return o},e}(o)},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=r(1).UniqueSetIndex,t.exports=n=function(t){function e(t,r){this.association=t,e.__super__.constructor.call(this,this.association.getRelatedModel().get("loaded"),r)}return s(e,t),e}(o)},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=r(1).UniqueSetIndex,t.exports=n=function(t){function e(t,r,n){this.association=t,this.type=r,e.__super__.constructor.call(this,this.association.getRelatedModelForType(r).get("loaded"),n)}return s(e,t),e}(o)},function(t,e,r){var n,o,i,s,a={}.hasOwnProperty,u=function(t,e){function n(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};s=r(1),i=s.Proxy,o=s.Property,t.exports=n=function(t){function e(t,r){this.association=t,this.model=r,e.__super__.constructor.call(this)}return u(e,t),e.prototype.loaded=!1,e.delegatesToTarget("toJSON","destroy","save","transaction","validate"),e.prototype.load=function(t){return this.fetch(function(e){return function(r,n){return r||e._setTarget(n),"function"==typeof t?t(r,n):void 0}}(this))},e.prototype.loadFromLocal=function(){var t;if(this._canLoad())return(t=this.fetchFromLocal())&&this._setTarget(t),t},e.prototype.fetch=function(t){var e;return this._canLoad()?(e=this.fetchFromLocal())?(t(void 0,e),Promise.resolve(e)):new Promise(function(e){return function(r,n){return e.fetchFromRemote(function(e,o){return"function"==typeof t&&t(e,o),null!=e?n(e):r(o)})}}(this)):(t(void 0,void 0),Promise.reject(void 0))},e.accessor("loaded",o.defaultAccessor),e.accessor("target",{get:function(){return this.fetchFromLocal()},set:function(t,e){return e}}),e.prototype._canLoad=function(){return null!=(this.get("foreignValue")||this.get("primaryValue"))},e.prototype._setTarget=function(t){return this.set("target",t),this.set("loaded",!0),this.fire("loaded",t)},e}(i)},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(39),t.exports=o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.accessor("foreignValue",function(){return this.model.get(this.association.foreignKey)}),e.prototype.fetchFromLocal=function(){return this.association.setIndex().get(this.get("foreignValue"))},e.prototype.fetchFromRemote=function(t){var e;return e={},this.association.options.url&&(e.recordUrl=this.association.options.url),this.association.getRelatedModel().findWithOptions(this.get("foreignValue"),e,t)},e}(n)},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(40),t.exports=o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.accessor("foreignTypeValue",function(){return this.model.get(this.association.foreignTypeKey)}),e.prototype.fetchFromLocal=function(){return this.association.setIndexForType(this.get("foreignTypeValue")).get(this.get("foreignValue"))},e.prototype.fetchFromRemote=function(t){var e;return e={},this.association.options.url&&(e.recordUrl=this.association.options.url),this.association.getRelatedModelForType(this.get("foreignTypeValue")).findWithOptions(this.get("foreignValue"),e,t)},e}(n)},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(39),t.exports=o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.accessor("primaryValue",function(){return this.model.get(this.association.primaryKey)}),e.prototype.fetchFromLocal=function(){return this.association.setIndex().get(this.get("primaryValue"))},e.prototype.fetchFromRemote=function(t){var e;return e={data:{}},e.data[this.association.foreignKey]=this.get("primaryValue"),this.association.options.url&&(e.collectionUrl=this.association.options.url,e.urlContext=this.model),this.association.getRelatedModel().loadWithOptions(e,function(){return function(e,r){return!r||0>=r.length?t(e||Error("Couldn't find related record!"),void 0):t(void 0,r[0])}}(this))},e}(n)},function(t,e,r){var n,o,i,s,a,u={}.hasOwnProperty,c=function(t,e){function n(){this.constructor=t}for(var r in e)u.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},p=[].slice;a=r(1),o=a.SimpleHash,i=a.SimpleSet,s=r(2).StateMachine,t.exports=n=function(t){function e(t){this.model=t,e.__super__.constructor.call(this),this._byTypeStorage=new o}return c(e,t),e.availableAssociations=["belongsTo","hasOne","hasMany"],e.prototype.add=function(t){var e;return this.set(t.label,t),(e=this._byTypeStorage.get(t.associationType))||(e=new i,this._byTypeStorage.set(t.associationType,e)),e.add(t)},e.prototype.getByType=function(t){return this._byTypeStorage.get(t)},e.prototype.getByLabel=function(t){return this.get(t)},e.prototype.getAll=function(){var t,e,r;return e=this._byTypeStorage.map(function(t,e){return e}),t=(r=new i).merge.apply(r,e)},e.prototype.reset=function(){return this.forEach(function(t,e){return e.reset()}),!0},e.prototype.merge=function(){var t,r;return t=arguments.length>=1?p.call(arguments,0):[],r=e.__super__.merge.apply(this,arguments),r._byTypeStorage=this._byTypeStorage.merge(t.map(function(t){return t._byTypeStorage})),r},e.prototype._markDirtyAttribute=function(t,e){var r;if("loading"!==(r=this.lifecycle.get("state"))&&"creating"!==r&&"saving"!==r&&"saved"!==r){if(this.lifecycle.startTransition("set"))return this.dirtyKeys.set(t,e);throw new s.InvalidTransitionError("Can't set while in state "+this.lifecycle.get("state"))}},e}(o)},function(t,e,r){var n,o,i,s,a,u={}.hasOwnProperty,c=function(t,e){function n(){this.constructor=t}for(var r in e)u.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},p=[].slice;a=r(1),n=a.BatmanObject,i=a.extend,s=r(2).helpers,t.exports=o=function(t){function e(t){var r;e.__super__.constructor.call(this,{model:t}),r=this.constructor,r.ModelMixin&&i(t,r.ModelMixin),r.RecordMixin&&i(t.prototype,r.RecordMixin)}return c(e,t),e.StorageError=function(t){function e(t){e.__super__.constructor.apply(this,arguments),this.message=t}return c(e,t),e.prototype.name="StorageError",e.prototype.toJSON=function(){var t,e,r,n,o;return t=this.env.action,n=null!=this.env.subject.toJSON?this.env.subject.toJSON():"resourceName: "+this.env.subject.resourceName,e={name:this.name,message:this.message,action:t,subject:n},(r=null!=(o=this.request)?o.toJSON():void 0)&&(delete r.xhr,e.request=r),e},e}(Error),e.RecordExistsError=function(t){function e(t){e.__super__.constructor.call(this,t||"Can't create this record because it already exists in the store!")}return c(e,t),e.prototype.name="RecordExistsError",e}(e.StorageError),e.NotFoundError=function(t){function e(t){e.__super__.constructor.call(this,t||"Record couldn't be found in storage!")}return c(e,t),e.prototype.name="NotFoundError",e}(e.StorageError),e.UnauthorizedError=function(t){function e(t){e.__super__.constructor.call(this,t||"Storage operation denied due to invalid credentials!")}return c(e,t),e.prototype.name="UnauthorizedError",e}(e.StorageError),e.NotAllowedError=function(t){function e(t){e.__super__.constructor.call(this,t||"Storage operation denied access to the operation!")}return c(e,t),e.prototype.name="NotAllowedError",e}(e.StorageError),e.NotAcceptableError=function(t){function e(t){e.__super__.constructor.call(this,t||"Storage operation permitted but the request was malformed!")}return c(e,t),e.prototype.name="NotAcceptableError",e}(e.StorageError),e.EntityTooLargeError=function(t){function e(t){e.__super__.constructor.call(this,t||"Storage operation denied due to size constraints!")}return c(e,t),e.prototype.name="EntityTooLargeError",e}(e.StorageError),e.UnprocessableRecordError=function(t){function e(t){e.__super__.constructor.call(this,t||"Storage adapter could not process the record!")}return c(e,t),e.prototype.name="UnprocessableRecordError",e}(e.StorageError),e.InternalStorageError=function(t){function e(t){e.__super__.constructor.call(this,t||"An error occurred during the storage operation!")}return c(e,t),e.prototype.name="InternalStorageError",e}(e.StorageError),e.NotImplementedError=function(t){function e(t){e.__super__.constructor.call(this,t||"This operation is not implemented by the storage adapter!")}return c(e,t),e.prototype.name="NotImplementedError",e}(e.StorageError),e.BadGatewayError=function(t){function e(t){e.__super__.constructor.call(this,t||"Storage operation failed due to unavailability of the backend!")}return c(e,t),e.prototype.name="BadGatewayError",e}(e.StorageError),e.prototype.isStorageAdapter=!0,e.prototype.onlyCertainAttributes=function(t,e){var r;for(r in t)0>e.indexOf(r)&&delete t[r];return t},e.prototype.exceptCertainAttributes=function(t,e){var r,n,o;for(n=0,o=e.length;o>n;n++)r=e[n],delete t[r];return t},e.prototype.storageKey=function(t){var e;return e=(null!=t?t.constructor:void 0)||this.model,e.get("storageKey")||s.pluralize(s.underscore(e.get("resourceName")))},e.prototype.getRecordFromData=function(t,e){return null==e&&(e=this.model),e.createFromJSON(t)},e.prototype.getRecordsFromData=function(t,e){return null==e&&(e=this.model),e.createMultipleFromJSON(t)},e.skipIfError=function(t){return function(e,r){return null!=e.error?r():t.call(this,e,r)}},e.prototype.before=function(){return this._addFilter.apply(this,["before"].concat(p.call(arguments)))},e.prototype.after=function(){return this._addFilter.apply(this,["after"].concat(p.call(arguments)))},e.prototype._inheritFilters=function(){var t,e,r,n,o;if(!(this._batman.check(this)&&this._batman.filters||(n=this._batman.getFirst("filters"),this._batman.filters={before:{},after:{}},null==n)))for(o in n){t=n[o];for(r in t)e=t[r],this._batman.filters[o][r]=e.slice(0)}return!0},e.prototype._addFilter=function(){var t,e,r,n,o,i,s,a;for(n=arguments[0],r=arguments.length>=3?p.call(arguments,1,i=arguments.length-1):(i=1,[]),t=arguments[i++],this._inheritFilters(),s=0,a=r.length;a>s;s++)e=r[s],(o=this._batman.filters[n])[e]||(o[e]=[]),this._batman.filters[n][e].push(t);return!0},e.prototype.runFilter=function(t,e,r,n){var o,i,s,a;return this._inheritFilters(),i=this._batman.filters[t].all||[],o=this._batman.filters[t][e]||[],r.action=e,s="before"===t?o.concat(i):i.concat(o),a=function(t){return function(e){var o;return null!=e&&(r=e),null!=(o=s.shift())?o.call(t,r,a):n.call(t,r)}}(this),a()},e.prototype.runBeforeFilter=function(){return this.runFilter.apply(this,["before"].concat(p.call(arguments)))},e.prototype.runAfterFilter=function(t,e,r){return this.runFilter("after",t,e,this.exportResult(r))},e.prototype.exportResult=function(t){return function(e){return t(e.error,e.result,e)}},e.prototype._jsonToAttributes=function(t){return JSON.parse(t)},e.prototype.perform=function(t,e,r,n){var o,i;return r||(r={}),o={options:r,subject:e},i=function(e){return function(r){return null!=r&&(o=r),e.runAfterFilter(t,o,n)}}(this),this.runBeforeFilter(t,o,function(e){return this[t](e,i)}),void 0},e.prototype.after("all",function(t,e){return null!=t.error&&(t.error.env=t,this.constructor.set("lastError",t.error)),e()}),e}(n)},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=r(44),t.exports=n=function(t){function e(){return window.localStorage===void 0?null:(e.__super__.constructor.apply(this,arguments),this.storage=localStorage,void 0)}return s(e,t),e.prototype.storageRegExpForRecord=function(t){return RegExp("^"+this.storageKey(t)+"(\\d+)$")},e.prototype.nextIdForRecord=function(t){var e,r;return r=this.storageRegExpForRecord(t),e=1,this._forAllStorageEntries(function(t){var o;return(o=r.exec(t))?e=Math.max(e,parseInt(o[1],10)+1):void 0}),e},e.prototype._forAllStorageEntries=function(t){var e,r,n,o;for(e=n=0,o=this.storage.length;o>=0?o>n:n>o;e=o>=0?++n:--n)r=this.storage.key(e),t.call(this,r,this.storage.getItem(r));return!0},e.prototype._storageEntriesMatching=function(t,e){var r,n;return r=this.storageRegExpForRecord(t.prototype),n=[],this._forAllStorageEntries(function(o,i){var s,a;return(a=r.exec(o))&&(s=this._jsonToAttributes(i),s[t.primaryKey]=a[1],this._dataMatches(e,s))?n.push(s):void 0}),n},e.prototype._dataMatches=function(t,e){var r,n,o;n=!0;for(r in t)if(o=t[r],e[r]!==o){n=!1;break}return n},e.prototype.before("read","create","update","destroy",e.skipIfError(function(t,e){return t.id="create"===t.action?t.subject.get("id")||t.subject._withoutDirtyTracking(function(e){return function(){return t.subject.set("id",e.nextIdForRecord(t.subject))}}(this)):t.subject.get("id"),null==t.id?t.error=new this.constructor.StorageError("Couldn't get/set record primary key on "+t.action+"!"):t.key=this.storageKey(t.subject)+t.id,e()})),e.prototype.before("create","update",e.skipIfError(function(t,e){var r;return r=t.subject.toJSON(),t.options.only&&(r=this.onlyCertainAttributes(r,t.options.only)),t.options.except&&(r=this.exceptCertainAttributes(r,t.options.except)),t.recordAttributes=JSON.stringify(r),e()})),e.prototype.after("read",e.skipIfError(function(t,e){var r;if("string"==typeof t.recordAttributes)try{t.recordAttributes=this._jsonToAttributes(t.recordAttributes)}catch(n){return r=n,t.error=r,e()}return t.subject._withoutDirtyTracking(function(){return this.fromJSON(t.recordAttributes)}),e()})),e.prototype.after("read","create","update","destroy",e.skipIfError(function(t,e){return t.result=t.subject,e()})),e.prototype.after("readAll",e.skipIfError(function(t,e){return t.result=t.records=this.getRecordsFromData(t.recordsAttributes,t.subject),e()})),e.prototype.read=e.skipIfError(function(t,e){return t.recordAttributes=this.storage.getItem(t.key),t.recordAttributes||(t.error=new this.constructor.NotFoundError),e()}),e.prototype.create=e.skipIfError(function(t,e){var r,n;return r=t.key,n=t.recordAttributes,this.storage.getItem(r)?arguments[0].error=new this.constructor.RecordExistsError:this.storage.setItem(r,n),e()}),e.prototype.update=e.skipIfError(function(t,e){var r,n;return r=t.key,n=t.recordAttributes,this.storage.setItem(r,n),e()}),e.prototype.destroy=e.skipIfError(function(t,e){var r;return r=t.key,this.storage.removeItem(r),e()}),e.prototype.readAll=e.skipIfError(function(t,e){var r;try{arguments[0].recordsAttributes=this._storageEntriesMatching(t.subject,t.options.data)}catch(n){r=n,arguments[0].error=r}return e()}),e}(o)},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(45),t.exports=o=function(t){function e(){return window.sessionStorage===void 0?null:(e.__super__.constructor.apply(this,arguments),this.storage=sessionStorage,void 0)}return s(e,t),e}(n)},function(t,e,r){var n,o,i,s,a,u,c={}.hasOwnProperty,p=function(t,e){function n(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},l=[].slice,h=[].indexOf||function(t){for(var e=0,r=this.length;r>e;e++)if(e in this&&this[e]===t)return e;return-1};o=r(44),u=r(1),i=u.extend,a=u.typeOf,s=r(2).helpers,t.exports=n=function(t){function c(){c.__super__.constructor.apply(this,arguments),this.defaultRequestOptions=i({},this.defaultRequestOptions)}var e,r,n,o,u;for(p(c,t),c.CommunicationError=function(t){function e(t){e.__super__.constructor.call(this,t||"A communication error has occurred!")}return p(e,t),e.prototype.name="CommunicationError",e}(c.StorageError),c.JSONContentType="application/json",c.PostBodyContentType="application/x-www-form-urlencoded",c.BaseMixin={request:function(t,e,r){return r||(r=e,e={}),e.method||(e.method="GET"),e.action=t,this._doStorageOperation(e.method.toLowerCase(),e,r)}},c.ModelMixin=i({},c.BaseMixin,{urlNestsUnder:function(){var t,e,r,n,o,i,u,c,p;for(n=arguments.length>=1?l.call(arguments,0):[],o={},i=0,c=n.length;c>i;i++)if(r=n[i],"Array"===a(r))for(t=r.join("-"),o[t]={},u=0,p=r.length;p>u;u++)e=r[u],o[t][e+"_id"]=s.pluralize(e);else o[r+"_id"]=s.pluralize(r);return this.url=function(t){var n,i,u,c,p;if(n=this.storageKey||s.pluralize(this.get("resourceName").toLowerCase()),null==t)return n;p="";for(r in o)if(c=o[r],"Object"===a(c)){for(e in c){if(i=c[e],u=t.data[e],!u){p="";break}delete t.data[e],p=""+p+i+"/"+u+"/"}if(""!==p)break}else if(u=t.data[r]){delete t.data[r],p=""+c+"/"+u+"/";break}return""+p+n},this.prototype.url=function(){var t,n,i,u,c,p;p="",t=this.constructor.storageKey||s.pluralize(this.constructor.get("resourceName").toLowerCase()),p="";for(r in o)if(c=o[r],"Object"===a(c)){for(e in c){if(n=c[e],u=this.get("dirtyKeys").get(e),void 0===u&&(u=this.get(e)),!u){p="";break}p=""+p+n+"/"+u+"/"}if(""!==p)break}else if(u=this.get("dirtyKeys").get(r),void 0===u&&(u=this.get(r)),u){p=""+c+"/"+u+"/";break}return p=""+p+t,(i=this.get("id"))&&(p+="/"+i),p}}}),c.RecordMixin=i({},c.BaseMixin),c.prototype.defaultRequestOptions={type:"json"},c.prototype._implicitActionNames=["create","read","update","destroy","readAll"],c.prototype.serializeAsForm=!0,c.prototype.recordJsonNamespace=function(t){return s.singularize(this.storageKey(t))},c.prototype.collectionJsonNamespace=function(t){return s.pluralize(this.storageKey(t.prototype))},c.prototype._execWithOptions=function(t,e,r,n){return null==n&&(n=t),"function"==typeof t[e]?t[e].call(n,r):t[e]},c.prototype._defaultCollectionUrl=function(t){return""+this.storageKey(t.prototype)},c.prototype._addParams=function(t,e){var r;return!e||!e.action||(r=e.action,h.call(this._implicitActionNames,r)>=0)||(t+="/"+e.action.toLowerCase()),t},c.prototype._addUrlAffixes=function(t,e,r){var n,o;return o=[t,this.urlSuffix(e,r)],"/"!==t.charAt(0)&&(n=this.urlPrefix(e,r),"/"!==n.charAt(n.length-1)&&o.unshift("/"),o.unshift(n)),o.join("")},c.prototype.urlPrefix=function(t,e){return this._execWithOptions(t,"urlPrefix",e.options)||""},c.prototype.urlSuffix=function(t,e){return this._execWithOptions(t,"urlSuffix",e.options)||""},c.prototype.urlForRecord=function(t,e){var r,n,o;if(null!=(o=e.options)?o.recordUrl:void 0)n=this._execWithOptions(e.options,"recordUrl",e.options,t);else if(t.url)n=this._execWithOptions(t,"url",e.options);else if(n=t.constructor.url?this._execWithOptions(t.constructor,"url",e.options):this._defaultCollectionUrl(t.constructor),"create"!==e.action){if(null==(r=t.get("id")))throw new this.constructor.StorageError("Couldn't get/set record primary key on "+e.action+"!");
n=n+"/"+r}return this._addUrlAffixes(this._addParams(n,e.options),t,e)},c.prototype.urlForCollection=function(t,e){var r,n;return r=(null!=(n=e.options)?n.collectionUrl:void 0)?this._execWithOptions(e.options,"collectionUrl",e.options,e.options.urlContext):t.url?this._execWithOptions(t,"url",e.options):this._defaultCollectionUrl(t,e.options),this._addUrlAffixes(this._addParams(r,e.options),t,e)},c.prototype.request=function(t,e){var r;return r=i(t.options,{autosend:!1,success:function(e){return t.data=e},error:function(e){return t.error=e},loaded:function(){return t.response=t.request.get("response"),e()}}),t.request=new Batman.Request(r),t.request.send()},c.prototype.perform=function(t,e,r,n){return r||(r={}),i(r,this.defaultRequestOptions),c.__super__.perform.call(this,t,e,r,n)},c.prototype.before("all",c.skipIfError(function(t,e){var r;if(!t.options.url)try{t.options.url=t.subject.prototype?this.urlForCollection(t.subject,t):this.urlForRecord(t.subject,t)}catch(n){r=n,t.error=r}return e()})),c.prototype.before("get","put","post","delete",c.skipIfError(function(t,e){return t.options.method=t.action.toUpperCase(),e()})),c.prototype.before("create","update",c.skipIfError(function(t,e){var r,n,o;return n=t.subject.toJSON(),t.options.only&&(n=this.onlyCertainAttributes(n,t.options.only)),t.options.except&&(n=this.exceptCertainAttributes(n,t.options.except)),(o=this.recordJsonNamespace(t.subject))?(r={},r[o]=n):r=n,t.options.data=r,e()})),c.prototype.before("create","update","put","post",c.skipIfError(function(t,e){return this.serializeAsForm?t.options.contentType=this.constructor.PostBodyContentType:null!=t.options.data&&(t.options.data=JSON.stringify(t.options.data),t.options.contentType=this.constructor.JSONContentType),e()})),c.prototype.after("all",c.skipIfError(function(t,e){var r,n;if(null==t.data)return e();if("string"==typeof t.data){if(t.data.length>0)try{n=this._jsonToAttributes(t.data)}catch(o){return r=o,t.error=r,e()}}else"object"==typeof t.data&&(n=t.data);return null!=n&&(t.json=n),e()})),c.prototype.extractFromNamespace=function(t,e){return e&&null!=t[e]?t[e]:t},c.prototype.after("create","read","update",c.skipIfError(function(t,e){var r;return null!=t.json&&(r=this.extractFromNamespace(t.json,this.recordJsonNamespace(t.subject)),t.subject._withoutDirtyTracking(function(){return this.fromJSON(r)})),t.result=t.subject,e()})),c.prototype.after("readAll",c.skipIfError(function(t,e){var r;return r=this.collectionJsonNamespace(t.subject),t.recordsAttributes=this.extractFromNamespace(t.json,r),"Array"!==a(t.recordsAttributes)&&(r=this.recordJsonNamespace(t.subject.prototype),t.recordsAttributes=[this.extractFromNamespace(t.json,r)]),t.result=t.records=this.getRecordsFromData(t.recordsAttributes,t.subject),e()})),c.prototype.after("get","put","post","delete",c.skipIfError(function(t,e){var r;return null!=t.json&&(r=t.subject.prototype?this.collectionJsonNamespace(t.subject):this.recordJsonNamespace(t.subject),t.result=this.extractFromNamespace(t.json,r)),e()})),c.HTTPMethods={create:"POST",update:"PUT",read:"GET",readAll:"GET",destroy:"DELETE"},u=["create","read","update","destroy","readAll","get","post","put","delete"],r=function(t){return c.prototype[t]=c.skipIfError(function(e,r){var n;return(n=e.options).method||(n.method=this.constructor.HTTPMethods[t]),this.request(e,r)})},n=0,o=u.length;o>n;n++)e=u[n],r(e);return c.prototype.after("all",function(t,e){return t.error&&(t.error=this._errorFor(t.error,t)),e()}),c._statusCodeErrors={0:c.CommunicationError,401:c.UnauthorizedError,403:c.NotAllowedError,404:c.NotFoundError,406:c.NotAcceptableError,409:c.RecordExistsError,413:c.EntityTooLargeError,422:c.UnprocessableRecordError,500:c.InternalStorageError,501:c.NotImplementedError,502:c.BadGatewayError},c.prototype._errorFor=function(t){var r,n;return t instanceof Error||null==t.request?t:((r=this.constructor._statusCodeErrors[t.request.status])&&(n=t.request,t=new r,t.request=n),t)},c}(o)},function(t){var n,o=[].indexOf||function(t){for(var e=0,r=this.length;r>e;e++)if(e in this&&this[e]===t)return e;return-1},i={}.hasOwnProperty;t.exports=n={isTransaction:!0,base:function(){return this._batman.base},applyChanges:function(t,e){var r,n,s,a,u,c,p,l;if(null==t&&(t=[]),null==e&&(e={}),o.call(t,this)>=0)return this.base();t.push(this),u=e.only,null!=u&&"Array"!==Batman.typeOf(u)&&(u=[u]),s=e.except,null!=s&&"Array"!==Batman.typeOf(s)&&(s=[s]),r=this.get("attributes").toObject();for(a in r)i.call(r,a)&&(p=r[a],null!=s&&o.call(s,a)>=0?delete r[a]:null==u||o.call(u,a)>=0?p instanceof Batman.Model&&p.isTransaction?(p.applyChanges(t),delete r[a]):p instanceof Batman.TransactionAssociationSet&&(c=p.applyChanges(t),r[a]=c):delete r[a]);return n=this.base(),n.mixin(r),null!=(l="function"==typeof n.applyChanges?n.applyChanges():void 0)?l:n},save:function(t,e){var r,n,o,i;return e||(i=[{},t],t=i[0],e=i[1]),r={only:t.only,except:t.except},this.once("validated",o=function(t){return function(){return t.applyChanges([],r)}}(this)),n=function(t){return function(){return t.off("validated",o),"function"==typeof e?e.apply(null,arguments):void 0}}(this),this.constructor.prototype.save.call(this,t,function(t){return function(e,r){return e||(r=t.base(),r.get("dirtyKeys").clear(),r.get("_dirtiedKeys").clear(),r.get("lifecycle").startTransition("save"),r.get("lifecycle").startTransition("saved")),n(e,r)}}(this))},destroy:function(){var t;return t=this.base(),t.destroy.apply(t,arguments)}}},function(e,r,n){var o,i,s,a={}.hasOwnProperty,u=function(t,e){function n(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};i=n(1).Set,o=n(33),e.exports=s=function(e){function r(t,e,r){var n;return n=e.indexOf(t),-1!==n?r[n]:(e.push(t),r.push(this),this.set("associationSet",t),this.set("association",t.association),this.set("foreignKeyValue",t.foreignKeyValue),this._loader=this._addFromAssociationSet.bind(this),t.on("itemsWereAdded",this._loader),this._visited=e,this._stack=r,this._storage=[],this._originalStorage=[],this._removedStorage=[],this.add.apply(this,t.toArray()),void 0)}return u(r,e),r.prototype.isTransaction=!0,r.prototype._addFromAssociationSet=function(t){return this.addArray(t)},r.prototype.addArray=r.mutation(function(t){var e,r,n,o,i,s,a;for(e=[],s=0,a=t.length;a>s;s++)r=t[s],r instanceof Batman.Model&&!r.isTransaction?(i=r._transaction(this._visited,this._stack),this._storage.push(i),e.push(i),n=this._originalStorage.indexOf(r),-1===n&&this._originalStorage.push(r),o=this._removedStorage.indexOf(r),o>-1&&this._removedStorage.splice(o,1)):Batman.developer.warn("You tried to add a "+Batman.functionName(r.constructor)+" to a TransactionAssociationSet ("+this.get("association.label")+")",r);return this.length=this._storage.length,e.length&&this.fire("itemsWereAdded",e),e}),r.prototype.removeArrayWithIndexes=r.mutation(function(e){var r,n,o,i,s,a,u,c;for(i=[],o=[],u=0,c=e.length;c>u;u++){if(a=e[u],!a.isTransaction)throw"Tried to remove real item from transaction set: "+t.toJSON();s=this._storage.indexOf(a),s>-1&&(this._storage.splice(s,1),i.push(a),o.push(s)),r=a.base(),n=this._originalStorage.indexOf(r),n>-1&&(this._removedStorage.push(r),this._originalStorage.splice(n,1))}return this.length=this._storage.length,i.length&&this.fire("itemsWereRemoved",i,o),{removedItems:i,removedIndexes:o}}),r.prototype.applyChanges=function(t){var e,r,n,o,i;if(null==t&&(t=[]),e=this.get("associationSet"),-1!==t.indexOf(this))return e;for(t.push(this),i=this._storage,n=0,o=i.length;o>n;n++)r=i[n],r.applyChanges(t);return e.off("itemsWereAdded",this._loader),e.replace(this._originalStorage),e.set("removedItems",new Batman.Set(this._removedStorage)),e},r.accessor("length",function(){return this.registerAsMutableSource(),this.length}),r.prototype.build=o.prototype.build,r}(i)},function(t,e,r){var n,o,i,s={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(1).BatmanObject,i=r(2).helpers,t.exports=o=function(t){function e(t,r){e.__super__.constructor.call(this,{attribute:t,message:r})}return a(e,t),e.accessor("fullMessage",function(){return"base"===this.attribute?Batman.t("errors.base.format",{message:this.message}):Batman.t("errors.format",{attribute:i.humanize(e.singularizeAssociated(this.attribute)),message:this.message})}),e.singularizeAssociated=function(t){var e,r,n,o;for(r=t.split("."),e=n=0,o=r.length-1;o>n;e=n+=1)r[e]=i.singularize(r[e]);return r.join(" ")},e}(n)},function(t,e,r){var n,o,i,s={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=r(1).Set,i=r(50),t.exports=n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,t),e.accessor(function(t){return this.indexedBy("attribute").get(t)}),e.prototype.add=function(t,r){return e.__super__.add.call(this,new i(t,r))},e}(o)},function(t,e,r){var n,o,i,s,a={}.hasOwnProperty,u=function(t,e){function n(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c=[].slice;s=r(1),n=s.BatmanObject,i=s.developer,t.exports=o=function(t){function e(){var t,r;r=arguments[0],t=arguments.length>=2?c.call(arguments,1):[],this.options=r,e.__super__.constructor.apply(this,t)}return u(e,t),e.triggers=function(){var t;return t=arguments.length>=1?c.call(arguments,0):[],null!=this._triggers?this._triggers.concat(t):this._triggers=t},e.options=function(){var t;return t=arguments.length>=1?c.call(arguments,0):[],null!=this._options?this._options.concat(t):this._options=t},e.matches=function(t){var e,r,n,o,i,s;r={},n=!1;for(e in t)o=t[e],~(null!=(i=this._options)?i.indexOf(e):void 0)&&(r[e]=o),~(null!=(s=this._triggers)?s.indexOf(e):void 0)&&(r[e]=o,n=!0);return n?r:void 0},e.prototype.validateEach=function(){return i.error("You must override validateEach in Batman.Validator subclasses.")},e.prototype.format=function(t,e,r,n){return this.options.message?"function"==typeof this.options.message?this.options.message.call(n,t,e):this.options.message:Batman.t("errors.messages."+e,r)},e.prototype.handleBlank=function(t){return this.options.allowBlank&&!this.isPresent(t)?!0:void 0},e.prototype.isPresent=function(t){return null!=t&&""!==t},e}(n)},function(t,e,r){var n,o,i,s,a,u,c,p,l,h,f;t.exports=f=[n=r(54),o=r(55),i=r(56),s=r(57),a=r(58),u=r(59),c=r(60),p=r(61),l=r(62),h=r(63)]},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=r(52),t.exports=n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.triggers("associatedFields"),e.prototype.validateEach=function(t,e,r,n){var o,i,s;return s=e.get(r),null!=s?(s instanceof Batman.AssociationProxy&&(s="function"==typeof s.get?s.get("target"):void 0),i=1,o=function(){return function(e,r){return null!=r&&r.forEach(function(e){return t.add(e.get("attribute"),e.get("message"))}),0===--i?n():void 0}}(this),null!=(null!=s?s.forEach:void 0)?s.forEach(function(t){return i+=1,t.validate(o)}):null!=(null!=s?s.validate:void 0)&&(i+=1,s.validate(o)),o(null,[])):n()},e}(o)},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=r(52),t.exports=n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.triggers("associated"),e.prototype.validateEach=function(t,e,r,n){var o,i,s;return s=e.get(r),null!=s?(s instanceof Batman.AssociationProxy&&(s="function"==typeof s.get?s.get("target"):void 0),i=1,o=function(o){return function(s,a){return a.length>0&&t.add(r,o.format(r,"invalid_association",{},e)),0===--i?n():void 0}}(this),null!=(null!=s?s.forEach:void 0)?s.forEach(function(t){return i+=1,t.validate(o)}):null!=(null!=s?s.validate:void 0)&&(i+=1,s.validate(o)),o(null,[])):n()},e}(o)},function(t,e,r){var n,o,i,s={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=r(52),i=r(1).typeOf,t.exports=n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,t),e.triggers("confirmation"),e.prototype.validateEach=function(t,e,r,n){var o,s,a,u;return a=this.options,a.confirmation?(o="String"===i(this.options.confirmation)?this.options.confirmation:r+"_confirmation",u=e.get(r),s=e.get(o),u!==s&&t.add(r,this.format(r,"confirmation_does_not_match",{},e)),n()):void 0},e}(o)},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=r(52),t.exports=n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.triggers("email"),e.prototype.emailRegexp=/[a-z0-9!#$%&'*+\/=?^_`{|}~.-]+@[a-z0-9-]+(\.[a-z0-9-]+)*/,e.prototype.validateEach=function(t,e,r,n){var o;return o=e.get(r),null!=o&&""!==o&&this.emailRegexp.test(o)||t.add(r,this.format(r,"not_an_email",{},e)),n()},e}(o)},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=r(52),t.exports=n=function(t){function e(t){this.unacceptableValues=t.exclusion["in"],e.__super__.constructor.apply(this,arguments)}return s(e,t),e.triggers("exclusion"),e.prototype.validateEach=function(t,e,r,n){return this.unacceptableValues.indexOf(e.get(r))>=0&&t.add(r,this.format(r,"included_in_list",{},e)),n()},e}(o)},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=r(52),t.exports=n=function(t){function e(t){this.acceptableValues=t.inclusion["in"],e.__super__.constructor.apply(this,arguments)}return s(e,t),e.triggers("inclusion"),e.options("allowBlank"),e.prototype.validateEach=function(t,e,r,n){var o;return o=e.get(r),this.handleBlank(o)||-1!==this.acceptableValues.indexOf(o)||t.add(r,this.format(r,"not_included_in_list",{},e)),n()},e}(o)},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=r(52),t.exports=n=function(t){function e(t){var r;(r=t.lengthIn||t.lengthWithin)&&(t.minLength=r[0],t.maxLength=r[1]||-1,delete t.lengthWithin,delete t.lengthIn),e.__super__.constructor.apply(this,arguments)}return s(e,t),e.triggers("minLength","maxLength","length","lengthWithin","lengthIn"),e.options("allowBlank"),e.prototype.validateEach=function(t,e,r,n){var o,i;return o=this.options,i=e.get(r),this.handleBlank(i)?n():(null==i&&(i=[]),o.minLength&&i.length<o.minLength&&t.add(r,this.format(r,"too_short",{count:o.minLength},e)),o.maxLength&&i.length>o.maxLength&&t.add(r,this.format(r,"too_long",{count:o.maxLength},e)),o.length&&i.length!==o.length&&t.add(r,this.format(r,"wrong_length",{count:o.length},e)),n())},e}(o)},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=r(52),t.exports=n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.triggers("numeric","greaterThan","greaterThanOrEqualTo","equalTo","lessThan","lessThanOrEqualTo","onlyInteger"),e.options("allowBlank"),e.prototype.validateEach=function(t,e,r,n){var o,i;return o=this.options,i=e.get(r),this.handleBlank(i)?n():(null==i||!this.isNumeric(i)&&!this.canCoerceToNumeric(i)?t.add(r,this.format(r,"not_numeric",{},e)):o.onlyInteger&&!this.isInteger(i)?t.add(r,this.format(r,"not_an_integer",{},e)):(null!=o.greaterThan&&o.greaterThan>=i&&t.add(r,this.format(r,"greater_than",{count:o.greaterThan},e)),null!=o.greaterThanOrEqualTo&&o.greaterThanOrEqualTo>i&&t.add(r,this.format(r,"greater_than_or_equal_to",{count:o.greaterThanOrEqualTo},e)),null!=o.equalTo&&i!==o.equalTo&&t.add(r,this.format(r,"equal_to",{count:o.equalTo},e)),null!=o.lessThan&&i>=o.lessThan&&t.add(r,this.format(r,"less_than",{count:o.lessThan},e)),null!=o.lessThanOrEqualTo&&i>o.lessThanOrEqualTo&&t.add(r,this.format(r,"less_than_or_equal_to",{count:o.lessThanOrEqualTo},e))),n())},e.prototype.isNumeric=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},e.prototype.isInteger=function(t){return parseFloat(t)===(0|t)},e.prototype.canCoerceToNumeric=function(t){return t-0==t&&t.length>0},e}(o)},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=r(52),t.exports=n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.triggers("presence"),e.prototype.validateEach=function(t,e,r,n){var o;return o=e.get(r),(null!=o?o.isProxy:void 0)&&(o=o.get("target")),this.isPresent(o)||t.add(r,this.format(r,"blank",{},e)),n()},e}(o)},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=r(52),t.exports=n=function(t){function e(t){var r;this.regexp=null!=(r=t.regexp)?r:t.pattern,e.__super__.constructor.apply(this,arguments)}return s(e,t),e.triggers("regexp","pattern"),e.options("allowBlank"),e.prototype.validateEach=function(t,e,r,n){var o;return o=e.get(r),this.handleBlank(o)?n():(null!=o&&""!==o&&this.regexp.test(o)||t.add(r,this.format(r,"not_matching",{},e)),n())},e}(o)},function(t){var n;t.exports=n={errors:{base:{format:"%{message}"},format:"%{attribute} %{message}",messages:{too_short:"must be at least %{count} characters",too_long:"must be less than %{count} characters",wrong_length:"must be %{count} characters",blank:"can't be blank",not_numeric:"must be a number",greater_than:"must be greater than %{count}",greater_than_or_equal_to:"must be greater than or equal to %{count}",equal_to:"must be equal to %{count}",less_than:"must be less than %{count}",less_than_or_equal_to:"must be less than or equal to %{count}",not_an_integer:"must be an integer",not_matching:"is not valid",invalid_association:"is not valid",not_included_in_list:"is not included in the list",included_in_list:"is included in the list",not_an_email:"is not a valid email address",confirmation_does_not_match:"and confirmation do not match"}}}},function(t,e,r){var n;t.exports=n={AbstractAttributeBinding:r(114),AbstractBinding:r(115),AbstractCollectionBinding:r(116),AddClassBinding:r(117),AttributeBinding:r(118),CheckedBinding:r(119),ClassBinding:r(120),ClickTrackingBinding:r(121),ContextBinding:r(122),DebuggerBinding:r(123),DeferredRenderBinding:r(124),EventBinding:r(125),FileBinding:r(126),FormBinding:r(127),InsertionBinding:r(128),IteratorBinding:r(129),NodeAttributeBinding:r(130),RadioBinding:r(131),RouteBinding:r(132),RouteParamsBinding:r(133),SelectBinding:r(134),ShowHideBinding:r(135),StyleAttributeBinding:r(136),StyleBinding:r(137),ValueBinding:r(138),ViewArgumentBinding:r(139),ViewBinding:r(140),ViewTrackingBinding:r(141)}},function(t,e,r){var n,o,i,s,a,u,c,p,l={}.hasOwnProperty,h=function(t,e){function n(){this.constructor=t}for(var r in e)l.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=r(1).BatmanObject,s=r(76),p=r(75)._data,c=r(79),u=r(80),a=r(82),n=r(81),t.exports=i=function(t){function d(t){this.view=t,d.__super__.constructor.call(this),this.node=this.view.node,this.parseTree(this.node)}var e,r,o,i,s,l,f;for(h(d,t),e=["defineview","foreach","renderif","view","formfor","context","bind","source","target","track","event"],s=["foreach","renderif","formfor","context"],r={},i=l=0,f=e.length;f>l;i=++l)o=e[i],r[o]=i;return d.prototype._sortBindings=function(t,n){var o,i;return o=r[t[0]],i=r[n[0]],null==o&&(o=e.length),null==i&&(i=e.length),o>i?1:i>o?-1:t[0]>n[0]?1:n[0]>t[0]?-1:0},d.prototype.parseTree=function(t){for(var e;t;)e=this.parseNode(t),t=this.nextNode(t,e);this.fire("bindingsInitialized")},d.prototype.parseNode=function(t){var e,r,i,l,h,f,d,y,m,g,v,_,b,w,x,O,B,A;if(y=!1,t.getAttribute&&t.attributes){for(d=[],x=t.attributes,v=0,b=x.length;b>v;v++)i=x[v],"data-"===(null!=(O=i.nodeName)?O.substr(0,5):void 0)&&(o=i.nodeName.substr(5),r=o.indexOf("-"),d.push(-1!==r?[o.substr(0,r),o.substr(r+1),i.value]:[o,void 0,i.value]));for(B=d.sort(this._sortBindings),_=0,w=B.length;w>_;_++)if(A=B[_],o=A[0],e=A[1],g=A[2],!y||-1!==s.indexOf(o)){if(h=e?(m=u[o])?(f=new n(t,e,g,this.view),m(f)):void 0:(m=c[o])?(f=new a(t,g,this.view),m(f)):void 0,(null!=h?h.initialized:void 0)&&this.once("bindingsInitialized",function(t){return function(){return t.initialized.call(t)}}(h)),null!=h?h.skipChildren:void 0)return!0;(null!=h?h.backWithView:void 0)&&(y=!0)}}return y&&(l=p(t,"view"))&&l.initializeBindings(),y},d.prototype.nextNode=function(t,e){var r,n,o,i;if(!e&&(r=t.childNodes,null!=r?r.length:void 0))return r[0];if(i=t.nextSibling,this.node!==t){if(i)return i;for(n=t;n=n.parentNode;){if(o=n.nextSibling,this.node===n)return;if(o)return o}}},d}(o)},function(t,e,r){var n,o,i,s,a,u=[].slice;a=r(2).helpers,s=r(83).escapeHTML,o=function(t){return function(e){return null==e?void 0:t.apply(this,arguments)}},i=function(t,e){return t||e},t.exports=n={raw:o(function(t,e){return e.escapeValue=!1,t}),get:o(function(t,e){return null!=t.get?t.get(e):t[e]}),equals:o(function(t,e){return t===e}),eq:function(t,e){return t===e},neq:function(t,e){return t!==e},lt:o(function(t,e){return e>t}),gt:o(function(t,e){return t>e}),lteq:o(function(t,e){return e>=t}),gteq:o(function(t,e){return t>=e}),and:function(t,e){return t&&e},or:function(t,e){return t||e},not:function(t){return!t},ceil:function(t){return Math.ceil(t)},floor:function(t){return Math.floor(t)},round:function(t){return Math.round(t)},precision:function(t,e){return parseFloat(t).toPrecision(e)},fixed:function(t,e){return parseFloat(t).toFixed(e)},delimitNumber:function(t){return t=""+t,t.replace(/(^|[^\w.])(\d{4,})/g,function(t,e,r){return e+r.replace(/\d(?=(?:\d\d\d)+(?!\d))/g,"$&,")})},trim:o(function(t){return t.trim()}),matches:o(function(t,e){return-1!==t.indexOf(e)}),truncate:o(function(t,e,r,n){return null==r&&(r="..."),n||(n=r,r="..."),t.length>e&&(t=t.substr(0,e-r.length)+r),t}),"default":function(t,e){return null!=t&&""!==t?t:e},prepend:function(t,e){return(null!=e?e:"")+(null!=t?t:"")},append:function(t,e){return(null!=t?t:"")+(null!=e?e:"")},replace:o(function(t,e,r,n,o){return o||(o=n,n=void 0),void 0===n?t.replace(e,r):t.replace(e,r,n)}),downcase:o(function(t){return t.toLowerCase()}),upcase:o(function(t){return t.toUpperCase()}),pluralize:o(function(t,e,r,n){return n||(n=r,r=!0,n||(n=e,e=void 0)),null!=e?Batman.helpers.pluralize(e,t,void 0,r):Batman.helpers.pluralize(t)}),humanize:o(function(t){return Batman.helpers.humanize(t)}),join:o(function(t,e,r){return null==e&&(e=""),r||(r=e,e=""),t.join(e)}),sort:o(function(t){return t.sort()}),map:o(function(t,e){return t.map(function(t){return Batman.get(t,e)})}),has:function(t,e){return null==t?!1:Batman.contains(t,e)},first:o(function(t){return t[0]}),meta:o(function(t,e){return Batman.developer.assert(t.meta,"Error, value doesn't have a meta to filter on!"),t.meta.get(e)}),interpolate:function(t,e,r){var n,o,i;if(r||(r=e,e=void 0),t){i={};for(n in e)o=e[n],i[n]=this.lookupKeypath(o),null==i[n]&&(Batman.developer.warn("Warning! Undefined interpolation key "+n+" for interpolation",t),i[n]="");return Batman.helpers.interpolate(t,i)}},withArguments:function(){var t,e,r,n;return e=arguments[0],r=arguments.length>=3?u.call(arguments,1,n=arguments.length-1):(n=1,[]),t=arguments[n++],e?"function"==typeof e?function(){return e.call.apply(e,[this].concat(u.call(r),u.call(arguments)))}:"function"==typeof e.get?e.get.apply(e,r):void 0:void 0},escape:o(s),toggle:function(t,e){return function(){return e.toggle("unfilteredValue")}},increment:function(t,e,r){return function(){return r.increment("unfilteredValue",e)}},decrement:function(t,e,r){return function(){return r.decrement("unfilteredValue",e)}}},function(){var t,e,r,i,s;for(i=["capitalize","titlelize","singularize","underscore","camelize","toSentence","ordinalize"],s=[],e=0,r=i.length;r>e;e++)t=i[e],s.push(n[t]=o(a[t]));return s}(),t.exports=n},function(t,e,r){var n,o,i,s={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u=[].slice;n=r(1).BatmanObject,o=r(73),t.exports=i=function(t){function e(){var t;this.bindings=[],this.subviews=new Batman.Set,this.subviews.on("itemsWereAdded",function(t){return function(e){var r,n,o;for(n=0,o=e.length;o>n;n++)r=e[n],t._addSubview(r)}}(this)),this.subviews.on("itemsWereRemoved",function(){return function(t){var e,r,n;for(r=0,n=t.length;n>r;r++)e=t[r],e._removeFromSuperview()}}(this)),e.__super__.constructor.apply(this,arguments),(t=this.superview)&&(this.superview=null,t.subviews.add(this))}return a(e,t),e.store=new o,e.LIFECYCLE_EVENTS=["viewDidLoad","viewWillAppear","isInDOM","viewDidAppear","viewDidMoveToSuperview","ready","viewWillDisappear","viewDidDisappear","viewWillRemoveFromSuperview","destroy"],e.option=function(){var t,e;return t=arguments.length>=1?u.call(arguments,0):[],this.initializeBatman(),(e=this._batman.options)&&(t=e.concat(t)),this._batman.set("options",t)},e.filter=function(t,e){var r;return this.prototype.initializeBatman(),r=this.prototype._batman.filters||{},r[t]=e,this.prototype._batman.set("filters",r)},e.viewForNode=function(t,e){var r;for(null==e&&(e=!0);t;){if(r=Batman._data(t,"view"))return r;if(!e)return;t=t.parentNode}},e.prototype.bindings=[],e.prototype.subviews=[],e.prototype.superview=null,e.prototype.controller=null,e.prototype.source=null,e.prototype.html=null,e.prototype.node=null,e.prototype.bindImmediately=!0,e.prototype.isBound=!1,e.prototype.isInDOM=!1,e.prototype.isView=!0,e.prototype.isDead=!1,e.prototype.isBackingView=!1,e.prototype._addChildBinding=function(t){return this.bindings.push(t)},e.prototype._addSubview=function(t){var e,r,n,o;return r=t.controller,t.removeFromSuperview(),t.set("controller",r||this.controller),t.set("superview",this),t.fireAndCall("viewDidMoveToSuperview"),(n=t.contentFor)&&!t.parentNode&&(o=Batman.DOM.Yield.withName(n),o.set("contentView",t)),(e=this._batman.get("filters"))&&t._batman.set("filters",Batman.mixin({},e,t._batman.get("filters"))),this.get("node"),t.get("node"),this.observe("node",t._nodesChanged),t.observe("node",t._nodesChanged),t.observe("parentNode",t._nodesChanged),t._nodesChanged()},e.prototype._removeFromSuperview=function(){var t;if(this.superview)return this.fireAndCall("viewWillRemoveFromSuperview"),this.forget("node",this._nodesChanged),this.forget("parentNode",this._nodesChanged),this.superview.forget("node",this._nodesChanged),t=this.get("superview"),this.removeFromParentNode(),this.set("superview",null),this.set("controller",null)},e.prototype.removeFromSuperview=function(){var t;return null!=(t=this.superview)?t.subviews.remove(this):void 0},e.prototype._nodesChanged=function(){var t,e;if(this.node)return this.bindImmediately&&this.initializeBindings(),e=this.superview.get("node"),t=this.parentNode,"string"==typeof t&&(t=Batman.DOM.querySelector(e,t)),t||(t=e),t?this.addToParentNode(t):void 0},e.prototype.addToParentNode=function(t){var e;if(this.get("node"))return e=Batman.DOM.containsNode(t),e&&this.propagateToSubviews("viewWillAppear"),this.insertIntoDOM(t),this.propagateToSubviews("isInDOM",e),e?this.propagateToSubviews("viewDidAppear"):void 0},e.prototype.insertIntoDOM=function(t){return t!==this.node?t.appendChild(this.node):void 0},e.prototype.removeFromParentNode=function(){var t,e,r,n,o;return e=this.get("node"),t=null!=(r=this.wasInDOM)?r:Batman.DOM.containsNode(e),t&&this.propagateToSubviews("viewWillDisappear"),null!=(n=this.node)&&null!=(o=n.parentNode)&&o.removeChild(this.node),this.propagateToSubviews("isInDOM",!1),t?this.propagateToSubviews("viewDidDisappear"):void 0},e.prototype.propagateToSubviews=function(t,e){var r,n,o,i,s;for(null!=e?this.set(t,e):this.fireAndCall(t),i=this.subviews._storage,s=[],n=0,o=i.length;o>n;n++)r=i[n],s.push(r.propagateToSubviews(t,e));return s},e.prototype.loadView=function(t){var e,r;return null!=(e=this.get("html"))?(r=t||document.createElement("div"),Batman.DOM.setInnerHTML(r,e),r):void 0},e.accessor("html",{get:function(){var t,e,r;if(null!=this.html)return this.html;if(r=this.get("source"))return r=Batman.Navigator.normalizePath(r),this.html=this.constructor.store.get(r),null==this.html&&(e=this.property("html"),t=function(r){return function(n){return null!=n&&r.set("html",n),e.removeHandler(t)}}(this),e.addHandler(t)),this.html},set:function(t,e){return this.destroyBindings(),this.destroySubviews(),this.html=e,this.node&&null!=e&&this.loadView(this.node),this.bindImmediately?this.initializeBindings():void 0}}),e.accessor("node",{get:function(){var t;return null!=this.node||this.isDead||(t=this.loadView(),t&&this.set("node",t),this.fireAndCall("viewDidLoad")),this.node},set:function(t,e,r){return r&&Batman.removeData(r,"view",!0),e!==this.node&&(this.destroyBindings(),this.destroySubviews(),this.node=e,e)?(Batman._data(e,"view",this),Batman.developer["do"](function(t){return function(){var r,n;return r=t.get("displayName")||t.get("source"),"function"==typeof(n=e===document?document.body:e).setAttribute?n.setAttribute("batman-view",t.constructor.name+(r?": "+r:"")):void 0}}(this)),e):void 0}}),e.prototype.event("ready").oneShot=!0,e.prototype.initializeBindings=function(){return!this.isBound&&this.node?(new Batman.BindingParser(this),this.set("isBound",!0),this.fireAndCall("ready")):void 0},e.prototype.destroyBindings=function(){var t,e,r,n;for(n=this.bindings,e=0,r=n.length;r>e;e++)t=n[e],t.die();return this.bindings=[],this.isBound=!1},e.prototype.destroySubviews=function(){var t,e,r,n;if(this.isDead)return Batman.developer.warn("Tried to destroy the subviews of a dead "+Batman.functionName(this.constructor)+"."),void 0;for(n=this.subviews.toArray(),e=0,r=n.length;r>e;e++)t=n[e],t.die();return this.subviews.clear()},e.prototype.die=function(){var t,e,r,n;if(this.isDead)return Batman.developer.warn("Tried to die() a "+Batman.functionName(this.constructor)+" more than once."),void 0;if(this.fireAndCall("destroy"),this.destroyBindings(),this.destroySubviews(),this.node&&(this.wasInDOM=Batman.DOM.containsNode(this.node),Batman.DOM.destroyNode(this.node)),this.removeFromSuperview(),this.forget(),null!=(r=this._batman.properties)&&r.forEach(function(t,e){return e.die()}),this._batman.events){n=this._batman.events;for(e in n)t=n[e],t.clearHandlers()}return this.node=null,this.parentNode=null,this.subviews=null,this.isDead=!0},e.prototype.baseForKeypath=function(t){return t.split(".")[0].split("|")[0].trim()},e.prototype.prefixForKeypath=function(t){var e;return e=t.lastIndexOf("."),-1!==e?t.substr(0,e):t},e.prototype.targetForKeypath=function(t,e){var r,n,o,i;for(n=this;n;){if(i=this._testTargetForKeypath(n,t))return i;if(!e||o||n.isBackingView||(o=Batman.get(n,"proxiedObject")||n),!r&&n.isView&&n.controller&&(r=n.controller),n.isView&&n.superview)n=n.superview;else if(r)n=r,r=null;else{if(n.window)break;n=Batman.currentApp&&n!==Batman.currentApp?Batman.currentApp:{window:Batman.container}
}}return o},e.prototype._testTargetForKeypath=function(t,e){var r;return(r=Batman.get(t,"proxiedObject"))&&Batman.get(r,e)!==void 0?r:Batman.get(t,e)!==void 0?t:void 0},e.prototype.lookupKeypath=function(t){var e,r;return e=this.baseForKeypath(t),r=this.targetForKeypath(e),r?Batman.get(r,t):void 0},e.prototype.setKeypath=function(t,e){var r,n,o;return r=this.prefixForKeypath(t),n=this.targetForKeypath(r,!0),n&&n!==Batman.container?null!=(o=Batman.Property.forBaseAndKey(n,t))?o.setValue(e):void 0:void 0},e.prototype.fireAndCall=function(t){return this.fire(t),"function"==typeof this[t]?this[t]():void 0},e}(n)},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=r(68),t.exports=n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype.isBackingView=!0,e.prototype.bindImmediately=!1,e}(o)},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(69),t.exports=o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype._addChildBinding=function(t){return e.__super__._addChildBinding.apply(this,arguments),this.fire("childBindingAdded",t)},e}(n)},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=r(68),t.exports=n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e}(o)},function(t,e,r){var n,o,i,s={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};i=r(68),n=r(71),t.exports=o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.loadView=function(){return document.createComment("batman-iterator-"+this.iteratorName+'="'+this.iteratorPath+'"')},e.prototype.addItems=function(t,e){var r,n,o,i,s,a;if(this._beginAppendItems(),e)for(r=o=0,s=t.length;s>o;r=++o)n=t[r],this._insertItem(n,e[r]);else for(i=0,a=t.length;a>i;i++)n=t[i],this._insertItem(n);return this._finishAppendItems()},e.prototype.removeItems=function(t,e){var r,n,o,i,s,a,u,c,p;if(e){for(c=[],r=i=0,a=t.length;a>i;r=++i)n=t[r],c.push(this.subviews.at(e[r]).die());return c}for(p=[],s=0,u=t.length;u>s;s++)n=t[s],p.push(function(){var t,e,r,i;for(r=this.subviews._storage,i=[],t=0,e=r.length;e>t;t++)if(o=r[t],o.get(this.attributeName)===n){o.unset(this.attributeName),o.die();break}return i}.call(this));return p},e.prototype.moveItem=function(t,e){var r,n;return r=this.subviews.at(t),this.subviews._storage.splice(t,1),n=this.subviews.at(e),this.subviews._storage.splice(e,0,r),this.node.parentNode.insertBefore(r.node,(null!=n?n.node:void 0)||this.node)},e.prototype._beginAppendItems=function(){var t;return!this.iterationViewClass&&(t=this.prototypeNode.getAttribute("data-view"))&&(this.iterationViewClass=this.lookupKeypath(t),this.prototypeNode.removeAttribute("data-view")),this.iterationViewClass||(this.iterationViewClass=n),this.fragment=document.createDocumentFragment(),this.appendedViews=[],this.get("node")},e.prototype._insertItem=function(t,e){var r;return r=new this.iterationViewClass({node:this.prototypeNode.cloneNode(!0),parentNode:this.fragment}),r.set(this.iteratorName,t),null!=e?(r._targeted=!0,this.subviews.insert([r],[e])):this.subviews.add(r),r.parentNode=null,this.appendedViews.push(r)},e.prototype._finishAppendItems=function(){var t,e,r,n,o,i,s,a,u,c,p,l,h;if(e=Batman.DOM.containsNode(this.node))for(c=this.appendedViews,o=0,a=c.length;a>o;o++)n=c[o],n.propagateToSubviews("viewWillAppear");for(p=this.subviews.toArray(),t=i=p.length-1;i>=0;t=i+=-1)n=p[t],n._targeted&&((r=null!=(l=this.subviews.at(t+1))?l.get("node"):void 0)?r.parentNode.insertBefore(n.get("node"),r):this.fragment.appendChild(n.get("node")),delete n._targeted);if(this.node.parentNode.insertBefore(this.fragment,this.node),this.fire("itemsWereRendered"),e)for(h=this.appendedViews,s=0,u=h.length;u>s;s++)n=h[s],n.propagateToSubviews("isInDOM",e),n.propagateToSubviews("viewDidAppear");return this.appendedViews=null,this.fragment=null},e}(i)},function(t,e,r){var n,o,i,s,a,u={}.hasOwnProperty,c=function(t,e){function n(){this.constructor=t}for(var r in e)u.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};a=r(1),n=a.BatmanObject,i=a.Property,s=a.SimpleSet,t.exports=o=function(t){function e(){e.__super__.constructor.apply(this,arguments),this._htmlContents={},this._requestedPaths=new s}return c(e,t),e.prototype.propertyClass=i,e.prototype.fetchHTML=function(t){return new Batman.Request({url:Batman.Navigator.normalizePath(Batman.config.pathToHTML,""+t+".html"),type:"html",success:function(e){return function(r){return e.set(t,r)}}(this),error:function(){throw Error("Could not load html from "+t)}})},e.accessor({"final":!0,get:function(t){var e;if("/"!==t.charAt(0))return this.get("/"+t);if(this._htmlContents[t])return this._htmlContents[t];if(!this._requestedPaths.has(t)){if(e=this._sourceFromDOM(t))return e;if(!Batman.config.fetchRemoteHTML)throw Error("Couldn't find html source for '"+t+"'!");this.fetchHTML(t)}},set:function(t,e){return"/"!==t.charAt(0)?this.set("/"+t,e):(this._requestedPaths.add(t),this._htmlContents[t]=e)}}),e.prototype.prefetch=function(t){return this.get(t),!0},e.prototype._sourceFromDOM=function(t){var e,r;return r=t.slice(1),(e=Batman.DOM.querySelector(document,"[data-defineview*='"+r+"']"))?(Batman.setImmediate(function(){var t;return null!=(t=e.parentNode)?t.removeChild(e):void 0}),Batman.View.store.set(Batman.Navigator.normalizePath(t),e.innerHTML)):void 0},e}(n)},function(t){var n;t.exports=n={loadTracker:function(){return Batman.Tracking.tracker?Batman.Tracking.tracker:(Batman.Tracking.tracker=Batman.currentApp.EventTracker?new Batman.currentApp.EventTracker:(Batman.developer.warn("Define "+Batman.currentApp.name+".EventTracker to use data-track"),{track:function(){}}),Batman.Tracking.tracker)},trackEvent:function(t,e,r){return Batman.Tracking.loadTracker().track(t,e,r)}}},function(t){var n,o;o=function(t){var e;for(e in t)return!1;return!0},t.exports=n={cache:{},uuid:0,expando:"batman"+(""+Math.random()).replace(/\D/g,""),canDeleteExpando:function(){var t,e;try{return t=document.createElement("div"),delete t.test}catch(r){return e=r,Batman.canDeleteExpando=!1}}(),noData:{embed:!0,EMBED:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",OBJECT:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0,APPLET:!0},hasData:function(t){return t=t.nodeType?Batman.cache[t[Batman.expando]]:t[Batman.expando],!!t&&!o(t)},data:function(t,e,r,n){var o,i,s,a,u,c;if(Batman.acceptData(t)&&(a=Batman.expando,i="string"==typeof e,o=Batman.cache,s=t[Batman.expando],!(!s||n&&s&&o[s]&&!o[s][a])||!i||void 0!==r))return s||(3!==t.nodeType?t[Batman.expando]=s=++Batman.uuid:s=Batman.expando),o[s]||(o[s]={}),("object"==typeof e||"function"==typeof e)&&(n?o[s][a]=Batman.extend(o[s][a],e):o[s]=Batman.extend(o[s],e)),c=o[s],n&&(c[a]||(c[a]={}),c=c[a]),void 0!==r&&(c[e]=r),u=i?c[e]:c},removeData:function(t,e,r,n){var i,s,a,u,c,p;if(Batman.acceptData(t)&&(u=Batman.expando,c=t.nodeType,i=Batman.cache,s=t[Batman.expando],i[s]&&!(e&&(p=r?i[s][u]:i[s],p&&(delete p[e],!o(p)))||r&&(delete i[s][u],!o(i[s])))))return a=i[s][u],Batman.canDeleteExpando||!i.setInterval?delete i[s]:i[s]=null,a&&!n?(i[s]={},i[s][u]=a):Batman.canDeleteExpando?delete t[Batman.expando]:t.removeAttribute?t.removeAttribute(Batman.expando):t[Batman.expando]=null},_data:function(t,e,r){return Batman.data(t,e,r,!0)},acceptData:function(t){var e;if(t)return t.___acceptData||(t.___acceptData=t.nodeName?(e=Batman.noData[t.nodeName],e?!(e===!0||t.getAttribute("classid")!==e):!0):!0)}}},function(t,e,r){var n,o,i,s,a,u;for(o=r(1).developer,t.exports=n={textInputTypes:["text","search","tel","url","email","password"],scrollIntoView:function(t){var e;return null!=(e=document.getElementById(t))?"function"==typeof e.scrollIntoView?e.scrollIntoView():void 0:void 0},setStyleProperty:function(t,e,r,n){return t.style.setProperty?t.style.setProperty(e,r,n):t.style.setAttribute(e,r,n)},valueForNode:function(t,e,r){var n,o,i,s,a,u,c;switch(null==e&&(e=""),null==r&&(r=!0),o=arguments.length>1,i=t.nodeName.toUpperCase()){case"INPUT":case"TEXTAREA":return o?t.value=e:t.value;case"SELECT":if(o)return t.value=e;if(t.multiple){for(u=t.children,c=[],s=0,a=u.length;a>s;s++)n=u[s],n.selected&&c.push(n.value);return c}return t.value;default:return o?("OPTION"===i&&(t.text=e),Batman.DOM.setInnerHTML(t,r?Batman.escapeHTML(e):e)):t.innerHTML}},nodeIsEditable:function(t){var e;return"INPUT"===(e=t.nodeName.toUpperCase())||"TEXTAREA"===e||"SELECT"===e},addEventListener:function(t,e,r){var n;return(n=Batman._data(t,"listeners"))||(n=Batman._data(t,"listeners",{})),n[e]||(n[e]=[]),n[e].push(r),Batman.DOM.hasAddEventListener?t.addEventListener(e,r,!1):t.attachEvent("on"+e,r)},removeEventListener:function(t,e,r){var n,o,i;return(i=Batman._data(t,"listeners"))&&(n=i[e])&&(o=n.indexOf(r),-1!==o&&n.splice(o,1)),Batman.DOM.hasAddEventListener?t.removeEventListener(e,r,!1):t.detachEvent("on"+e,r)},cleanupNode:function(t){var e,r,n,o,i,s,a;if(o=Batman._data(t,"listeners"))for(n in o)r=o[n],r.forEach(function(e){return Batman.DOM.removeEventListener(t,n,e)});for(Batman.removeData(t,null,null,!0),a=t.childNodes,i=0,s=a.length;s>i;i++)e=a[i],Batman.DOM.cleanupNode(e)},hasAddEventListener:!!("undefined"!=typeof window&&null!==window?window.addEventListener:void 0),preventDefault:function(t){return"function"==typeof t.preventDefault?t.preventDefault():t.returnValue=!1},stopPropagation:function(t){return t.stopPropagation?t.stopPropagation():t.cancelBubble=!0},eventIsAllowed:function(t,e){var r,n,o;return(r=null!=(n=Batman.currentApp)?null!=(o=n.shouldAllowEvent)?o[t]:void 0:void 0)&&r(e)===!1?!1:!0},primaryInteractionEventName:"click"},s=["querySelector","querySelectorAll","setInnerHTML","containsNode","destroyNode","textContent"],a=0,u=s.length;u>a;a++)i=s[a],n[i]=function(){return o.error("Please include a platform adapter to define "+i+".")}},function(t,e,r){var n,o,i=[].slice,s=[].indexOf||function(t){for(var e=0,r=this.length;r>e;e++)if(e in this&&this[e]===t)return e;return-1};n=r(76),t.exports=o={primaryInteractionEvent:function(t,e,r,o,s){return null==o&&(o=n.primaryInteractionEventName),null==s&&(s=!0),n.addEventListener(t,o,function(){var a,u;return u=arguments[0],a=arguments.length>=2?i.call(arguments,1):[],u.metaKey||u.ctrlKey||1===u.button||(s&&n.preventDefault(u),!n.eventIsAllowed(o,u))?void 0:e.apply(null,[t,u].concat(i.call(a),[r]))}),"A"!==t.nodeName.toUpperCase()||t.href||(t.href="#"),t},click:function(t,e,r,n,i){return null==n&&(n="click"),null==i&&(i=!0),o.primaryInteractionEvent(t,e,r,n,i)},doubleclick:function(t,e,r){return o.click(t,e,r,"dblclick")},change:function(t,e,r){var a,u,c,p,l;for(u=function(){var r;switch(t.nodeName.toUpperCase()){case"TEXTAREA":return["input","keyup","change"];case"INPUT":return r=t.type.toLowerCase(),s.call(n.textInputTypes,r)>=0?(c=e,e=function(t,e,r){return"keyup"===e.type&&o.isEnter(e)?void 0:c(t,e,r)},["input","keyup","change"]):["input","change"];default:return["change"]}}(),p=0,l=u.length;l>p;p++)a=u[p],n.addEventListener(t,a,function(){var n;return n=arguments.length>=1?i.call(arguments,0):[],e.apply(null,[t].concat(i.call(n),[r]))})},isEnter:function(t){var e,r;return(e=t.keyCode)>=13&&14>=e||(r=t.which)>=13&&14>=r||"Enter"===t.keyIdentifier||"Enter"===t.key},submit:function(t,e,r){return n.nodeIsEditable(t)?(n.addEventListener(t,"keydown",function(){var e;return e=arguments.length>=1?i.call(arguments,0):[],o.isEnter(e[0])?n._keyCapturingNode=t:void 0}),n.addEventListener(t,"keyup",function(){var s;return s=arguments.length>=1?i.call(arguments,0):[],o.isEnter(s[0])?(n._keyCapturingNode===t&&(n.preventDefault(s[0]),e.apply(null,[t].concat(i.call(s),[r]))),n._keyCapturingNode=null):void 0})):n.addEventListener(t,"submit",function(){var o;return o=arguments.length>=1?i.call(arguments,0):[],n.preventDefault(o[0]),e.apply(null,[t].concat(i.call(o),[r]))}),t},other:function(t,e,r,o){return n.addEventListener(t,e,function(){var e;return e=arguments.length>=1?i.call(arguments,0):[],r.apply(null,[t].concat(i.call(e),[o]))})}}},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(1).BatmanObject,t.exports=o=function(t){function e(t){this.name=t}return s(e,t),e.yields={},e.reset=function(){return this.yields={}},e.withName=function(t){var e;return(e=this.yields)[t]||(e[t]=new this(t))},e.accessor("contentView",{get:function(){return this.contentView},set:function(t,e){return this.contentView!==e?(this.contentView&&this.contentView.removeFromSuperview(),this.contentView=e,this.containerNode&&e?e.set("parentNode",this.containerNode):void 0):void 0}}),e.accessor("containerNode",{get:function(){return this.containerNode},set:function(t,e){return this.containerNode!==e?(this.containerNode=e,this.contentView?this.contentView.set("parentNode",e):void 0):void 0}}),e}(n)},function(t,e,r){var n,o,i,s;o=r(78),n=r(142),i=r(80),t.exports=s={target:function(t){return t.onlyObserve=n.Node,s.bind(t)},source:function(t){return t.onlyObserve=n.Data,s.bind(t)},bind:function(t){var e,r;switch(r=t.node,r.nodeName.toLowerCase()){case"input":switch(r.getAttribute("type")){case"checkbox":return t.attr="checked",i.bind(t),!0;case"radio":e=Batman.DOM.RadioBinding;break;case"file":e=Batman.DOM.FileBinding}break;case"select":e=Batman.DOM.SelectBinding}return e||(e=Batman.DOM.ValueBinding),new e(t)},context:function(t){return new Batman.DOM.ContextBinding(t)},showif:function(t){return new Batman.DOM.ShowHideBinding(t)},hideif:function(t){return t.invert=!0,new Batman.DOM.ShowHideBinding(t)},insertif:function(t){return new Batman.DOM.InsertionBinding(t)},removeif:function(t){return t.invert=!0,new Batman.DOM.InsertionBinding(t)},deferif:function(t){return t.invert=!0,new Batman.DOM.DeferredRenderBinding(t)},renderif:function(t){return new Batman.DOM.DeferredRenderBinding(t)},route:function(t){return new Batman.DOM.RouteBinding(t)},view:function(t){return new Batman.DOM.ViewBinding(t)},partial:function(t){var e,r,n,o;return r=t.node,e=t.keyPath,o=t.view,r.removeAttribute("data-partial"),n=new Batman.View({source:e,parentNode:r,node:r}),{skipChildren:!0,initialized:function(){return n.loadView(r),o.subviews.add(n)}}},defineview:function(t){var e,r,n;return r=t.node,n=t.view,e=t.keyPath,Batman.View.store.set(Batman.Navigator.normalizePath(e),r.innerHTML),{skipChildren:!0,initialized:function(){return r.parentNode?r.parentNode.removeChild(r):void 0}}},contentfor:function(t){var e,r,n,o;return n=t.node,r=t.keyPath,o=t.view,e=new Batman.View({html:n.innerHTML,contentFor:r}),e.addToParentNode=function(t){return t.innerHTML="",t.appendChild(this.get("node"))},o.subviews.add(e),{skipChildren:!0,initialized:function(){return n.parentNode?n.parentNode.removeChild(n):void 0}}},yield:function(t){var e;return e=o.withName(t.keyPath),e.set("containerNode",t.node),{skipChildren:!0}},debug:function(t){return new Batman.Dom.DebuggerBinding(t)}}},function(t,e,r){var n,o;n=r(142),t.exports=o={_parseAttribute:function(t){return"false"===t&&(t=!1),"true"===t&&(t=!0),t},source:function(t){return t.onlyObserve=n.Data,o.bind(t)},bind:function(t){var e;return e=function(){switch(t.attr){case"checked":case"disabled":case"selected":return Batman.DOM.CheckedBinding;case"value":case"href":case"src":case"size":return Batman.DOM.NodeAttributeBinding;case"class":return Batman.DOM.ClassBinding;case"style":return Batman.DOM.StyleBinding;default:return Batman.DOM.AttributeBinding}}(),new e(t)},context:function(t){return new Batman.DOM.ContextBinding(t)},event:function(t){return new Batman.DOM.EventBinding(t)},track:function(t){return"view"===t.attr?new Batman.DOM.ViewTrackingBinding(t):"click"===t.attr?new Batman.DOM.ClickTrackingBinding(t):void 0},addclass:function(t){return new Batman.DOM.AddClassBinding(t)},removeclass:function(t){return t.invert=!0,new Batman.DOM.AddClassBinding(t)},foreach:function(t){return new Batman.DOM.IteratorBinding(t)},formfor:function(t){return new Batman.DOM.FormBinding(t)},style:function(t){return new Batman.DOM.StyleAttributeBinding(t)}}},function(t){var n;t.exports=n=function(){function t(t,e,r,n){this.node=t,this.attr=e,this.keyPath=r,this.view=n}return t}()},function(t){var n;t.exports=n=function(){function t(t,e,r){this.node=t,this.keyPath=e,this.view=r}return t}()},function(t){var n,o,i,s,a,u,c;a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","/":"&#47;","'":"&#39;"},u=[],i=[];for(o in a)u.push(o),i.push(a[o]);c=RegExp("["+u.join("")+"]","g"),s=RegExp("("+i.join("|")+")","g"),t.exports=n={escapeHTML:function(){return function(t){return(""+t).replace(c,function(t){return a[t]})}}(),unescapeHTML:function(){return function(t){var e;if(null!=t)return e=Batman._unescapeHTMLNode||(Batman._unescapeHTMLNode=document.createElement("DIV")),e.innerHTML=t,Batman.DOM.textContent(e)}}()}},function(t,e,r){var n,o,i,s,a,u,c,p,l,h,f,d,y=function(t,e){return function(){return t.apply(e,arguments)}},m={}.hasOwnProperty,g=function(t,e){function n(){this.constructor=t}for(var r in e)m.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},v=[].indexOf||function(t){for(var e=0,r=this.length;r>e;e++)if(e in this&&this[e]===t)return e;return-1},_=[].slice;f=r(1),n=f.BatmanObject,u=f.SimpleHash,c=f.developer,h=f.typeOf,p=f.functionName,d=r(2),l=d.helpers,s=d.LifecycleEvents,a=r(86),i=r(85),t.exports=o=function(t){function e(){this.redirect=y(this.redirect,this),this.handleError=y(this.handleError,this),this.errorHandler=y(this.errorHandler,this),e.__super__.constructor.apply(this,arguments),this._resetActionFrames()}return g(e,t),e.prototype.coerceIntegerParams=!0,e.singleton("sharedController"),e.wrapAccessor("routingKey",function(){return{get:function(){return null!=this.routingKey?this.routingKey:(Batman.config.minificationErrors&&c.error("Please define `routingKey` on the prototype of "+p(this.constructor)+" in order for your controller to be minification safe."),p(this.constructor).replace(/Controller$/,""))}}}),e.classMixin(s),e.lifecycleEvent("action",function(t){var e,r,n;return null==t&&(t={}),r={},n="String"===h(t.only)?[t.only]:t.only,e="String"===h(t.except)?[t.except]:t.except,r["if"]=function(t,r){var o,i;return this._afterFilterRedirect?!1:n&&(o=r.action,0>v.call(n,o))?!1:e&&(i=r.action,v.call(e,i)>=0)?!1:!0},r}),e.beforeFilter=function(){return c.deprecated("Batman.Controller::beforeFilter","Please use beforeAction instead."),this.beforeAction.apply(this,arguments)},e.afterFilter=function(){return c.deprecated("Batman.Controller::afterFilter","Please use afterAction instead."),this.afterAction.apply(this,arguments)},e.afterAction(function(t){return this.autoScrollToHash&&null!=t["#"]?this.scrollToHash(t["#"]):void 0}),e.catchError=function(){var t,e,r,n,o,i,s,a,c,p;for(r=arguments.length>=2?_.call(arguments,0,s=arguments.length-1):(s=0,[]),o=arguments[s++],this.prototype.initializeBatman(),(i=this._batman).errorHandlers||(i.errorHandlers=new u),n="Array"===h(o["with"])?o["with"]:[o["with"]],p=[],a=0,c=r.length;c>a;a++)e=r[a],t=this._batman.errorHandlers.get(e)||[],p.push(this._batman.errorHandlers.set(e,t.concat(n)));return p},e.prototype.errorHandler=function(t){var e,r;return e=null!=(r=this._actionFrames)?r[this._actionFrames.length-1]:void 0,function(r){return function(n,o,i){if(!n)return"function"==typeof t?t(o,i):void 0;if((null!=e?!e.error:true)&&(null!=e&&(e.error=n),!r.handleError(n)))throw n}}(this)},e.prototype.handleError=function(t){var e,r;return e=!1,null!=(r=this.constructor._batman.getAll("errorHandlers"))&&r.forEach(function(r){return function(n){return n.forEach(function(n,o){var i,s,a,u;if(t instanceof n){for(e=!0,u=[],s=0,a=o.length;a>s;s++)i=o[s],"string"==typeof i&&(i=r[i]),u.push(i.call(r,t));return u}})}}(this)),e},e.prototype.renderCache=new a,e.prototype.defaultRenderYield="main",e.prototype.autoScrollToHash=!0,e.prototype.dispatch=function(t,e){var r,n,o;if(null==e&&(e={}),this.coerceIntegerParams)for(r in e)o=e[r],e[r]=l.coerceInteger(o);return e.controller||(e.controller=this.get("routingKey")),e.action||(e.action=t),e.target||(e.target=this),this._resetActionFrames(),this.set("action",t),this.set("params",e),this.executeAction(t,e),n=this._afterFilterRedirect,this._afterFilterRedirect=null,delete this._afterFilterRedirect,n?Batman.redirect(n):void 0},e.prototype.executeAction=function(t,e){var r,n,o,s,a,u;return null==e&&(e=this.get("params")),c.assert(this[t],"Error! Controller action "+this.get("routingKey")+"."+t+" couldn't be found!"),o=this._actionFrames[this._actionFrames.length-1],r=new i({parentFrame:o,action:t,params:e},function(t){return function(){var e;return t._afterFilterRedirect||t.fireLifecycleEvent("afterAction",r.params,r),t._resetActionFrames(),null!=(e=Batman.navigator)?e.redirect=n:void 0}}(this)),this._actionFrames.push(r),r.startOperation({internal:!0}),n=null!=(a=Batman.navigator)?a.redirect:void 0,null!=(u=Batman.navigator)&&(u.redirect=this.redirect),this.fireLifecycleEvent("beforeAction",r.params,r)!==!1&&(this._afterFilterRedirect||(s=this[t](e)),r.operationOccurred||this.render()),r.finishOperation(),s},e.prototype.redirect=function(t){var e;return e=this._actionFrames[this._actionFrames.length-1],e?e.operationOccurred?(c.warn("Warning! Trying to redirect but an action has already been taken during "+this.get("routingKey")+"."+(e.action||this.get("action"))),void 0):(e.startAndFinishOperation(),null!=this._afterFilterRedirect?c.warn("Warning! Multiple actions trying to redirect!"):this._afterFilterRedirect=t):("Object"===h(t)&&(t.controller||(t.controller=this.get("routingKey"))),Batman.redirect(t))},e.prototype.render=function(t){var e,r,n,o,i,s,a,u,c,p;return null==t&&(t={}),(r=null!=(s=this._actionFrames)?s[this._actionFrames.length-1]:void 0)&&r.startOperation(),t===!1?(r.finishOperation(),void 0):(e=(null!=r?r.action:void 0)||this.get("action"),(n=t.view)?t.view=null:(t.viewClass||(t.viewClass=this._viewClassForAction(e)),t.source||(t.source=(null!=(a=t.viewClass)?a.prototype.source:void 0)||l.underscore(this.get("routingKey")+"/"+e)),n=this.renderCache.viewForOptions(t)),n&&(n.once("viewDidAppear",function(){return null!=r?r.finishOperation():void 0}),i=t.into||this.defaultRenderYield,(o=Batman.DOM.Yield.withName(i).contentView)&&(o===n||o.isDead||o.die()),n.contentFor||n.parentNode||n.set("contentFor",i),n.set("controller",this),null!=(u=Batman.currentApp)&&null!=(c=u.layout)&&null!=(p=c.subviews)&&p.add(n),this.set("currentView",n)),n)},e.prototype.scrollToHash=function(t){return null==t&&(t=this.get("params")["#"]),Batman.DOM.scrollIntoView(t)},e.prototype._resetActionFrames=function(){return this._actionFrames=[]},e.prototype._viewClassForAction=function(t){var e,r;return e=this.get("routingKey").replace("/","_"),(null!=(r=Batman.currentApp)?r[l.camelize(""+e+"_"+t+"_view")]:void 0)||Batman.View},e}(n)},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(1).BatmanObject,t.exports=o=function(t){function e(t,r){e.__super__.constructor.call(this,t),this.once("complete",r)}return s(e,t),e.prototype.operationOccurred=!1,e.prototype.remainingOperations=0,e.prototype.event("complete").oneShot=!0,e.prototype.startOperation=function(t){return null==t&&(t={}),t.internal||(this.operationOccurred=!0),this._changeOperationsCounter(1),!0},e.prototype.finishOperation=function(){return this._changeOperationsCounter(-1),!0},e.prototype.startAndFinishOperation=function(t){return this.startOperation(t),this.finishOperation(t),!0},e.prototype._changeOperationsCounter=function(t){var e;this.remainingOperations+=t,0===this.remainingOperations&&this.fire("complete"),null!=(e=this.parentFrame)&&e._changeOperationsCounter(t)},e}(n)},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(102),t.exports=o=function(t){function e(){e.__super__.constructor.apply(this,arguments),this.keyQueue=[]}return s(e,t),e.prototype.maximumLength=4,e.prototype.viewForOptions=function(t){return Batman.config.cacheViews||t.cache||t.viewClass.prototype.cache?this.getOrSet(t,function(e){return function(){return e._newViewFromOptions(Batman.extend({},t))}}(this)):this._newViewFromOptions(t)},e.prototype._newViewFromOptions=function(t){return new t.viewClass(t)},e.wrapAccessor(function(t){return{cache:!1,get:function(e){var r;return r=t.get.call(this,e),r&&this._addOrBubbleKey(e),r},set:function(e){var n;return n=t.set.apply(this,arguments),n.set("cached",!0),this._addOrBubbleKey(e),this._evictExpiredKeys(),n},unset:function(e){var r;return r=t.unset.apply(this,arguments),r.set("cached",!1),this._removeKeyFromQueue(e),r}}}),e.prototype.equality=function(t,e){var r;if(Object.keys(t).length!==Object.keys(e).length)return!1;for(r in t)if("view"!==r&&t[r]!==e[r])return!1;return!0},e.prototype.reset=function(){var t,e,r,n;for(n=this.keyQueue.slice(0),e=0,r=n.length;r>e;e++)t=n[e],this.unset(t)},e.prototype._addOrBubbleKey=function(t){return this._removeKeyFromQueue(t),this.keyQueue.unshift(t)},e.prototype._removeKeyFromQueue=function(t){var e,r,n,o,i;for(i=this.keyQueue,e=n=0,o=i.length;o>n;e=++n)if(r=i[e],this.equality(r,t)){this.keyQueue.splice(e,1);break}return t},e.prototype._evictExpiredKeys=function(){var t,e,r,n,o,i;if(this.length>this.maximumLength)for(t=this.keyQueue.slice(0),e=n=o=this.maximumLength,i=t.length;i>=o?i>n:n>i;e=i>=o?++n:--n)r=t[e],this.get(r).isInDOM||this.unset(r)},e}(n)},function(t,e,r){var n;n={CallbackActionRoute:r(146),ControllerActionRoute:r(147),Dispatcher:r(148),HashbangNavigator:r(149),NamedRouteQuery:r(150),Navigator:r(151),Params:r(152),ParamsPusher:r(153),ParamsReplacer:r(154),PushStateNavigator:r(155),Route:r(156),RouteMap:r(157),RouteMapBuilder:r(158),UrlParams:r(159)},t.exports=n},function(t,e,r){var n,o,i,s={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=r(1).BatmanObject,i=r(4).RouteMapBuilder,t.exports=n=function(t){function u(){return u.__super__.constructor.apply(this,arguments)}var e,r,n,o,s;for(a(u,t),u.classAccessor("currentParams",{get:function(){var t;if(t=this.get("navigator"))return new Batman.Params({},t)},"final":!0}),u.classAccessor("paramsManager",{get:function(){var t,e;if(t=this.get("navigator"))return e=this.get("currentParams"),e.replacer=new Batman.ParamsReplacer(t,e)},"final":!0}),u.classAccessor("paramsPusher",{get:function(){var t,e;if(t=this.get("navigator"))return e=this.get("currentParams"),e.pusher=new Batman.ParamsPusher(t,e)},"final":!0}),u.classAccessor("routes",function(){return new Batman.NamedRouteQuery(this.get("routeMap"))}),u.classAccessor("routeMap",function(){return new Batman.RouteMap}),u.classAccessor("routeMapBuilder",function(){return new Batman.RouteMapBuilder(this,this.get("routeMap"))}),u.classAccessor("dispatcher",function(){return new Batman.Dispatcher(this,this.get("routeMap"))}),u.classAccessor("controllers",function(){return this.get("dispatcher.controllers")}),u.layout=void 0,u.shouldAllowEvent={},s=i.BUILDER_FUNCTIONS,r=function(t){return u[t]=function(){var e;return(e=this.get("routeMapBuilder"))[t].apply(e,arguments)}},n=0,o=s.length;o>n;n++)e=s[n],r(e);return u.event("ready").oneShot=!0,u.event("run").oneShot=!0,u.run=function(){var t,e,r;if(Batman.currentApp){if(Batman.currentApp===this)return;Batman.currentApp.stop()}return this.hasRun?!1:this.isPrevented("run")?(this.wantsToRun=!0,!1):(delete this.wantsToRun,Batman.currentApp=this,Batman.App.set("current",this),null==this.get("dispatcher")&&(this.set("dispatcher",new Batman.Dispatcher(this,this.get("routeMap"))),this.set("controllers",this.get("dispatcher.controllers"))),null==this.get("navigator")&&(this.set("navigator",Batman.Navigator.forApp(this)),Batman.navigator=this.get("navigator"),this.on("run",function(t){return function(){return Object.keys(t.get("dispatcher").routeMap).length>0?Batman.navigator.start():void 0}}(this))),this.observe("layout",function(t){return function(e){return null!=e?e.on("ready",function(){return t.fire("ready")}):void 0}}(this)),e=this.get("layout"),e?"string"==typeof e&&(r=this[Batman.helpers.camelize(e)+"View"]):null!==e&&(r=t=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,t),e}(Batman.View)),r&&(e=this.set("layout",new r({node:document.documentElement})),e.propagateToSubviews("viewWillAppear"),e.initializeBindings(),e.propagateToSubviews("isInDOM",!0),e.propagateToSubviews("viewDidAppear")),Batman.config.translations&&this.set("t",Batman.I18N.get("translations")),this.hasRun=!0,this.fire("run"),this)},u.event("ready").oneShot=!0,u.event("stop").oneShot=!0,u.stop=function(){var t;return null!=(t=this.navigator)&&t.stop(),Batman.navigator=null,this.hasRun=!1,this.fire("stop"),this},u}(o)},function(t){var n,o,i=[].slice,s={}.hasOwnProperty,a=[].indexOf||function(t){for(var e=0,r=this.length;r>e;e++)if(e in this&&this[e]===t)return e;return-1};o=Object.prototype.toString,n={hashKeyFor:function(t){var e,r;return(e=null!=t?"function"==typeof t.hashKey?t.hashKey():void 0:void 0)?e:(r=o.call(t),"[object Array]"===r?r:t)},get:function(t,e){return"function"==typeof t.get?t.get(e):Batman.Keypath.forBaseAndKey(t,e).getValue()},getPath:function(t,e){var r,o,i;for(o=0,i=e.length;i>o;o++){if(r=e[o],null==t)return;if(t=n.get(t,r),null==t)return t}return t},extend:function(){var t,e,r,n,o,s,a;for(n=arguments[0],r=arguments.length>=2?i.call(arguments,1):[],s=0,a=r.length;a>s;s++){e=r[s];for(t in e)o=e[t],n[t]=o}return n},mixin:function(){var t,e,r,o,a,u,c,p;for(a=arguments[0],o=arguments.length>=2?i.call(arguments,1):[],t="function"==typeof a.set,c=0,p=o.length;p>c;c++)if(r=o[c],"Object"===n.typeOf(r)){for(e in r)s.call(r,e)&&(u=r[e],"initialize"!==e&&"uninitialize"!==e&&"prototype"!==e&&(t?a.set(e,u):null!=a.nodeName?Batman.data(a,e,u):a[e]=u));"function"==typeof r.initialize&&r.initialize.call(a)}return a},unmixin:function(){var t,e,r,n,o,s;for(t=arguments[0],n=arguments.length>=2?i.call(arguments,1):[],o=0,s=n.length;s>o;o++){r=n[o];for(e in r)"initialize"!==e&&"uninitialize"!==e&&delete t[e];"function"==typeof r.uninitialize&&r.uninitialize.call(t)}return t},typeOf:function(t){return t===void 0?"Undefined":o.call(t).slice(8,-1)},forEach:function(t,e,r){var n,o,i,s,a,u;if(t.forEach)t.forEach(e,r);else if(t.indexOf)for(o=a=0,u=t.length;u>a;o=++a)n=t[o],e.call(r,n,o,t);else for(i in t)s=t[i],e.call(r,i,s,t)},objectHasKey:function(t,e){return"function"==typeof t.hasKey?t.hasKey(e):e in t},functionName:function(t){var e;return t.__name__?t.__name__:t.name?t.name:null!=(e=(""+t).match(/\W*function\s+([\w\$]+)\(/))?e[1]:void 0},contains:function(t,e){return t.indexOf?a.call(t,e)>=0:"function"==typeof t.has?t.has(e):n.objectHasKey(t,e)},initializeObject:function(t){return Batman.Object.prototype.initializeBatman.call(t)},exportHelpers:function(t){var e,r,n,o;for(o=["mixin","extend","unmixin","redirect","typeOf","redirect","setImmediate","clearImmediate"],r=0,n=o.length;n>r;r++)e=o[r],t["$"+e]=Batman[e];
return t},exportGlobals:function(){return Batman.exportHelpers(Batman.container)}},t.exports=n},function(t){var n;t.exports=n={isEnumerable:!0,map:function(t,e){var r;return null==e&&(e=Batman.container),r=[],this.forEach(function(){return r.push(t.apply(e,arguments))}),r},mapToProperty:function(t){var e;return e=[],this.forEach(function(r){return e.push(Batman.get(r,t))}),e},every:function(t,e){var r;return null==e&&(e=Batman.container),r=!0,this.forEach(function(){return r=r&&!!t.apply(e,arguments)}),r},some:function(t,e){var r;return null==e&&(e=Batman.container),r=!1,this.forEach(function(){return r=r||!!t.apply(e,arguments)}),r},reduce:function(t,e){var r,n;return r=0,n=null!=e,this.forEach(function(){return function(o,i){return n?(e=t(e,o,i,r,self),r++):(e=o,n=!0,void 0)}}(this)),e},filter:function(t){var e,r;return e=new this.constructor,e.add?r=function(e){return function(r,n,o){return t(n,o,e)&&r.add(n),r}}(this):e.set?r=function(e){return function(r,n,o){return t(n,o,e)&&r.set(n,o),r}}(this):(e.push||(e=[]),r=function(e){return function(r,n,o){return t(n,o,e)&&r.push(n),r}}(this)),this.reduce(r,e)},find:function(t,e){var r;return null==e&&(e=Batman.container),r=void 0,this.forEach(function(n,o){return null==r?t.call(e,n,o,this)?r=n:void 0:void 0}),r},count:function(t,e){var r;return null==e&&(e=Batman.container),t?(r=0,this.forEach(function(n){return function(o,i){return t.call(e,o,i,n)?r++:void 0}}(this)),r):this.length},inGroupsOf:function(t){var e,r,n;return n=[],e=!1,r=0,this.forEach(function(o){return 0===r++%t&&(e=[],n.push(e)),e.push(o)}),n}}},function(t){var n;t.exports=n={suppressed:!1,DevelopmentError:function(){var t;return t=function(t){return this.message=t,this.name="DevelopmentError"},t.prototype=Error.prototype,t}(),_ie_console:function(t,e){var r,n,o,i;for(1!==e.length&&"undefined"!=typeof console&&null!==console&&console[t]("..."+t+" of "+e.length+" items..."),i=[],n=0,o=e.length;o>n;n++)r=e[n],i.push("undefined"!=typeof console&&null!==console?console[t](r):void 0);return i},suppress:function(t){return n.suppressed=!0,t?(t(),n.suppressed=!1):void 0},unsuppress:function(){return n.suppressed=!1},log:function(){return n.suppressed||null==("undefined"!=typeof console&&null!==console?console.log:void 0)?void 0:console.log.apply?console.log.apply(console,arguments):n._ie_console("log",arguments)},warn:function(){return n.suppressed||null==("undefined"!=typeof console&&null!==console?console.warn:void 0)?void 0:console.warn.apply?console.warn.apply(console,arguments):n._ie_console("warn",arguments)},error:function(t){throw new n.DevelopmentError(t)},assert:function(t,e){return t?void 0:n.error(e)},"do":function(t){return n.suppressed?void 0:t()},addFilters:function(){return Batman.extend(Batman.Filters,{log:function(t){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log&&console.log(arguments),t},logStack:function(t){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log&&console.log(n.currentFilterStack),t}})},deprecated:function(t,e){return Batman.developer.warn(""+t+" has been deprecated.",e||"")}},n.assert(function(){}.bind,"Error! Batman needs Function.bind to work! Please shim it using something like es5-shim or augmentjs!")},function(t,e,r){var n,o;o=r(89).hashKeyFor,t.exports=n=function(){function t(t,e){this.base=t,this.key=e,this._preventCount=0}return t.forBaseAndKey=function(e,r){return e.isEventEmitter?e.event(r):new t(e,r)},t.prototype.isEvent=!0,t.prototype.isEqual=function(t){return this.constructor===t.constructor&&this.base===t.base&&this.key===t.key},t.prototype.hashKey=function(){var t;return this.hashKey=function(){return t},t="<Event base: "+o(this.base)+', key: "'+o(this.key)+'">'},t.prototype.addHandler=function(t){return this.handlers||(this.handlers=[]),-1===this.handlers.indexOf(t)&&this.handlers.push(t),this.oneShot&&this.autofireHandler(t),this},t.prototype.removeHandler=function(t){var e;return this.handlers&&-1!==(e=this.handlers.indexOf(t))&&this.handlers.splice(e,1),this},t.prototype.eachHandler=function(t){var e,r,n,o,i,s,a,u,c,p,l,h;if(null!=(i=this.handlers)&&i.slice().forEach(t),null!=(s=this.base)?s.isEventEmitter:void 0)for(r=this.key,u=null!=(a=this.base._batman)?a.ancestors():void 0,n=0,o=u.length;o>n;n++)e=u[n],e.isEventEmitter&&(null!=(c=e._batman)?null!=(p=c.events)?p.hasOwnProperty(r):void 0:void 0)&&null!=(l=e.event(r,!1))&&null!=(h=l.handlers)&&h.slice().forEach(t)},t.prototype.clearHandlers=function(){return this.handlers=void 0},t.prototype.handlerContext=function(){return this.base},t.prototype.prevent=function(){return++this._preventCount},t.prototype.allow=function(){return this._preventCount&&--this._preventCount,this._preventCount},t.prototype.isPrevented=function(){return this._preventCount>0},t.prototype.autofireHandler=function(t){return this._oneShotFired&&null!=this._oneShotArgs?t.apply(this.handlerContext(),this._oneShotArgs):void 0},t.prototype.resetOneShot=function(){return this._oneShotFired=!1,this._oneShotArgs=null},t.prototype.fire=function(){return this.fireWithContext(this.handlerContext(),arguments)},t.prototype.fireWithContext=function(t,e){return this.isPrevented()||this._oneShotFired?!1:(this.oneShot&&(this._oneShotFired=!0,this._oneShotArgs=e),this.eachHandler(function(r){return r.apply(t,e)}))},t.prototype.allowAndFire=function(){return this.allowAndFireWithContext(this.handlerContext(),arguments)},t.prototype.allowAndFireWithContext=function(t,e){return this.allow(),this.fireWithContext(t,e)},t}()},function(t,e,r){var n,o,i,s=[].slice;n=r(92),i=r(143),t.exports=o={isEventEmitter:!0,hasEvent:function(t){var e,r;return null!=(e=this._batman)?"function"==typeof e.get?null!=(r=e.get("events"))?r.hasOwnProperty(t):void 0:void 0:void 0},event:function(t,e){var r,o,s,a,u,c,p,l,h,f,d,y;if(null==e&&(e=!0),i.initialize(this),o=this.eventClass||n,null!=(h=this._batman.events)?h.hasOwnProperty(t):void 0)return a=this._batman.events[t];for(f=this._batman.ancestors(),p=0,l=f.length;l>p&&(r=f[p],!(a=null!=(d=r._batman)?null!=(y=d.events)?y[t]:void 0:void 0));p++);return e||(null!=a?a.oneShot:void 0)?(s=(c=this._batman).events||(c.events={}),u=s[t]=new o(this,t),u.oneShot=null!=a?a.oneShot:void 0,u):a},on:function(){var t,e,r,n,o,i;for(r=arguments.length>=2?s.call(arguments,0,n=arguments.length-1):(n=0,[]),t=arguments[n++],o=0,i=r.length;i>o;o++)e=r[o],this.event(e).addHandler(t);return!0},off:function(){var t,e,r,n,o,i;for(r=arguments.length>=2?s.call(arguments,0,n=arguments.length-1):(n=0,[]),t=arguments[n++],r.length||(e=t,this.event(e).clearHandlers()),o=0,i=r.length;i>o;o++)e=r[o],this.event(e).removeHandler(t);return!0},once:function(t,e){var r,n;return r=this.event(t),n=function(){return e.apply(this,arguments),r.removeHandler(n)},r.addHandler(n)},registerAsMutableSource:function(){return Batman.Property.registerSource(this)},mutate:function(t){var e;return this.prevent("change"),e=t.call(this),this.allowAndFire("change",this,this),e},mutation:function(t){return function(){var e,r;return e=t.apply(this,arguments),null!=(r=this.event("change",!1))&&r.fire(this,this),e}},prevent:function(t){return this.event(t).prevent(),this},allow:function(t){return this.event(t).allow(),this},fire:function(){var t,e,r;return e=arguments[0],t=arguments.length>=2?s.call(arguments,1):[],null!=(r=this.event(e,!1))?r.fireWithContext(this,t):void 0},allowAndFire:function(){var t,e,r;return e=arguments[0],t=arguments.length>=2?s.call(arguments,1):[],null!=(r=this.event(e,!1))?r.allowAndFireWithContext(this,t):void 0},isPrevented:function(t){var e;return null!=(e=this.event(t,!1))?e.isPrevented():void 0}}},function(t,e,r){var n,o,i,s,a,u={}.hasOwnProperty,c=function(t,e){function n(){this.constructor=t}for(var r in e)u.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};a=r(89).hashKeyFor,o=r(144),i=[],s=!0,t.exports=n=function(t){function e(t,e){this.base=t,this.key=e}return c(e,t),e._sourceTrackerStack=i,e._sourceTrackerStackValid=s,e.defaultAccessor={get:function(t){return this[t]},set:function(t,e){return this[t]=e},unset:function(t){var e;return e=this[t],delete this[t],e},cache:!1},e.defaultAccessorForBase=function(t){var r;return(null!=(r=t._batman)?r.getFirst("defaultAccessor"):void 0)||e.defaultAccessor},e.accessorForBaseAndKey=function(t,e){var r,n,o,i,s,a,u,c,p;if(null!=(o=t._batman)&&(r=null!=(a=o.keyAccessors)?a.get(e):void 0,!r))for(u=o.ancestors(),i=0,s=u.length;s>i&&(n=u[i],!(r=null!=(c=n._batman)?null!=(p=c.keyAccessors)?p.get(e):void 0:void 0));i++);return r||this.defaultAccessorForBase(t)},e.forBaseAndKey=function(t,e){return t.isObservable?t.property(e):new this(t,e)},e.withoutTracking=function(t){return this.wrapTrackingPrevention(t)()},e.wrapTrackingPrevention=function(t){return function(){e.pushDummySourceTracker();try{return t.apply(this,arguments)}finally{e.popSourceTracker()}}},e.registerSource=function(t){var r;if(t.isEventEmitter||t instanceof e)return s?r=i[i.length-1]:(r=[],i.push(r),s=!0),null!=r&&r.push(t),void 0},e.pushSourceTracker=function(){return s?s=!1:i.push([])},e.popSourceTracker=function(){return s?i.pop():(s=!0,void 0)},e.pushDummySourceTracker=function(){return s||(i.push([]),s=!0),i.push(null)},e.prototype._isolationCount=0,e.prototype.cached=!1,e.prototype.value=null,e.prototype.sources=null,e.prototype.isProperty=!0,e.prototype.isDead=!1,e.prototype.isBatchingChanges=!1,e.prototype.registerAsMutableSource=function(){return e.registerSource(this)},e.prototype.isEqual=function(t){return this.constructor===t.constructor&&this.base===t.base&&this.key===t.key},e.prototype.hashKey=function(){return this._hashKey||(this._hashKey="<Property base: "+a(this.base)+', key: "'+a(this.key)+'">')},e.prototype.accessor=function(){return this._accessor||(this._accessor=this.constructor.accessorForBaseAndKey(this.base,this.key))},e.prototype.eachObserver=function(t){var e,r,n,o,i,s,a,u,c,p,l,h,f,d;if(n=this.key,r=null!=(h=this.handlers)?h.slice():void 0)for(s=0,c=r.length;c>s;s++)o=r[s],t(o);if(this.base.isObservable)for(f=this.base._batman.ancestors(),a=0,p=f.length;p>a;a++)if(e=f[a],e.isObservable&&e.hasProperty(n)&&(i=e.property(n),r=null!=(d=i.handlers)?d.slice():void 0))for(u=0,l=r.length;l>u;u++)o=r[u],t(o)},e.prototype.observers=function(){var t;return t=[],this.eachObserver(function(e){return t.push(e)}),t},e.prototype.hasObservers=function(){return this.observers().length>0},e.prototype.updateSourcesFromTracker=function(){var t,e,r,n,o,i,s,a,u;if(e=this.constructor.popSourceTracker(),t=this.sourceChangeHandler(),this.sources)for(a=this.sources,n=0,i=a.length;i>n;n++)r=a[n],null!=r&&(r.on?r.off("change",t):r.removeHandler(t));if(this.sources=e,this.sources)for(u=this.sources,o=0,s=u.length;s>o;o++)r=u[o],null!=r&&(r.on?r.on("change",t):r.addHandler(t));return null},e.prototype.getValue=function(){if(this.registerAsMutableSource(),!this.isCached()){this.constructor.pushSourceTracker();try{this.value=this.valueFromAccessor(),this.cached=!0}finally{this.updateSourcesFromTracker()}}return this.value},e.prototype.isCachable=function(){var t;return this.isFinal()?!0:(t=this.accessor().cache,null!=t?!!t:!0)},e.prototype.isCached=function(){return this.isCachable()&&this.cached},e.prototype.isFinal=function(){return this.final||(this.final=!!this.accessor()["final"])},e.prototype.refresh=function(){var t,e;return this.cached=!1,t=this.value,e=this.getValue(),e===t||this.isIsolated()||this.fire(e,t,this.key),void 0!==this.value&&this.isFinal()?this.lockValue():void 0},e.prototype.sourceChangeHandler=function(){return this._sourceChangeHandler||(this._sourceChangeHandler=function(t){return function(){return t._handleSourceChange()}}(this))},e.prototype._handleSourceChange=function(){return this.isIsolated()?this._needsRefresh=!0:this.isDead?this._removeHandlers():this.isFinal()||this.hasObservers()?this.isBatchingChanges?void 0:this.refresh():(this.cached=!1,this._removeHandlers())},e.prototype.valueFromAccessor=function(){var t;return null!=(t=this.accessor().get)?t.call(this.base,this.key):void 0},e.prototype.setValue=function(t){var e;if(e=this.accessor().set)return this._changeValue(function(){return e.call(this.base,this.key,t)})},e.prototype.unsetValue=function(){var t;if(t=this.accessor().unset)return this._changeValue(function(){return t.call(this.base,this.key)})},e.prototype._changeValue=function(t){var e;this.cached=!1,this.constructor.pushDummySourceTracker();try{e=t.apply(this),this.refresh()}finally{this.constructor.popSourceTracker()}return this.isCached()||this.hasObservers()||this.die(),e},e.prototype.forget=function(t){return null!=t?this.removeHandler(t):this.clearHandlers()},e.prototype.observeAndFire=function(t){return this.observe(t),t.call(this.base,this.value,this.value,this.key)},e.prototype.observe=function(t){return this.addHandler(t),null==this.sources&&this.getValue(),this},e.prototype.observeOnce=function(t){var e,r;return r=this,e=function(){return t.apply(this,arguments),r.removeHandler(e)},this.addHandler(e),null==this.sources&&this.getValue(),this},e.prototype._removeHandlers=function(){var t,e,r,n,o;if(t=this.sourceChangeHandler(),this.sources)for(o=this.sources,r=0,n=o.length;n>r;r++)e=o[r],e.on?e.off("change",t):e.removeHandler(t);return delete this.sources,this.clearHandlers()},e.prototype.lockValue=function(){return this._removeHandlers(),this.getValue=function(){return this.value},this.setValue=this.unsetValue=this.refresh=this.observe=function(){}},e.prototype.die=function(){var t,e;return this._removeHandlers(),null!=(t=this.base._batman)&&null!=(e=t.properties)&&e.unset(this.key),this.base=null,this.isDead=!0},e.prototype.isolate=function(){return 0===this._isolationCount&&(this._preIsolationValue=this.getValue()),this._isolationCount++},e.prototype.expose=function(){return 1===this._isolationCount?(this._isolationCount--,this._needsRefresh?(this.value=this._preIsolationValue,this.refresh()):this.value!==this._preIsolationValue&&this.fire(this.value,this._preIsolationValue,this.key),this._preIsolationValue=null):this._isolationCount>0?this._isolationCount--:void 0},e.prototype.isIsolated=function(){return this._isolationCount>0},e}(o)},function(t,e,r){var n,o,i,s={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};i=r(89).getPath,o=r(94),t.exports=n=function(t){function e(t,r){"string"==typeof r?(this.segments=r.split("."),this.depth=this.segments.length):(this.segments=[r],this.depth=1),e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.isCachable=function(){return 1===this.depth?e.__super__.isCachable.apply(this,arguments):!0},e.prototype.terminalProperty=function(){var t;return t=i(this.base,this.segments.slice(0,-1)),null!=t?e.forBaseAndKey(t,this.segments[this.depth-1]):void 0},e.prototype.valueFromAccessor=function(){return 1===this.depth?e.__super__.valueFromAccessor.apply(this,arguments):i(this.base,this.segments)},e.prototype.setValue=function(t){var r;return 1===this.depth?e.__super__.setValue.apply(this,arguments):null!=(r=this.terminalProperty())?r.setValue(t):void 0},e.prototype.unsetValue=function(){var t;return 1===this.depth?e.__super__.unsetValue.apply(this,arguments):null!=(t=this.terminalProperty())?t.unsetValue():void 0},e}(o)},function(t,e,r){var n,o,i,s,a=[].slice;n=r(95),i=r(101),s=r(143),t.exports=o={isObservable:!0,hasProperty:function(t){var e,r;return null!=(e=this._batman)?null!=(r=e.properties)?"function"==typeof r.hasKey?r.hasKey(t):void 0:void 0:void 0},property:function(t){var e,r,o;return s.initialize(this),r=this.propertyClass||n,e=(o=this._batman).properties||(o.properties=new i),e.objectKey(t)?e.getObject(t)||e.setObject(t,new r(this,t)):e.getString(t)||e.setString(t,new r(this,t))},get:function(t){return this.property(t).getValue()},set:function(t,e){return this.property(t).setValue(e)},unset:function(t){return this.property(t).unsetValue()},getOrSet:i.prototype.getOrSet,toggle:function(t){return this.set(t,!this.get(t))},increment:function(t,e){var r;return null==e&&(e=1),r=this.get(t)||0,this.set(t,r+e)},decrement:function(t,e){var r;return null==e&&(e=1),r=this.get(t)||0,this.set(t,r-e)},forget:function(t,e){var r;return t?this.property(t).forget(e):null!=(r=this._batman.properties)&&r.forEach(function(t,e){return e.forget()}),this},observe:function(){var t,e,r;return e=arguments[0],t=arguments.length>=2?a.call(arguments,1):[],(r=this.property(e)).observe.apply(r,t),this},observeAndFire:function(){var t,e,r;return e=arguments[0],t=arguments.length>=2?a.call(arguments,1):[],(r=this.property(e)).observeAndFire.apply(r,t),this},observeOnce:function(){var t,e,r;return e=arguments[0],t=arguments.length>=2?a.call(arguments,1):[],(r=this.property(e)).observeOnce.apply(r,t),this}}},function(t,e,r){var n,o,i,s,a,u,c,p,l,h,f,d,y,m,g=[].slice,v={}.hasOwnProperty,_=function(t,e){function n(){this.constructor=t}for(var r in e)v.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};y=r(143),a=r(96),u=r(94),i=r(93),c=r(101),n=r(91),m=r(89),f=m.typeOf,l=m.mixin,p=function(t,e){var r,n,o,i;for("function"==typeof e&&(e={get:e}),i=["cachable","cacheable"],n=0,o=i.length;o>n;n++)r=i[n],r in e&&(Batman.Developer.warn('Property accessor option "'+r+'" is deprecated. Use "cache" instead.'),"cache"in e||(e.cache=e[r]));return e},h=function(t){return function(e){return{get:function(r){var n,o,i,s,a;return null!=(o=e.get.apply(this,arguments))?o:(n=!1,i=void 0,null==(s=this._batman).promises&&(s.promises={}),null==(a=this._batman.promises)[r]&&(a[r]=function(e){return function(){var o,s;return o=function(t,o){return n&&e.set(r,o),i=o},s=t.call(e,o,r),null==i&&(i=s),!0}}(this)()),n=!0,i)},cache:!0}}},d=function(t,e){var r,n;e=("function"==typeof e?e(t):void 0)||e;for(r in t)n=t[r],r in e||(e[r]=n);return e},s={_defineAccessor:function(){var t,e,r,n,o,i,s,a;if(r=arguments.length>=2?g.call(arguments,0,o=arguments.length-1):(o=0,[]),t=arguments[o++],null==t)return u.defaultAccessorForBase(this);if(0===r.length&&"Object"!==(a=f(t))&&"Function"!==a)return u.accessorForBaseAndKey(this,t);if("function"==typeof t.promise)return this._defineWrapAccessor.apply(this,g.call(r).concat([h(t.promise)]));if(this.initializeBatman(),0===r.length)this._batman.defaultAccessor=p(this,t);else for((n=this._batman).keyAccessors||(n.keyAccessors=new c),i=0,s=r.length;s>i;i++)e=r[i],this._batman.keyAccessors.set(e,p(this,t));return!0},_defineWrapAccessor:function(){var t,e,r,n,o,i;if(e=arguments.length>=2?g.call(arguments,0,n=arguments.length-1):(n=0,[]),r=arguments[n++],this.initializeBatman(),0===e.length)this._defineAccessor(d(this._defineAccessor(),r));else for(o=0,i=e.length;i>o;o++)t=e[o],this._defineAccessor(t,d(this._defineAccessor(t),r));return!0},_resetPromises:function(){var t;if(null!=this._batman.promises)for(t in this._batman.promises)this._resetPromise(t)},_resetPromise:function(t){this.unset(t),this.property(t).cached=!1,delete this._batman.promises[t]}},t.exports=o=function(t){function r(){var t;t=arguments.length>=1?g.call(arguments,0):[],this.initializeBatman(),this.mixin.apply(this,t)}var e;return _(r,t),r.prototype.initializeBatman=function(){return y.initialize(this)},r.initializeBatman=function(){return this.prototype.initializeBatman.call(this)},r.prototype.initializeBatman.call(r),r.prototype.initializeBatman.call(r.prototype),l(r.prototype,s,i,a),l(r,s,i,a),r.classMixin=function(){return l.apply(null,[this].concat(g.call(arguments)))},r.mixin=function(){return this.classMixin.apply(this.prototype,arguments)},r.prototype.mixin=r.classMixin,r.classAccessor=r._defineAccessor,r.accessor=function(){var t;return(t=this.prototype)._defineAccessor.apply(t,arguments)},r.prototype.accessor=r._defineAccessor,r.wrapClassAccessor=r._defineWrapAccessor,r.wrapAccessor=function(){var t;return(t=this.prototype)._defineWrapAccessor.apply(t,arguments)},r.prototype.wrapAccessor=r._defineWrapAccessor,r.observeAll=function(){return this.prototype.observe.apply(this.prototype,arguments)},r.singleton=function(t){return null==t&&(t="sharedInstance"),this.classAccessor(t,{get:function(){var e;return this[e="_"+t]||(this[e]=new this)}})},r.accessor("_batmanID",function(){return this._batmanID()}),r.delegate=function(){var t,e,r;return e=arguments.length>=2?g.call(arguments,0,r=arguments.length-1):(r=0,[]),t=arguments[r++],null==t&&(t={}),t.to||n.warn("delegate must include to option",this,e),e.forEach(function(e){return function(r){return e.accessor(r,{get:function(){var e;return null!=(e=this.get(t.to))?e.get(r):void 0},set:function(e,n){var o;return null!=(o=this.get(t.to))?o.set(r,n):void 0},unset:function(){var e;return null!=(e=this.get(t.to))?e.unset(r):void 0}})}}(this))},r.classDelegate=function(){var t,e,r;return e=arguments.length>=2?g.call(arguments,0,r=arguments.length-1):(r=0,[]),t=arguments[r++],null==t&&(t={}),t.to||n.warn("delegate must include to option",this,e),e.forEach(function(e){return function(r){return e.classAccessor(r,{get:function(){var e;return null!=(e=this.get(t.to))?e.get(r):void 0},set:function(e,n){var o;return null!=(o=this.get(t.to))?o.set(r,n):void 0},unset:function(){var e;return null!=(e=this.get(t.to))?e.unset(r):void 0}})}}(this))},e=0,r.prototype._batmanID=function(){var t;return this._batman.check(this),null==(t=this._batman).id&&(t.id=e++),this._batman.id},r.prototype.hashKey=function(){var t;if("function"!=typeof this.isEqual)return(t=this._batman).hashKey||(t.hashKey="<Object "+this._batmanID()+">")},r.prototype.toJSON=function(){var t,e,r;e={};for(t in this)v.call(this,t)&&(r=this[t],"_batman"!==t&&"hashKey"!==t&&"_batmanID"!==t&&(e[t]=(null!=r?r.toJSON:void 0)?r.toJSON():r));return e},r.prototype.batchAccessorChanges=function(){var t,e,r,n,o,i,s,a,u,c,p;for(r=arguments.length>=2?g.call(arguments,0,s=arguments.length-1):(s=0,[]),i=arguments[s++],t=a=0,c=r.length;c>a;t=++a)e=r[t],n=r[t]=this.property(e),n.isBatchingChanges=!0;for(o=i.call(this),u=0,p=r.length;p>u;u++)n=r[u],n.isBatchingChanges=!1,n.refresh();return o},r}(Object)},function(t,e,r){var n,o,i,s={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(99),o=r(94),t.exports=i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.propertyClass=o,e}(n)},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=r(97),t.exports=n=function(t){function e(){this.accessor.apply(this,arguments)}return s(e,t),e}(o)},function(t,e,r){var n,o,i,s={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u=[].slice;n=r(97),o=r(94),t.exports=i=function(t){function e(t){e.__super__.constructor.call(this),null!=t&&this.set("target",t)}return a(e,t),e.prototype.isProxy=!0,e.accessor("target",o.defaultAccessor),e.accessor({get:function(t){var e;return null!=(e=this.get("target"))?e.get(t):void 0},set:function(t,e){var r;return null!=(r=this.get("target"))?r.set(t,e):void 0},unset:function(t){var e;return null!=(e=this.get("target"))?e.unset(t):void 0}}),e.delegatesToTarget=function(){var t;return t=arguments.length>=1?u.call(arguments,0):[],t.forEach(function(t){return function(e){return t.prototype[e]=function(){var t;return null!=(t=this.get("target"))?t[e].apply(t,arguments):void 0}}}(this))},e}(n)},function(t,e,r){var n,o,i,s,a,u,c=[].slice;n=r(90),u=r(89),i=u.extend,s=u.hashKeyFor,a=Object.prototype.toString,t.exports=o=function(){function t(t){this._storage={},this.length=0,null!=t&&this.update(t)}return i(t.prototype,n),t.prototype.hasKey=function(t){var e,r,n,o;if(this.objectKey(t)){if(!this._objectStorage)return!1;if(r=this._objectStorage[this.hashKeyFor(t)])for(n=0,o=r.length;o>n;n++)if(e=r[n],this.equality(e[0],t))return!0;return!1}return t=this.prefixedKey(t),this._storage.hasOwnProperty(t)},t.prototype.getObject=function(t){var e,r,n,o;if(this._objectStorage&&(r=this._objectStorage[this.hashKeyFor(t)]))for(n=0,o=r.length;o>n;n++)if(e=r[n],this.equality(e[0],t))return e[1]},t.prototype.getString=function(t){return this._storage["_"+t]},t.prototype.setObject=function(t,e){var r,n,o,i,s,a;for(this._objectStorage||(this._objectStorage={}),n=(o=this._objectStorage)[a=this.hashKeyFor(t)]||(o[a]=[]),i=0,s=n.length;s>i;i++)if(r=n[i],this.equality(r[0],t))return r[1]=e;return this.length++,n.push([t,e]),e},t.prototype.setString=function(t,e){return t="_"+t,null==this._storage[t]&&this.length++,this._storage[t]=e},t.prototype.get=function(t){var e,r,n,o;if(!this.objectKey(t))return this._storage[this.prefixedKey(t)];if(this._objectStorage&&(r=this._objectStorage[this.hashKeyFor(t)]))for(n=0,o=r.length;o>n;n++)if(e=r[n],this.equality(e[0],t))return e[1]},t.prototype.set=function(t,e){var r,n,o,i,s,a;if(this.objectKey(t)){for(this._objectStorage||(this._objectStorage={}),n=(o=this._objectStorage)[a=this.hashKeyFor(t)]||(o[a]=[]),i=0,s=n.length;s>i;i++)if(r=n[i],this.equality(r[0],t))return r[1]=e;return this.length++,n.push([t,e]),e}return t=this.prefixedKey(t),null==this._storage[t]&&this.length++,this._storage[t]=e},t.prototype.unset=function(t){var e,r,n,o,i,s,a,u,c,p;if(!this.objectKey(t))return t=this.prefixedKey(t),s=this._storage[t],null!=this._storage[t]&&(this.length--,delete this._storage[t]),s;if(this._objectStorage&&(e=this.hashKeyFor(t),i=this._objectStorage[e]))for(r=u=0,c=i.length;c>u;r=++u)if(p=i[r],n=p[0],a=p[1],this.equality(n,t))return o=i.splice(r,1),i.length||delete this._objectStorage[e],this.length--,o[0][1]},t.prototype.getOrSet=function(t,e){var r;return r=this.get(t),r||(r=e(),this.set(t,r)),r},t.prototype.prefixedKey=function(t){return"_"+t},t.prototype.unprefixedKey=function(t){return t.slice(1)},t.prototype.hashKeyFor=s,t.prototype.equality=function(t,e){return t===e?!0:t!==t&&e!==e?!0:(null!=t?"function"==typeof t.isEqual?t.isEqual(e):void 0:void 0)&&(null!=e?"function"==typeof e.isEqual?e.isEqual(t):void 0:void 0)?!0:!1},t.prototype.objectKey=function(t){return"string"!=typeof t},t.prototype.forEach=function(t,e){var r,n,o,i,s,a,u,c,p,l,h;if(o=[],this._objectStorage){c=this._objectStorage;for(r in c)for(s=c[r],p=s.slice(),a=0,u=p.length;u>a;a++)l=p[a],n=l[0],i=l[1],o.push(t.call(e,n,i,this))}h=this._storage;for(r in h)i=h[r],o.push(t.call(e,this.unprefixedKey(r),i,this));return o},t.prototype.keys=function(){var e;return e=[],t.prototype.forEach.call(this,function(t){return e.push(t)}),e},t.prototype.toArray=t.prototype.keys,t.prototype.clear=function(){return this._storage={},delete this._objectStorage,this.length=0},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.merge=function(){var t,e,r,n,o;for(r=arguments.length>=1?c.call(arguments,0):[],e=new this.constructor,r.unshift(this),n=0,o=r.length;o>n;n++)t=r[n],t.forEach(function(t,r){return e.set(t,r)});return e},t.prototype.update=function(t){var e,r;for(e in t)r=t[e],this.set(e,r)},t.prototype.replace=function(t){return this.forEach(function(e){return function(r){return r in t?void 0:e.unset(r)}}(this)),this.update(t)},t.prototype.toObject=function(){var t,e,r,n,o,i;e={},o=this._storage;for(t in o)n=o[t],e[this.unprefixedKey(t)]=n;if(this._objectStorage){i=this._objectStorage;for(t in i)r=i[t],e[t]=r[0][1]}return e},t.prototype.toJSON=function(){var t,e,r,n,o,i,s,a;e={},i=this._storage;for(t in i)n=i[t],e[this.unprefixedKey(t)]=(null!=n?"function"==typeof n.toJSON?n.toJSON():void 0:void 0)||n;if(this._objectStorage){s=this._objectStorage;for(t in s)o=s[t],a=o[0],r=a[0],n=a[1],e[t]=(null!=n?"function"==typeof n.toJSON?n.toJSON():void 0:void 0)||n}return e},t}()},function(t,e,r){var n,o,i,s,a,u,c,p,l,h={}.hasOwnProperty,f=function(t,e){function n(){this.constructor=t}for(var r in e)h.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};a=r(101),n=r(97),o=r(90),s=r(94),l=r(89),u=l.extend,c=l.forEach,p=l.objectHasKey,t.exports=i=function(t){function g(){this.meta=new this.constructor.Metadata(this),a.apply(this,arguments),g.__super__.constructor.apply(this,arguments)}var e,r,i,l,h,d,y,m;for(f(g,t),g.Metadata=function(t){function e(t){this.hash=t}return f(e,t),u(e.prototype,o),e.accessor("length",function(){return this.hash.registerAsMutableSource(),this.hash.length}),e.accessor("isEmpty","keys","toArray",function(t){return this.hash.registerAsMutableSource(),this.hash[t]()}),e.prototype.forEach=function(){var t;return(t=this.hash).forEach.apply(t,arguments)},e}(n),u(g.prototype,o),g.prototype.propertyClass=s,g.defaultAccessor={cache:!1,get:a.prototype.get,set:g.mutation(function(t,e){var r,n;return r=a.prototype.get.call(this,t),n=a.prototype.set.call(this,t,e),null!=r&&r!==n?this.fire("itemsWereChanged",[t],[n],[r]):this.fire("itemsWereAdded",[t],[n]),n}),unset:g.mutation(function(t){var e;return e=a.prototype.unset.call(this,t),null!=e&&this.fire("itemsWereRemoved",[t],[e]),e})},g.accessor(g.defaultAccessor),g.prototype._preventMutationEvents=function(t){this.prevent("change"),this.prevent("itemsWereAdded"),this.prevent("itemsWereChanged"),this.prevent("itemsWereRemoved");try{return t.call(this)}finally{this.allow("change"),this.allow("itemsWereAdded"),this.allow("itemsWereChanged"),this.allow("itemsWereRemoved")}},g.prototype.clear=g.mutation(function(){var t,e,r;return e=this.keys(),r=function(){var r,n,o;for(o=[],r=0,n=e.length;n>r;r++)t=e[r],o.push(this.get(t));return o}.call(this),this._preventMutationEvents(function(){return this.forEach(function(t){return function(e){return t.unset(e)}}(this))}),a.prototype.clear.call(this),this.fire("itemsWereRemoved",e,r),r}),g.prototype.update=g.mutation(function(t){var e,r,n,o,i;return e=[],r=[],n=[],o=[],i=[],this._preventMutationEvents(function(){return c(t,function(t){return function(s,a){return t.hasKey(s)?(n.push(s),i.push(t.get(s)),o.push(t.set(s,a))):(e.push(s),r.push(t.set(s,a)))}}(this))}),e.length>0&&this.fire("itemsWereAdded",e,r),n.length>0?this.fire("itemsWereChanged",n,o,i):void 0}),g.prototype.replace=g.mutation(function(t){var e,r,n,o,i,s,a;return e=[],r=[],s=[],a=[],n=[],i=[],o=[],this._preventMutationEvents(function(){return this.forEach(function(e){return function(r){return p(t,r)?void 0:(s.push(r),a.push(e.unset(r)))}}(this)),c(t,function(t){return function(s,a){return t.hasKey(s)?(n.push(s),i.push(t.get(s)),o.push(t.set(s,a))):(e.push(s),r.push(t.set(s,a)))}}(this))}),e.length>0&&this.fire("itemsWereAdded",e,r),n.length>0&&this.fire("itemsWereChanged",n,o,i),s.length>0?this.fire("itemsWereRemoved",s,a):void 0}),y=["equality","hashKeyFor","objectKey","prefixedKey","unprefixedKey"],i=0,h=y.length;h>i;i++)e=y[i],g.prototype[e]=a.prototype[e];for(m=["hasKey","forEach","isEmpty","keys","toArray","merge","toJSON","toObject"],r=function(t){return g.prototype[t]=function(){return this.registerAsMutableSource(),a.prototype[t].apply(this,arguments)}},l=0,d=m.length;d>l;l++)e=m[l],r(e);return g}(n)},function(t,e,r){var n,o,i,s,a,u,c=[].slice;n=r(90),o=r(101),u=r(89),a=u.typeOf,s=u.extend,t.exports=i=function(){function t(t){var e,r;if(null==t&&(t=[]),"Array"!==a(t)||arguments.length>1)throw new TypeError("Batman.SimpleSet constructor takes one argument: an array of items to initialize the Set. For example, use `new Batman.Set([1, 2, 3])` instead of `new Batman.Set(1, 2, 3)`.");this._storage=[],this.length=0,r=function(){var r,n,o;for(o=[],r=0,n=t.length;n>r;r++)e=t[r],null!=e&&o.push(e);return o}(),r.length>0&&this.addArray(r)}return s(t.prototype,n),t.prototype.at=function(t){return this._storage[t]},t.prototype.add=function(){var e;
return e=arguments.length>=1?c.call(arguments,0):[],t.prototype.addArray.call(this,e)},t.prototype.addArray=function(t){var e,r,n,o;for(e=[],n=0,o=t.length;o>n;n++)r=t[n],-1===this._indexOfItem(r)&&(this._storage.push(r),e.push(r));return this.length=this._storage.length,e},t.prototype.insert=function(){return this.insertWithIndexes.apply(this,arguments).addedItems},t.prototype.insertWithIndexes=function(t,e){var r,n,o,i,s,a,u;for(r=[],n=[],o=a=0,u=t.length;u>a;o=++a)s=t[o],-1===this._indexOfItem(s)&&(i=e[o],this._storage.splice(i,0,s),n.push(s),r.push(i));return this.length=this._storage.length,{addedItems:n,addedIndexes:r}},t.prototype.remove=function(){var t;return t=arguments.length>=1?c.call(arguments,0):[],Batman.SimpleSet.prototype.removeArrayWithIndexes.call(this,t).removedItems},t.prototype.removeArray=function(t){return Batman.SimpleSet.prototype.removeArrayWithIndexes.call(this,t).removedItems},t.prototype.removeWithIndexes=function(){var t;return t=arguments.length>=1?c.call(arguments,0):[],Batman.SimpleSet.prototype.removeArrayWithIndexes.call(this,t)},t.prototype.removeArrayWithIndexes=function(t){var e,r,n,o,i,s;for(n=[],o=[],i=0,s=t.length;s>i;i++)r=t[i],-1!==(e=this._indexOfItem(r))&&(this._storage.splice(e,1),o.push(r),n.push(e));return this.length=this._storage.length,{removedItems:o,removedIndexes:n}},t.prototype.clear=function(){var t;return t=this._storage,this._storage=[],this.length=0,t},t.prototype.replace=function(t){var e;return this.clear(),e=("function"==typeof t.toArray?t.toArray():void 0)||t,this.addArray(e)},t.prototype.has=function(t){return-1!==this._indexOfItem(t)},t.prototype.find=function(t){var e,r,n,o;for(o=this._storage,r=0,n=o.length;n>r;r++)if(e=o[r],t(e))return e},t.prototype.forEach=function(t,e){var r,n,o,i;for(i=this._storage,n=0,o=i.length;o>n;n++)r=i[n],t.call(e,r,null,this)},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.toArray=function(){return this._storage.slice()},t.prototype.merge=function(){var t,e,r,n,o;for(e=arguments.length>=1?c.call(arguments,0):[],t=new this.constructor,e.unshift(this),n=0,o=e.length;o>n;n++)r=e[n],r.forEach(function(e){return t.add(e)});return t},t.prototype.mappedTo=function(t){return this._mappings||(this._mappings=new o),this._mappings.getOrSet(t,function(e){return function(){return new Batman.SetMapping(e,t)}}(this))},t.prototype.indexedBy=function(t){return this._indexes||(this._indexes=new o),this._indexes.get(t)||this._indexes.set(t,new Batman.SetIndex(this,t))},t.prototype.indexedByUnique=function(t){return this._uniqueIndexes||(this._uniqueIndexes=new o),this._uniqueIndexes.get(t)||this._uniqueIndexes.set(t,new Batman.UniqueSetIndex(this,t))},t.prototype.sortedBy=function(t,e){var r;return null==e&&(e="asc"),e="desc"===e.toLowerCase()?"desc":"asc",this._sorts||(this._sorts=new o),r=this._sorts.get(t)||this._sorts.set(t,new Batman.Object),r.get(e)||r.set(e,new Batman.SetSort(this,t,e))},t.prototype.equality=o.prototype.equality,t.prototype._indexOfItem=function(t){var e,r,n,o,i;for(i=this._storage,e=n=0,o=i.length;o>n;e=++n)if(r=i[e],this.equality(t,r))return e;return-1},t}()},function(t,e,r){var n,o,i,s,a,u,c={}.hasOwnProperty,p=function(t,e){function n(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},l=[].slice;n=r(97),o=r(90),s=r(103),a=r(98),u=r(89).extend,t.exports=i=function(t){function y(t){null==t&&(t=[]),s.call(this,t)}var e,r,n,i,c,h,f,d;for(p(y,t),y.prototype.isCollectionEventEmitter=!0,u(y.prototype,o),y._applySetAccessors=function(t){var e,r,n;r={first:function(){return this.toArray()[0]},last:function(){return this.toArray()[this.length-1]},isEmpty:function(){return this.isEmpty()},toArray:function(){return this.toArray()},length:function(){return this.registerAsMutableSource(),this.length},indexedBy:function(){return new a(function(t){return function(e){return t.indexedBy(e)}}(this))},indexedByUnique:function(){return new a(function(t){return function(e){return t.indexedByUnique(e)}}(this))},sortedBy:function(){return new a(function(t){return function(e){return t.sortedBy(e)}}(this))},sortedByDescending:function(){return new a(function(t){return function(e){return t.sortedBy(e,"desc")}}(this))},mappedTo:function(){return new a(function(t){return function(e){return t.mappedTo(e)}}(this))},at:function(){return new a(function(t){return function(e){return t.at(+e)}}(this))}};for(n in r)e=r[n],t.accessor(n,e)},y._applySetAccessors(y),f=["indexedBy","indexedByUnique","sortedBy","equality","_indexOfItem","mappedTo"],n=0,c=f.length;c>n;n++)e=f[n],y.prototype[e]=s.prototype[e];for(d=["at","find","merge","forEach","toArray","isEmpty","has"],r=function(t){return y.prototype[t]=function(){return this.registerAsMutableSource(),s.prototype[t].apply(this,arguments)}},i=0,h=d.length;h>i;i++)e=d[i],r(e);return y.prototype.toJSON=function(){return this.map(function(t){return("function"==typeof t.toJSON?t.toJSON():void 0)||t})},y.prototype.add=function(){var t;return t=arguments.length>=1?l.call(arguments,0):[],this.addArray(t)},y.prototype.addArray=y.mutation(function(){var t;return t=s.prototype.addArray.apply(this,arguments),t.length&&this.fire("itemsWereAdded",t),t}),y.prototype.insert=function(){return this.insertWithIndexes.apply(this,arguments).addedItems},y.prototype.insertWithIndexes=y.mutation(function(){var t,e,r;return r=s.prototype.insertWithIndexes.apply(this,arguments),e=r.addedItems,t=r.addedIndexes,e.length&&this.fire("itemsWereAdded",e,t),{addedItems:e,addedIndexes:t}}),y.prototype.remove=function(){var t;return t=arguments.length>=1?l.call(arguments,0):[],this.removeArrayWithIndexes(t).removedItems},y.prototype.removeArray=function(t){return this.removeArrayWithIndexes(t).removedItems},y.prototype.removeWithIndexes=function(){var t;return t=arguments.length>=1?l.call(arguments,0):[],this.removeArrayWithIndexes(t)},y.prototype.removeArrayWithIndexes=y.mutation(function(t){var e,r,n;return n=s.prototype.removeArrayWithIndexes.call(this,t),r=n.removedItems,e=n.removedIndexes,r.length&&this.fire("itemsWereRemoved",r,e),{removedItems:r,removedIndexes:e}}),y.prototype.clear=y.mutation(function(){var t;return t=s.prototype.clear.call(this),t.length&&this.fire("itemsWereRemoved",t),t}),y.prototype.replace=y.mutation(function(t){var e,r,n;return n=s.prototype.clear.call(this),r=("function"==typeof t.toArray?t.toArray():void 0)||t,e=s.prototype.addArray.call(this,r),n.length&&this.fire("itemsWereRemoved",n),e.length?this.fire("itemsWereAdded",e):void 0}),y}(n)},function(t,e,r){var n,o,i,s,a,u,c={}.hasOwnProperty,p=function(t,e){function n(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(97),s=r(106),i=r(104),o=r(90),u=r(89).extend,t.exports=a=function(t){function l(t){this.base=t,l.__super__.constructor.call(this),this.length=this.base.length,this.base.isCollectionEventEmitter&&(this.isCollectionEventEmitter=!0,this._setObserver=new s(this.base),this._setObserver.on("itemsWereAdded",this._handleItemsAdded.bind(this)),this._setObserver.on("itemsWereRemoved",this._handleItemsRemoved.bind(this)),this.startObserving())}var e,r,n,a,c;for(p(l,t),u(l.prototype,o),l.prototype.startObserving=function(){var t;return null!=(t=this._setObserver)?t.startObserving():void 0},l.prototype.stopObserving=function(){var t;return null!=(t=this._setObserver)?t.stopObserving():void 0},l.prototype._handleItemsAdded=function(t,e){return this.set("length",this.base.length),this.fire("itemsWereAdded",t,e)},l.prototype._handleItemsRemoved=function(t,e){return this.set("length",this.base.length),this.fire("itemsWereRemoved",t,e)},l.prototype.filter=function(t){return this.reduce(function(e,r){return t(r)&&e.add(r),e},new i)},l.prototype.replace=function(){var t,e;return t=this.property("length"),t.isolate(),e=this.base.replace.apply(this.base,arguments),t.expose(),e},i._applySetAccessors(l),c=["add","addArray","insert","insertWithIndexes","remove","removeArray","removeWithIndexes","at","find","clear","has","merge","toArray","isEmpty","indexedBy","indexedByUnique","sortedBy","mappedTo"],r=function(t){return l.prototype[t]=function(){return this.base[t].apply(this.base,arguments)}},n=0,a=c.length;a>n;n++)e=c[n],r(e);return l.accessor("length",{get:function(){return this.registerAsMutableSource(),this.length},set:function(t,e){return this.length=e}}),l}(n)},function(t,e,r){var n,o,i,s={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u=[].slice;n=r(97),i=r(101),t.exports=o=function(t){function e(t){this.base=t,this._itemObservers=new i,this._setObservers=new i,this._setObservers.set("itemsWereAdded",function(t){return function(){return t.fire.apply(t,["itemsWereAdded"].concat(u.call(arguments)))}}(this)),this._setObservers.set("itemsWereRemoved",function(t){return function(){return t.fire.apply(t,["itemsWereRemoved"].concat(u.call(arguments)))}}(this)),this.on("itemsWereAdded",this.startObservingItems.bind(this)),this.on("itemsWereRemoved",this.stopObservingItems.bind(this))}return a(e,t),e.prototype.observedItemKeys=[],e.prototype.observerForItemAndKey=function(){},e.prototype._getOrSetObserverForItemAndKey=function(t,e){return this._itemObservers.getOrSet(t,function(r){return function(){var n;return n=new i,n.getOrSet(e,function(){return r.observerForItemAndKey(t,e)})}}(this))},e.prototype.startObserving=function(){return this._manageItemObservers("observe"),this._manageSetObservers("addHandler")},e.prototype.stopObserving=function(){return this._manageItemObservers("forget"),this._manageSetObservers("removeHandler")},e.prototype.startObservingItems=function(t){var e,r,n;for(r=0,n=t.length;n>r;r++)e=t[r],this._manageObserversForItem(e,"observe")},e.prototype.stopObservingItems=function(t){var e,r,n;for(r=0,n=t.length;n>r;r++)e=t[r],this._manageObserversForItem(e,"forget")},e.prototype._manageObserversForItem=function(t,e){var r,n,o,i;if(null!=t?t.isObservable:void 0){for(i=this.observedItemKeys,n=0,o=i.length;o>n;n++)r=i[n],t[e](r,this._getOrSetObserverForItemAndKey(t,r));if("forget"===e)return this._itemObservers.unset(t)}},e.prototype._manageItemObservers=function(t){return this.base.forEach(function(e){return function(r){return e._manageObserversForItem(r,t)}}(this))},e.prototype._manageSetObservers=function(t){return this.base.isObservable?this._setObservers.forEach(function(e){return function(r,n){return e.base.event(r)[t](n)}}(this)):void 0},e}(n)},function(t,e,r){var n,o,i,s,a=function(t,e){return function(){return t.apply(e,arguments)}},u={}.hasOwnProperty,c=function(t,e){function n(){this.constructor=t}for(var r in e)u.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=r(105),n=r(104),s=r(89).get,t.exports=i=function(t){function e(t,r,n){this.key=r,null==n&&(n="asc"),this.compareElements=a(this.compareElements,this),e.__super__.constructor.call(this,t),this.descending="desc"===n.toLowerCase(),this.isSorted=!0,this.isCollectionEventEmitter&&(this._setObserver.observedItemKeys=[this.key],this._setObserver.observerForItemAndKey=function(t){return function(e){return function(r,n){return t._handleItemsModified(e,r,n)}}}(this)),this._reIndex()}return c(e,t),e.prototype._handleItemsModified=function(t,e,r){var n,o,i,s,a,u,c,p;return a={},a[this.key]=r,u=function(e){return function(r,n){return r===t&&(r=a),n===t&&(n=a),e.compareElements(r,n)}}(this),i=this._storage.slice(),c=this.constructor._binarySearch(i,t,u),n=c.match,s=c.index,n&&(i.splice(s,1),p=this.constructor._binarySearch(i,t,this.compareElements),n=p.match,o=p.index,s!==o)?(i.splice(o,0,t),this.set("_storage",i),this.fire("itemWasMoved",t,o,s)):void 0},e.prototype._handleItemsAdded=function(t){var e,r,n,o,i,s,a,u,c;for(s=this._storage.slice(),r=[],e=[],a=0,u=t.length;u>a;a++)o=t[a],c=this.constructor._binarySearch(s,o,this.compareElements),i=c.match,n=c.index,i||(s.splice(n,0,o),r.push(o),e.push(n));return this.set("_storage",s),this.set("length",this._storage.length),this.fire("itemsWereAdded",r,e)},e.prototype._handleItemsRemoved=function(t){var e,r,n,o,i,s,a,u,c;for(o=this._storage.slice(),s=[],i=[],a=0,u=t.length;u>a;a++)r=t[a],c=this.constructor._binarySearch(o,r,this.compareElements),n=c.match,e=c.index,n&&(o.splice(e,1),s.push(r),i.push(e));return this.set("_storage",o),this.set("length",this._storage.length),this.fire("itemsWereRemoved",s,i)},e.prototype.toArray=function(){return this.get("_storage").slice()},e.prototype.at=function(t){return this.get("_storage")[t]},e.prototype.forEach=function(t,e){var r,n,o,i,s,a;for("function"==typeof(o=this.base).registerAsMutableSource&&o.registerAsMutableSource(),a=this._storage,n=i=0,s=a.length;s>i;n=++i)r=a[n],t.call(e,r,n,this)},e.prototype.find=function(t){var e,r,n,o;for(this.base.registerAsMutableSource(),o=this._storage,r=0,n=o.length;n>r;r++)if(e=o[r],t(e))return e},e.prototype.merge=function(t){return this.base.registerAsMutableSource(),new n(this._storage).merge(t).sortedBy(this.key,this.order)},e.prototype.compare=function(t,e){return t===e?0:void 0===t?1:void 0===e?-1:null===t?1:null===e?-1:t===!1?1:e===!1?-1:t===!0?1:e===!0?-1:t!==t?e!==e?0:1:e!==e?-1:t>e?1:e>t?-1:0},e.prototype.compareElements=function(t,e){var r,n,o;return n=this.key&&null!=t?s(t,this.key):t,"function"==typeof n&&(n=n.call(t)),null!=n&&(n=n.valueOf()),o=this.key&&null!=e?s(e,this.key):e,"function"==typeof o&&(o=o.call(e)),null!=o&&(o=o.valueOf()),r=this.descending?-1:1,this.compare(n,o)*r},e.prototype._reIndex=function(){var t,e;return t=this.base.toArray().sort(this.compareElements),null!=(e=this._setObserver)&&e.startObservingItems(t),this.set("_storage",t)},e.prototype._indexOfItem=function(t){var e,r,n;return n=this.constructor._binarySearch(this._storage,t,this.compareElements),r=n.match,e=n.index,r?e:-1},e._binarySearch=function(t,e,r){var n,o,i,s,a,u,c;for(c=0,o=t.length-1,u={};o>=c;)if(s=(o-c>>1)+c,n=r(e,t[s]),n>0)c=s+1;else{if(!(0>n)){for(a=!1,i=s;i>=0&&0===r(e,t[i]);){if(e===t[i]){s=i,a=!0;break}i--}if(!a)for(i=s+1;t.length>i&&0===r(e,t[i]);){if(e===t[i]){s=i,a=!0;break}i++}return{match:a,index:s}}o=s-1}return{match:!1,index:c}},e}(o)},function(t,e,r){var n,o,i,s,a,u,c,p,l,h,f={}.hasOwnProperty,d=function(t,e){function n(){this.constructor=t}for(var r in e)f.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};p=r(106),u=r(104),n=r(97),a=r(94),s=r(95),o=r(90),l=r(101),i=r(102),h=r(89).extend,t.exports=c=function(t){function e(t,r){this.base=t,this.key=r,e.__super__.constructor.call(this),this._storage=new i,this.base.isEventEmitter&&(this._setObserver=new p(this.base),this._setObserver.observedItemKeys=[this.key],this._setObserver.observerForItemAndKey=this.observerForItemAndKey.bind(this),this._setObserver.on("itemsWereAdded",function(t){return function(e){return t._addItems(e)}}(this)),this._setObserver.on("itemsWereRemoved",function(t){return function(e){return t._removeItems(e)}}(this))),this._addItems(this.base._storage),this.startObserving()}return d(e,t),e.accessor("toArray",function(){return this.toArray()}),h(e.prototype,o),e.prototype.propertyClass=a,e.accessor(function(t){return this._resultSetForKey(t)}),e.prototype.startObserving=function(){var t;return null!=(t=this._setObserver)?t.startObserving():void 0},e.prototype.stopObserving=function(){var t;return null!=(t=this._setObserver)?t.stopObserving():void 0},e.prototype.observerForItemAndKey=function(t){return function(e){return function(r,n){return e._removeItemsFromKey(n,[t]),e._addItemsToKey(r,[t])}}(this)},e.prototype.forEach=function(t,e){return this._storage.forEach(function(r){return function(n,o){return o.get("length")>0?t.call(e,n,o,r):void 0}}(this))},e.prototype.toArray=function(){var t;return t=[],this._storage.forEach(function(e,r){return r.get("length")>0?t.push(e):void 0}),t},e.prototype._addItems=function(t){var e,r,n,o,i,s,a;if(null!=t?t.length:void 0){for(i=this._keyForItem(t[0]),n=[],e=s=0,a=t.length;a>s;e=++s)r=t[e],l.prototype.equality(i,o=this._keyForItem(r))?n.push(r):(this._addItemsToKey(i,n),n=[r],i=o);return n.length?this._addItemsToKey(i,n):void 0}},e.prototype._removeItems=function(t){var e,r,n,o,i,s,a;if(null!=t?t.length:void 0){for(i=this._keyForItem(t[0]),n=[],e=s=0,a=t.length;a>s;e=++s)r=t[e],l.prototype.equality(i,o=this._keyForItem(r))?n.push(r):(this._removeItemsFromKey(i,n),n=[r],i=o);return n.length?this._removeItemsFromKey(i,n):void 0}},e.prototype._addItemsToKey=function(t,e){var r;return r=this._resultSetForKey(t),r.addArray(e),r},e.prototype._removeItemsFromKey=function(t,e){var r;return r=this._resultSetForKey(t),r.removeArray(e),r},e.prototype._resultSetForKey=function(t){return this._storage.getOrSet(t,function(){return new u})},e.prototype._keyForItem=function(t){return s.forBaseAndKey(t,this.key).getValue()},e}(n)},function(t,e,r){var n,o,i,s={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=r(108),n=r(102),t.exports=i=function(t){function e(){this._uniqueIndex=new n,e.__super__.constructor.apply(this,arguments)}return a(e,t),e.accessor(function(t){return this._uniqueIndex.get(t)}),e.prototype._addItemsToKey=function(t,r){return e.__super__._addItemsToKey.apply(this,arguments),this._uniqueIndex.hasKey(t)?void 0:this._uniqueIndex.set(t,r[0])},e.prototype._removeItemsFromKey=function(t){var n;return n=e.__super__._removeItemsFromKey.apply(this,arguments),n.isEmpty()?this._uniqueIndex.unset(t):this._uniqueIndex.set(t,n._storage[0])},e}(o)},function(t,e,r){var n,o,i,s,a={}.hasOwnProperty,u=function(t,e){function n(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};i=r(106),n=r(104),s=r(101),t.exports=o=function(t){function e(t,r){var n;this.base=t,this.key=r,n=this.base.mapToProperty(this.key),this._counter=new this.constructor.PresenceCounter(n),e.__super__.constructor.call(this,n),this._setObserver=new i(this.base),this._setObserver.observedItemKeys=[this.key],this._setObserver.observerForItemAndKey=function(t){return function(e){return function(r,n){return t._handleItemModified(e,r,n)}}}(this),this._setObserver.on("itemsWereAdded",this._handleItemsAdded.bind(this)),this._setObserver.on("itemsWereRemoved",this._handleItemsRemoved.bind(this)),this._setObserver.startObserving()}return u(e,t),e.prototype._handleItemsAdded=function(t){var r,n,o,i;for(i=[],n=0,o=t.length;o>n;n++)r=t[n],i.push(this._addValueInstance(r.get(this.key)));return i},e.prototype._handleItemsRemoved=function(t){var r,n,o,i;for(i=[],n=0,o=t.length;o>n;n++)r=t[n],i.push(this._removeValueInstance(r.get(this.key)));return i},e.prototype._handleItemModified=function(t,e,r){return this._removeValueInstance(r),this._addValueInstance(e)},e.prototype._addValueInstance=function(t){return this._counter.increment(t),this.add(t)},e.prototype._removeValueInstance=function(t){var e;return e=this._counter.decrement(t),0===e?this.remove(t):void 0},e}(n),o.PresenceCounter=function(){function t(t){var e,r,n;for(this._storage=new s,r=0,n=t.length;n>r;r++)e=t[r],this.increment(e)}return t.prototype.increment=function(t){var e;return e=this._storage.get(t),e?this._storage.set(t,e+1):this._storage.set(t,1)},t.prototype.decrement=function(t){var e;return e=this._storage.get(t),this._storage.set(t,e-1)},t}()},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a=[].slice;n=r(145),t.exports=o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype._itemsWereAddedToSource=function(){var t,e,r,n,o;return o=arguments[0],n=arguments[1],e=arguments.length>=3?a.call(arguments,2):[],r=function(){var r,o,i;for(i=[],r=0,o=e.length;o>r;r++)t=e[r],n.has(t)&&i.push(t);return i}(),r.length>0?this.addArray(r):void 0},e.prototype._itemsWereRemovedFromSource=function(){var t,e,r;return r=arguments[0],e=arguments[1],t=arguments.length>=3?a.call(arguments,2):[],this.removeArray(t)},e}(n)},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a=[].slice;n=r(145),t.exports=o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype._itemsWereAddedToSource=function(){var t,e,r,n,o,i;if(i=arguments[0],o=arguments[1],e=arguments.length>=3?a.call(arguments,2):[],i===this.left){if(r=function(){var r,n,i;for(i=[],r=0,n=e.length;n>r;r++)t=e[r],o.has(t)||i.push(t);return i}(),r.length>0)return this.addArray(r)}else if(n=function(){var r,n,i;for(i=[],r=0,n=e.length;n>r;r++)t=e[r],o.has(t)&&i.push(t);return i}(),n.length>0)return this.removeArray(n)},e.prototype._itemsWereRemovedFromSource=function(){var t,e,r,n,o;return o=arguments[0],n=arguments[1],e=arguments.length>=3?a.call(arguments,2):[],o===this.left?this.removeArray(e):(r=function(){var r,o,i;for(i=[],r=0,o=e.length;o>r;r++)t=e[r],n.has(t)&&i.push(t);return i}(),r.length>0?this.addArray(r):void 0)},e.prototype._addComplement=function(t,e){var r,n;return n=function(){var n,o,i;for(i=[],n=0,o=t.length;o>n;n++)r=t[n],e.has(r)&&i.push(r);return i}(),n.length>0?this.addArray(n):void 0},e}(n)},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a=[].slice;n=r(145),t.exports=o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype._itemsWereAddedToSource=function(){var t,e,r;return r=arguments[0],e=arguments[1],t=arguments.length>=3?a.call(arguments,2):[],this.addArray(t)},e.prototype._itemsWereRemovedFromSource=function(){var t,e,r,n,o;return o=arguments[0],n=arguments[1],e=arguments.length>=3?a.call(arguments,2):[],r=function(){var r,o,i;for(i=[],r=0,o=e.length;o>r;r++)t=e[r],n.has(t)||i.push(t);return i}(),this.removeArray(r)},e}(n)},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=r(115),t.exports=n=function(t){function e(t){this.attributeName=t.attr,e.__super__.constructor.apply(this,arguments)}return s(e,t),e}(o)},function(t,e,r){var n,o,i,s,a,u,c=function(t,e){return function(){return t.apply(e,arguments)}},p={}.hasOwnProperty,l=function(t,e){function n(){this.constructor=t}for(var r in e)p.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};u=r(1),s=u.developer,o=u.BatmanObject,i=r(142),a=r(75)._data,t.exports=n=function(t){function h(t){this._fireDataChange=c(this._fireDataChange,this);var e;this.node=t.node,this.keyPath=t.keyPath,this.view=t.view,t.onlyObserve&&(this.onlyObserve=t.onlyObserve),null!=t.skipParseFilter&&(this.skipParseFilter=t.skipParseFilter),this.skipParseFilter||this.parseFilter(),"function"==typeof this.backWithView&&(e=this.backWithView),this.backWithView&&this.setupBackingView(e,t.viewOptions),this.bindImmediately&&this.bind()}var e,r,n,o,u,p;return l(h,t),n=/(^|,)\s*(?:(true|false)|("[^"]*")|(\{[^\}]*\})|(([0-9\_\-]+[a-zA-Z\_\-]|[a-zA-Z])[\w\-\.\?\!\+]*))\s*(?=$|,)/g,e=/(?:\]\.)(.+?)(?=[\[\.]|\s*\||$)/,r=/(?!^\s*)\[(.*?)\]/g,h.accessor("filteredValue",{get:function(){var t,e,r;return r=this.get("unfilteredValue"),e=this,this.filterFunctions.length>0?t=this.filterFunctions.reduce(function(t,r,n){var o;for(o=e.filterArguments[n].map(function(t){return t._keypath?e.view.lookupKeypath(t._keypath):t}),o.unshift(t);o.length<r.length-1;)o.push(void 0);return o.push(e),r.apply(e.view,o)},r):r},set:function(t,e){return this.set("unfilteredValue",e)}}),h.accessor("unfilteredValue",{get:function(){return this._unfilteredValue(this.get("key"))},set:function(t,e){var r;return(r=this.get("key"))?this.view.setKeypath(r,e):this.set("value",e)}}),h.prototype._unfilteredValue=function(t){return t?this.view.lookupKeypath(t):this.get("value")},o=i.All,u=i.Data,p=i.Node,h.prototype.bindImmediately=!0,h.prototype.shouldSet=!0,h.prototype.isInputBinding=!1,h.prototype.escapeValue=!0,h.prototype.onlyObserve=o,h.prototype.skipParseFilter=!1,h.prototype.isTwoWay=function(){return null!=this.key&&0===this.filterFunctions.length},h.prototype.bind=function(){var t,e;return this.node&&((t=this.onlyObserve)===o||t===p)&&Batman.DOM.nodeIsEditable(this.node)&&(Batman.DOM.events.change(this.node,this._fireNodeChange.bind(this)),this.onlyObserve===p&&this._fireNodeChange()),((e=this.onlyObserve)===o||e===u)&&this.observeAndFire("filteredValue",this._fireDataChange),this.view._addChildBinding(this)},h.prototype._fireNodeChange=function(t){var e;return this.shouldSet=!1,e=this.value||this.get("keyContext"),"function"==typeof this.nodeChange&&this.nodeChange(this.node,e,t),this.fire("nodeChange",this.node,e),this.shouldSet=!0},h.prototype._fireDataChange=function(t){return this.shouldSet?("function"==typeof this.dataChange&&this.dataChange(t,this.node),this.fire("dataChange",t,this.node)):void 0},h.prototype.die=function(){var t;return this.forget(),null!=(t=this._batman.properties)&&t.forEach(function(t,e){return e.die()}),this.node=null,this.keyPath=null,this.view=null,this.backingView=null,this.superview=null},h.prototype.parseFilter=function(){var t,n,o,i,a,u,c,p,l,h,f,d;for(this.filterFunctions=[],this.filterArguments=[],p=this.keyPath;e.test(p);)p=p.replace(e,"]['$1']");u=p.replace(r," | get $1 ").replace(/'/g,'"').split(/(?!")\s+\|\s+(?!")/);try{c=this.parseSegment(l=u.shift())[0]}catch(y){n=y,s.warn(n),s.error("Error! Couldn't parse keypath in \""+l+'". Parsing error above.')}if(c&&c._keypath?this.key=c._keypath:this.value=c,u.length){for(;a=u.shift();){if(h=a.indexOf(" "),-1===h&&(h=a.length),i=a.substr(0,h),t=a.substr(h),!(o=(null!=(f=this.view)?null!=(d=f._batman.get("filters"))?d[i]:void 0:void 0)||Batman.Filters[i]))return s.error("Unrecognized filter '"+i+"' in key \""+this.keyPath+'"!');this.filterFunctions.push(o);try{this.filterArguments.push(this.parseSegment(t))}catch(y){n=y,s.error('Bad filter arguments "'+t+'"!')}}return!0}},h.prototype.parseSegment=function(t){return t=t.replace(n,function(t,e,r,n,o,i){var a;return null==e&&(e=""),a=i?'{"_keypath": "'+i+'"}':r||n||o,e+a}),JSON.parse("["+t+"]")},h.prototype.setupBackingView=function(t,e){return this.backingView?this.backingView:this.node&&(this.backingView=a(this.node,"view"))?this.backingView:(this.superview=this.view,e||(e={}),null==e.node&&(e.node=this.node),null==e.parentNode&&(e.parentNode=this.node),e.isBackingView=!0,this.backingView=new(t||Batman.BackingView)(e),this.superview.subviews.add(this.backingView),this.node&&a(this.node,"view",this.backingView),this.backingView)},h}(o)},function(t,e,r){var n,o,i,s={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};i=r(1).Hash,n=r(114),t.exports=o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.dataChange=function(t){var e,r;null!=t?this.bindCollection(t)||(e=(null!=t?t.forEach:void 0)?(r=[],t.forEach(function(t){return r.push(t)}),r):Object.keys(t),this.handleArrayChanged(e)):(this.unbindCollection(),this.collection=[],this.handleArrayChanged([]))},e.prototype.bindCollection=function(t){var e;return t instanceof i&&(t=t.meta),t===this.collection?!0:(this.unbindCollection(),this.collection=t,(null!=(e=this.collection)?e.isObservable:void 0)?(this.collection.isCollectionEventEmitter&&this.handleItemsAdded&&this.handleItemsRemoved&&this.handleItemMoved?(this.collection.on("itemsWereAdded",this.handleItemsAdded),this.collection.on("itemsWereRemoved",this.handleItemsRemoved),this.collection.on("itemWasMoved",this.handleItemMoved),this.handleArrayChanged(this.collection.toArray())):this.collection.observeAndFire("toArray",this.handleArrayChanged),!0):!1)},e.prototype.unbindCollection=function(){var t;if(null!=(t=this.collection)?t.isObservable:void 0)return this.collection.isCollectionEventEmitter&&this.handleItemsAdded&&this.handleItemsRemoved&&this.handleItemMoved?(this.collection.off("itemsWereAdded",this.handleItemsAdded),this.collection.off("itemsWereRemoved",this.handleItemsRemoved),this.collection.off("itemWasMoved",this.handleItemMoved)):this.collection.forget("toArray",this.handleArrayChanged)},e.prototype.handleArrayChanged=function(){},e.prototype.die=function(){return this.unbindCollection(),this.collection=null,e.__super__.die.apply(this,arguments)},e}(n)},function(t,e,r){var n,o,i,s,a={}.hasOwnProperty,u=function(t,e){function n(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(114),i=r(142),s=/[ \t]{2,}/g,t.exports=o=function(t){function e(t){var r;this.invert=t.invert,this.classes=function(){var e,n,o,i;for(o=t.attr.split("|"),i=[],e=0,n=o.length;n>e;e++)r=o[e],i.push({name:r,pattern:RegExp("(?:^|\\s)"+r+"(?:$|\\s)","i")});return i}(),e.__super__.constructor.apply(this,arguments)}return u(e,t),e.prototype.onlyObserve=i.Data,e.prototype.dataChange=function(t){var e,r,n,o,i,a,u,c;for(e=this.node.className,u=this.classes,i=0,a=u.length;a>i;i++)c=u[i],n=c.name,o=c.pattern,r=o.test(e),!!t==!this.invert?r||(e=""+e+" "+n):r&&(e=e.replace(o," "));return this.node.className=e.trim().replace(s," "),!0},e}(n)},function(t,e,r){var n,o,i,s,a={}.hasOwnProperty,u=function(t,e){function n(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(114),s=r(80),i=r(142),t.exports=o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.prototype.onlyObserve=i.Data,e.prototype.dataChange=function(t){return this.node.setAttribute(this.attributeName,t)},e.prototype.nodeChange=function(t){return this.isTwoWay()?this.set("filteredValue",s._parseAttribute(t.getAttribute(this.attributeName))):void 0},e}(n)},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=r(130),t.exports=n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype.isInputBinding=!0,e.prototype.dataChange=function(t){return this.node[this.attributeName]=!!t},e}(o)},function(t,e,r){var n,o,i,s=function(t,e){return function(){return t.apply(e,arguments)}},a={}.hasOwnProperty,u=function(t,e){function n(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(116),o=r(142),t.exports=i=function(t){function e(){this.handleArrayChanged=s(this.handleArrayChanged,this),this.existingClasses=arguments[0].node.className.split(" "),e.__super__.constructor.apply(this,arguments)}return u(e,t),e.prototype.onlyObserve=o.Data,e.prototype.dataChange=function(t){var e;return null!=t?(this.unbindCollection(),"string"==typeof t?(e=[t].concat(this.existingClasses),this.node.className=e.join(" ").trim()):(this.bindCollection(t),this.updateFromCollection())):void 0},e.prototype.updateFromCollection=function(){var t,e,r,n,o;return this.collection?(t=this.collection.map?this.collection.map(function(t){return t}):function(){var t,e;t=this.collection,e=[];for(r in t)a.call(t,r)&&(o=t[r],e.push(r));
return e}.call(this),null!=t.toArray&&(t=t.toArray()),e=this.existingClasses.slice(0),n=t.filter(function(t){return-1===e.indexOf(t)}),this.node.className=e.concat(n).join(" ").trim()):void 0},e.prototype.handleArrayChanged=function(){return this.updateFromCollection()},e}(n)},function(t,e,r){var n,o,i,s={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(114),o=r(142),t.exports=i=function(t){function e(){var t;e.__super__.constructor.apply(this,arguments),t=function(t){return function(){return Batman.Tracking.trackEvent("click",t.get("filteredValue"),t.node)}}(this),Batman.DOM.events.click(this.node,t,this.view,"click",!1),this.bind()}return a(e,t),e.prototype.onlyObserve=o.None,e.prototype.bindImmediately=!1,e}(n)},function(t,e,r){var n,o,i,s={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(114),o=r(142),t.exports=i=function(t){function e(t){var r;this.contextKeypath=t.attr||"proxiedObject",e.__super__.constructor.apply(this,arguments),r=this.attributeName?"data-"+this.bindingName+"-"+this.attributeName:"data-"+this.bindingName,this.node.removeAttribute(r),this.node.insertBefore(document.createComment("batman-"+r+'="'+this.keyPath+'"'),this.node.firstChild),this.backingView.observe(this.contextKeypath,this._updateValue=function(t){return function(e){return t.isDataChanging?void 0:t.view.setKeypath(t.keyPath,e)}}(this))}return a(e,t),e.prototype.onlyObserve=o.Data,e.prototype.backWithView=!0,e.prototype.bindingName="context",e.prototype.dataChange=function(t){return this.isDataChanging=!0,this.backingView.set(this.contextKeypath,t),this.isDataChanging=!1},e.prototype.die=function(){return this.backingView.forget(this.contextKeypath,this._updateValue),this.backingView.unset(this.contextKeypath),e.__super__.die.apply(this,arguments)},e}(n)},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(115),t.exports=o=function(t){function e(){e.__super__.constructor.apply(this,arguments)}return s(e,t),e}(n)},function(t,e,r){var n,o,i,s,a,u={}.hasOwnProperty,c=function(t,e){function n(){this.constructor=t}for(var r in e)u.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(115),a=r(68),o=r(142),s=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return c(e,t),e.prototype.bindImmediately=!1,e}(a),t.exports=i=function(t){function e(t){this.invert=t.invert,this.attributeName=this.invert?"data-deferif":"data-renderif",e.__super__.constructor.apply(this,arguments)}return c(e,t),e.prototype.onlyObserve=o.Data,e.prototype.backWithView=s,e.prototype.skipChildren=!0,e.prototype.dataChange=function(t){return!!t!=!this.invert||this.backingView.isBound?void 0:(this.node.removeAttribute(this.attributeName),this.backingView.initializeBindings())},e}(n)},function(t,e,r){var n,o,i,s,a,u,c,p={}.hasOwnProperty,l=function(t,e){function n(){this.constructor=t}for(var r in e)p.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},h=[].indexOf||function(t){for(var e=0,r=this.length;r>e;e++)if(e in this&&this[e]===t)return e;return-1};n=r(114),o=r(142),s=r(68),c=r(1),a=c.developer,u=c.get,t.exports=i=function(t){function e(){var t,r;e.__super__.constructor.apply(this,arguments),a["do"](function(t){return function(){var e;return e=t.key,h.call(s.LIFECYCLE_EVENTS,e)>=0?a.error("Event handler named '"+t.key+"' conflicts with a View lifecycle event of the same name! Rename the handler on <"+t.node.nodeName.toLowerCase()+" data-event-"+t.attributeName+"='"+t.keyPath+"' />."):void 0}}(this)),r=function(t){return function(){var e,r;return e=t.get("filteredValue"),r=t.view.targetForKeypath(t.functionPath||t.unfilteredKey),r&&t.functionPath&&(r=u(r,t.functionPath)),null!=e?e.apply(r,arguments):void 0}}(this),(t=Batman.DOM.events[this.attributeName])?t(this.node,r,this.view):Batman.DOM.events.other(this.node,this.attributeName,r,this.view),this.bind()}return l(e,t),e.prototype.onlyObserve=o.None,e.prototype.bindImmediately=!1,e.prototype._unfilteredValue=function(t){var r,n;return this.unfilteredKey=t,this.functionName||-1===(r=t.lastIndexOf("."))||(this.functionPath=t.substr(0,r),this.functionName=t.substr(r+1)),n=e.__super__._unfilteredValue.call(this,this.functionPath||t),this.functionName?null!=n?n[this.functionName]:void 0:n},e}(n)},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(115),t.exports=o=function(t){function e(){e.__super__.constructor.apply(this,arguments),this.view.set("fileAttributes",null)}return s(e,t),e.prototype.isInputBinding=!0,e.prototype.nodeChange=function(t){return this.isTwoWay()?t.hasAttribute("multiple")?this.set("filteredValue",Array.prototype.slice.call(t.files)):this.set("filteredValue",t.files[0]||null):void 0},e}(n)},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(122),t.exports=o=function(t){function e(){e.__super__.constructor.apply(this,arguments),this.initializeErrorsList(),this.initializeChildBindings(),Batman.DOM.events.submit(this.node,function(t,e){return Batman.DOM.preventDefault(e)})}return s(e,t),e.prototype.bindingName="formfor",e.prototype.errorClass="error",e.prototype.defaultErrorsListSelector="div.errors",e.prototype.initializeChildBindings=function(){var t,e,r,n,o,i,s,a,u,c,p,l;for(s=this.keyPath,t=this.attributeName,c=["input","textarea","select"].map(function(e){return""+e+'[data-bind^="'+t+'"]'}),u=Batman.DOM.querySelectorAll(this.node,c.join(", ")),e="data-addclass-"+this.errorClass,p=0,l=u.length;l>p;p++)a=u[p],a.getAttribute(e)||(r=a.getAttribute("data-bind"),o=r.substr(r.indexOf(t)+t.length+1),i=o.indexOf("|"),-1!==i&&(o=o.substr(0,i)),o=o.trim(),a.setAttribute(e,""+t+".errors."+o+".length"));n=Batman.DOM.querySelector(this.node,".errors"),n&&!n.getAttribute("data-showif")&&n.setAttribute("data-showif",""+t+".errors.length")},e.prototype.initializeErrorsList=function(){var t,e;return e=this.node.getAttribute("data-errors-list")||this.defaultErrorsListSelector,(t=Batman.DOM.querySelector(this.node,e))?Batman.DOM.setInnerHTML(t,this.errorsListHTML()):void 0},e.prototype.errorsListHTML=function(){return'<ul>\n  <li data-foreach-error="'+this.attributeName+'.errors" data-bind="error.fullMessage"></li>\n</ul>'},e}(n)},function(t,e,r){var n,o,i,s={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(115),o=r(142),t.exports=i=function(t){function e(t){this.invert=t.invert,e.__super__.constructor.apply(this,arguments),this.placeholderNode=document.createComment('batman-insertif="'+this.keyPath+'"')}return a(e,t),e.prototype.onlyObserve=o.Data,e.prototype.bindImmediately=!1,e.prototype.initialized=function(){return this.bind()},e.prototype.dataChange=function(t){var e,r;return r=Batman.View.viewForNode(this.node,!1),e=this.placeholderNode.parentNode||this.node.parentNode,!!t==!this.invert?(null!=r&&r.fireAndCall("viewWillShow"),null==this.node.parentNode&&(e.insertBefore(this.node,this.placeholderNode),e.removeChild(this.placeholderNode)),null!=r?r.fireAndCall("viewDidShow"):void 0):(null!=r&&r.fireAndCall("viewWillHide"),null!=this.node.parentNode&&(e.insertBefore(this.placeholderNode,this.node),e.removeChild(this.node)),null!=r?r.fireAndCall("viewDidHide"):void 0)},e.prototype.die=function(){return this.placeholderNode=null,e.__super__.die.apply(this,arguments)},e}(n)},function(t,e,r){var n,o,i,s,a=function(t,e){return function(){return t.apply(e,arguments)}},u={}.hasOwnProperty,c=function(t,e){function n(){this.constructor=t}for(var r in e)u.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(116),s=r(72),o=r(142),t.exports=i=function(t){function e(t){this.handleItemMoved=a(this.handleItemMoved,this),this.handleItemsRemoved=a(this.handleItemsRemoved,this),this.handleItemsAdded=a(this.handleItemsAdded,this),this.handleArrayChanged=a(this.handleArrayChanged,this),this.iteratorName=t.attr,this.prototypeNode=t.node,this.prototypeNode.removeAttribute("data-foreach-"+this.iteratorName),t.viewOptions={prototypeNode:this.prototypeNode,iteratorName:this.iteratorName,iteratorPath:t.keyPath},t.node=null,e.__super__.constructor.apply(this,arguments),this.backingView.set("attributeName",this.attributeName),this.view.prevent("ready"),this._handle=Batman.setImmediate(function(t){return function(){var e;return t.backingView.isDead?(Batman.developer.warn("IteratorBinding (data-foreach-"+t.iteratorName+"='"+t.keyPath+"') trying to insert dead backing view into DOM ("+t.view.constructor.name+")"),void 0):(e=t.prototypeNode.parentNode,e.insertBefore(t.backingView.get("node"),t.prototypeNode),e.removeChild(t.prototypeNode),t.bind(),t.view.allowAndFire("ready"))}}(this))}return c(e,t),e.prototype.onlyObserve=o.Data,e.prototype.backWithView=s,e.prototype.skipChildren=!0,e.prototype.bindImmediately=!1,e.prototype.handleArrayChanged=function(t){return!this.backingView.isDead&&(this.backingView.destroySubviews(),null!=t?t.length:void 0)?this.handleItemsAdded(t):void 0},e.prototype.handleItemsAdded=function(t,e){return this.backingView.isDead?void 0:this.backingView.addItems(t,e)},e.prototype.handleItemsRemoved=function(t,e){return this.backingView.isDead?void 0:this.collection.length?this.backingView.removeItems(t,e):this.backingView.destroySubviews()},e.prototype.handleItemMoved=function(t,e,r){return this.backingView.isDead?void 0:this.backingView.moveItem(r,e)},e.prototype.die=function(){return this._handle&&Batman.clearImmediate(this._handle),this.prototypeNode=null,e.__super__.die.apply(this,arguments)},e}(n)},function(t,e,r){var n,o,i,s={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(114),i=r(80),t.exports=o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.dataChange=function(t){return null==t&&(t=""),this.node[this.attributeName]=t},e.prototype.nodeChange=function(t){return this.isTwoWay()?this.set("filteredValue",i._parseAttribute(t[this.attributeName])):void 0},e}(n)},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(115),t.exports=o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.accessor("parsedNodeValue",function(){return Batman.DOM.attrReaders._parseAttribute(this.node.value)}),e.prototype.firstBind=!0,e.prototype.dataChange=function(){var e;return e=this.get("filteredValue"),null!=e?this.node.checked=e===Batman.DOM.attrReaders._parseAttribute(this.node.value):this.firstBind&&this.node.checked&&this.set("filteredValue",this.get("parsedNodeValue")),this.firstBind=!1},e.prototype.nodeChange=function(){return this.isTwoWay()?this.set("filteredValue",this.get("parsedNodeValue")):void 0},e}(n)},function(t,e,r){var n,o,i,s=function(t,e){return function(){return t.apply(e,arguments)}},a={}.hasOwnProperty,u=function(t,e){function n(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(115),o=r(142),t.exports=i=function(t){function e(){this.routeClick=s(this.routeClick,this);var t,r;e.__super__.constructor.apply(this,arguments),(r=this.node.getAttribute("data-route-params"))&&(t=new Batman.DOM.ReaderBindingDefinition(this.node,r,this.view),this.set("queryParams",new Batman.DOM.RouteParamsBinding(t,this)))}return u(e,t),e.prototype.onAnchorTag=!1,e.prototype.onlyObserve=o.Data,e.accessor("dispatcher",function(){return this.view.lookupKeypath("dispatcher")||Batman.App.get("current.dispatcher")}),e.prototype.bind=function(){var t;return("a"===(t=this.node.nodeName)||"A"===t)&&(this.onAnchorTag=!0),e.__super__.bind.apply(this,arguments),this.onAnchorTag&&this.node.getAttribute("target")?void 0:Batman.DOM.events.primaryInteractionEvent(this.node,this.routeClick)},e.prototype.routeClick=function(t,e){var r;if(!e.__batmanActionTaken)return e.__batmanActionTaken=!0,r=this.generatePath(this.get("filteredValue"),this.get("queryParams.filteredValue")),null!=r?Batman.redirect(r):void 0},e.prototype.dataChange=function(t,e,r){var n;return t&&(n=this.generatePath(t,r||this.get("queryParams.filteredValue"))),this.onAnchorTag?(n=n&&Batman.navigator?Batman.navigator.linkTo(n):"#",this.node.href=n):void 0},e.prototype.generatePath=function(t,e){var r,n,o;return r=(null!=t?t.isNamedRouteQuery:void 0)?t.get("path"):null!=(o=this.get("dispatcher"))?o.pathFromParams(t):void 0,e&&r?("Object"===Batman.typeOf(e)?null!=e.toObject&&(e=e.toObject()):e=Batman.URI.paramsFromQuery(e),n=new Batman.URI(r),n.queryParams=e,""+n):r},e}(n)},function(t,e,r){var n,o,i,s={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(115),o=r(142),t.exports=i=function(t){function e(t,r){this.routeBinding=r,e.__super__.constructor.call(this,t)}return a(e,t),e.prototype.onlyObserve=o.Data,e.prototype.dataChange=function(t){return this.routeBinding.dataChange(this.routeBinding.get("filteredValue"),this.node,t)},e}(n)},function(t,e,r){var n,o,i,s=function(t,e){return function(){return t.apply(e,arguments)}},a={}.hasOwnProperty,u=function(t,e){function n(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(115),i=r(70),t.exports=o=function(t){function e(){this.updateOptionBindings=s(this.updateOptionBindings,this),this.nodeChange=s(this.nodeChange,this),this.dataChange=s(this.dataChange,this),this.childBindingAdded=s(this.childBindingAdded,this),e.__super__.constructor.apply(this,arguments),this.node.removeAttribute("data-bind"),this.node.removeAttribute("data-source"),this.node.removeAttribute("data-target"),this.backingView.on("childBindingAdded",this.childBindingAdded),this.backingView.initializeBindings()}return u(e,t),e.prototype.backWithView=i,e.prototype.isInputBinding=!0,e.prototype.canSetImplicitly=!0,e.prototype.skipChildren=!0,e.prototype.die=function(){return this.backingView.off("childBindingAdded",this.childBindingAdded),e.__super__.die.apply(this,arguments)},e.prototype.childBindingAdded=function(t){if(t instanceof Batman.DOM.CheckedBinding)t.on("dataChange",this.nodeChange);else{if(!(t instanceof Batman.DOM.IteratorBinding))return;t.backingView.on("itemsWereRendered",function(t){return function(){return t._fireDataChange(t.get("filteredValue"))}}(this))}return this._fireDataChange(this.get("filteredValue"))},e.prototype.lastKeyContext=null,e.prototype.dataChange=function(t){var e,r,n,o,i,s,a;if(this.lastKeyContext||(this.lastKeyContext=this.get("keyContext")),this.lastKeyContext!==this.get("keyContext")&&(this.canSetImplicitly=!0,this.lastKeyContext=this.get("keyContext")),null!=t?t.forEach:void 0){for(n={},a=this.node.children,o=0,i=a.length;i>o;o++)e=a[o],e.selected=!1,r=n[s=e.value]||(n[s]=[]),r.push(e);t.forEach(function(){return function(t){var e,r,o,i;if(e=n[t])for(o=0,i=e.length;i>o;o++)r=e[o],r.selected=!0}}(this))}else null==t&&this.canSetImplicitly?this.node.value&&(this.canSetImplicitly=!1,this.set("unfilteredValue",this.node.value)):(this.canSetImplicitly=!1,Batman.DOM.valueForNode(this.node,t,this.escapeValue));this.updateOptionBindings(),this.fixSelectElementWidth()},e.prototype.nodeChange=function(){var t;this.isTwoWay()&&(t=Batman.DOM.valueForNode(this.node),typeof t===Array&&1===t.length&&(t=t[0]),this.set("unfilteredValue",t),this.updateOptionBindings())},e.prototype.updateOptionBindings=function(){var t,e,r,n;for(n=this.backingView.bindings,e=0,r=n.length;r>e;e++)t=n[e],t instanceof Batman.DOM.CheckedBinding&&t._fireNodeChange()},e.prototype.fixSelectElementWidth=function(){return-1!==window.navigator.userAgent.toLowerCase().indexOf("msie")?(this._fixWidthTimeout&&clearTimeout(this._fixWidthTimeout),this._fixWidthTimeout=setTimeout(function(t){return function(){return t._fixWidthTimeout=null,t._fixSelectElementWidth()}}(this),100)):void 0},e.prototype._fixSelectElementWidth=function(){var t,e,r;return(e=null!=(r=this.get("node"))?r.style:void 0)?(t=this.get("node").currentStyle.width,e.width="100%",e.width=null!=t?t:""):void 0},e}(n)},function(t,e,r){var n,o,i,s={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(115),o=r(142),t.exports=i=function(t){function e(t){var r;r=t.node.style.display,r&&"none"!==r||(r=""),this.originalDisplay=r,this.invert=t.invert,e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.onlyObserve=o.Data,e.prototype.dataChange=function(t){var e;return e=Batman.View.viewForNode(this.node,!1),(null!=t?t.isProxy:void 0)&&(t=t.get("target")),!!t==!this.invert?(null!=e&&e.fireAndCall("viewWillShow"),this.node.style.display=this.originalDisplay,null!=e?e.fireAndCall("viewDidShow"):void 0):(null!=e&&e.fireAndCall("viewWillHide"),Batman.DOM.setStyleProperty(this.node,"display","none","important"),null!=e?e.fireAndCall("viewDidHide"):void 0)},e}(n)},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(130),t.exports=o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype.dataChange=function(t){return this.node.style[Batman.Filters.camelize(this.attributeName,!0)]=t},e}(n)},function(t,e,r){var n,o,i,s,a=function(t,e){return function(){return t.apply(e,arguments)}},u={}.hasOwnProperty,c=function(t,e){function n(){this.constructor=t}for(var r in e)u.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},p=[].slice;o=r(116),n=r(114),i=r(142),t.exports=s=function(t){function e(){this.setStyle=a(this.setStyle,this),this.handleArrayChanged=a(this.handleArrayChanged,this),this.oldStyles={},this.styleBindings={},e.__super__.constructor.apply(this,arguments)}return c(e,t),e.prototype.onlyObserve=i.Data,e.prototype.dataChange=function(t){var e,r,n,o,i,s,a,c;if(!t)return this.resetStyles(),void 0;if(this.unbindCollection(),"string"!=typeof t)if(t instanceof Batman.Hash)this.bindCollection(t);else{t instanceof Batman.Object&&(t=t.toJSON()),this.resetStyles();for(n in t)u.call(t,n)&&this.bindSingleAttribute(n,""+this.keyPath+"."+n)}else for(this.resetStyles(),a=t.split(";"),i=0,s=a.length;s>i;i++)o=a[i],c=o.split(":"),r=c[0],e=c.length>=2?p.call(c,1):[],this.setStyle(r,e.join(":"))},e.prototype.handleArrayChanged=function(){return this.collection.forEach(function(t){return function(e){return t.bindSingleAttribute(e,""+t.keyPath+"."+e)}}(this))},e.prototype.bindSingleAttribute=function(t,e){var r;return r=new Batman.DOM.AttrReaderBindingDefinition(this.node,t,e,this.view),this.styleBindings[t]=new Batman.DOM.StyleBinding.SingleStyleBinding(r,this)},e.prototype.setStyle=function(t,e){return t=Batman.helpers.camelize(t.trim(),!0),""===t?!1:(null==this.oldStyles[t]&&(this.oldStyles[t]=this.node.style[t]||""),(null!=e?e.trim:void 0)&&(e=e.trim()),null==e&&(e=""),this.node.style[t]=e)},e.prototype.resetStyles=function(){var t,e,r;r=this.oldStyles;for(t in r)u.call(r,t)&&(e=r[t],this.setStyle(t,e))},e.prototype.resetBindings=function(){var t,e,r;r=this.styleBindings;for(t in r)e=r[t],e._fireDataChange(""),e.die();return this.styleBindings={}},e.prototype.unbindCollection=function(){return this.resetBindings(),e.__super__.unbindCollection.apply(this,arguments)},e.SingleStyleBinding=function(t){function e(t,r){this.parent=r,e.__super__.constructor.call(this,t)}return c(e,t),e.prototype.onlyObserve=i.Data,e.prototype.isTwoWay=function(){return!1},e.prototype.dataChange=function(t){return this.parent.setStyle(this.attributeName,t)},e}(n),e}(o)},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(115),t.exports=o=function(t){function e(t){var r;this.isInputBinding="input"===(r=t.node.nodeName.toLowerCase())||"textarea"===r,e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype.nodeChange=function(){return this.isTwoWay()?this.set("filteredValue",this.node.value):void 0},e.prototype.dataChange=function(t){return Batman.DOM.valueForNode(this.node,t,this.escapeValue)},e}(n)},function(t,e,r){var n,o,i,s={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(115),o=r(142),t.exports=i=function(t){function e(t,r,n){this.option=r,this.targetView=n,e.__super__.constructor.call(this,t),this.targetView.observe(this.option,this._updateValue=function(t){return function(e){return t.isDataChanging?void 0:t.view.setKeypath(t.keyPath,e)}}(this))}return a(e,t),e.prototype.onlyObserve=o.Data,e.prototype.dataChange=function(t){return this.isDataChanging=!0,this.targetView.set(this.option,t),this.isDataChanging=!1},e.prototype.die=function(){return this.targetView.forget(this.option,this._updateValue),this.targetView=null,e.__super__.die.apply(this,arguments)},e}(n)},function(t,e,r){var n,o,i,s,a={}.hasOwnProperty,u=function(t,e){function n(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(115),o=r(142),i=r(139),t.exports=s=function(t){function e(t){this.superview=t.view,e.__super__.constructor.apply(this,arguments)}return u(e,t),e.prototype.onlyObserve=o.Data,e.prototype.skipChildren=!0,e.prototype.bindImmediately=!1,e.prototype.initialized=function(){return this.bind()},e.prototype.dataChange=function(t){var e,r,n,o,s,a,u,c;if(null!=(c=this.viewInstance)&&c.removeFromSuperview(),t){if(t.isView?(this.fromViewClass=!1,this.viewInstance=t,this.viewInstance.removeFromSuperview()):(this.fromViewClass=!0,this.viewInstance=new t),this.node.removeAttribute("data-view"),s=this.viewInstance.constructor._batman.get("options"))for(a=0,u=s.length;u>a;a++)o=s[a],e="data-view-"+o.toLowerCase(),(n=this.node.getAttribute(e))&&(this.node.removeAttribute(e),r=new Batman.DOM.ReaderBindingDefinition(this.node,n,this.superview),new i(r,o,this.viewInstance));return this.viewInstance.set("parentNode",this.node),this.viewInstance.set("node",this.node),this.viewInstance.loadView(this.node),this.superview.subviews.add(this.viewInstance)}},e.prototype.die=function(){return this.fromViewClass?this.viewInstance.die():this.viewInstance.removeFromSuperview(),this.superview=null,this.viewInstance=null,e.__super__.die.apply(this,arguments)},e}(n)},function(t,e,r){var n,o,i,s={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(114),o=r(142),t.exports=i=function(t){function e(){e.__super__.constructor.apply(this,arguments),Batman.Tracking.trackEvent("view",this.get("filteredValue"),this.node)}return a(e,t),e.prototype.onlyObserve=o.None,e}(n)},function(t){var n;t.exports=n={Data:"data",Node:"node",All:"all",None:"none"}},function(t,e,r){var n,o;n=r(89).extend,t.exports=o=function(){function t(t){this.object=t}return t.initialize=function(e){return null!=e._batman?e._batman.check(e):e._batman=new t(e)},t.prototype.check=function(e){return e!==this.object?(e._batman=new t(e),!1):!0},t.prototype.get=function(t){var e,r;switch(r=this.getAll(t),r.length){case 0:return void 0;case 1:return r[0];default:return e=null!=r[0].concat?function(t,e){return t.concat(e)}:null!=r[0].merge?function(t,e){return t.merge(e)}:r.every(function(t){return"object"==typeof t})?(r.unshift({}),function(t,e){return n(t,e)}):void 0,e?r.reduceRight(e):r}},t.prototype.getFirst=function(t){var e;return e=this.getAll(t),e[0]},t.prototype.getAll=function(t){var e,r,n;return e="function"==typeof t?t:function(e){var r;return null!=(r=e._batman)?r[t]:void 0},r=this.ancestors(e),(n=e(this.object))&&r.unshift(n),r},t.prototype.ancestors=function(t){var e,r,n,o,i,s;if(this._allAncestors||(this._allAncestors=this.allAncestors()),t){for(r=[],s=this._allAncestors,o=0,i=s.length;i>o;o++)e=s[o],n=t(e),null!=n&&r.push(n);return r}return this._allAncestors},t.prototype.allAncestors=function(){var t,e,r,n,o,i;return n=[],t=!!this.object.prototype,e=t?null!=(o=this.object.__super__)?o.constructor:void 0:(r=Object.getPrototypeOf(this.object))===this.object?this.object.constructor.__super__:r,null!=e&&(null!=(i=e._batman)&&i.check(e),n.push(e),null!=e._batman&&(n=n.concat(e._batman.allAncestors()))),n},t.prototype.set=function(t,e){return this[t]=e},t}()},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(92),t.exports=o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype.eachHandler=function(t){return this.eachObserver(t)},e.prototype.handlerContext=function(){return this.base},e}(n)},function(t,e,r){var n,o,i,s=function(t,e){return function(){return t.apply(e,arguments)}},a={}.hasOwnProperty,u=function(t,e){function n(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c=[].slice;o=r(104),i=r(105),t.exports=n=function(t){function e(t,r){this.left=t,this.right=r,this._setup=s(this._setup,this),e.__super__.constructor.call(this),this._setup(this.left,this.right),this._setup(this.right,this.left)}return u(e,t),e.prototype._setup=function(t,e){return t.on("itemsWereAdded",function(r){return function(n){return r._itemsWereAddedToSource.apply(r,[t,e].concat(c.call(n)))}}(this)),t.on("itemsWereRemoved",function(r){return function(n){return r._itemsWereRemovedFromSource.apply(r,[t,e].concat(c.call(n)))}}(this)),this._itemsWereAddedToSource.apply(this,[t,e].concat(c.call(t.toArray())))},e.prototype.merge=function(){var t,e,r,n,i;for(e=arguments.length>=1?c.call(arguments,0):[],t=new o,e.unshift(this),n=0,i=e.length;i>n;n++)r=e[n],r.forEach(function(e){return t.add(e)});return t},e.prototype.filter=i.prototype.filter,e}(o)},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=r(156),t.exports=n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype.optionKeys=["member","collection","callback","app"],e.prototype.controller=!1,e.prototype.action=!1,e}(o)},function(t,e,r){var n,o,i=function(t,e){return function(){return t.apply(e,arguments)}},s={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=r(156),t.exports=n=function(t){function e(t,r){this.callback=i(this.callback,this);var n,o,s,a;r.signature&&("String"===Batman.typeOf(r.signature)?(s=r.signature.split("#"),o=s[0],n=s[1]):(a=r.signature,o=a.controller,n=a.action),n||(n="index"),r.controller=o,r.action=n,delete r.signature),e.__super__.constructor.call(this,t,r)}return a(e,t),e.prototype.optionKeys=["member","collection","app","controller","action"],e.prototype.callback=function(t){var e,r;if(r=this.get("controller"),e=this.get("app.dispatcher.controllers."+r),null==e)throw Error("Couldn't find "+Batman.helpers.titleize(r)+"Controller when dispatching "+r+"#"+this.get("action")+"!");return e.dispatch(this.get("action"),t)},e}(o)},function(t,e,r){var n,o,i,s,a={}.hasOwnProperty,u=function(t,e){function n(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};s=r(1),n=s.BatmanObject,i=s.Property,t.exports=o=function(t){function r(t,e){r.__super__.constructor.call(this,{app:t,routeMap:e})}var e;return u(r,t),r.canInferRoute=function(t){return t instanceof Batman.Model||t instanceof Batman.AssociationProxy||t.prototype instanceof Batman.Model},r.paramsFromArgument=function(t){var e;return e=function(t){return Batman.helpers.camelize(Batman.helpers.pluralize(t.get("resourceName")),!0)},this.canInferRoute(t)?t instanceof Batman.Model||t instanceof Batman.AssociationProxy?(t.isProxy&&(t=t.get("target")),null!=t?{controller:e(t.constructor),action:"show",id:("function"==typeof t.toParam?t.toParam():void 0)||t.get("id")}:{}):t.prototype instanceof Batman.Model?{controller:e(t),action:"index"}:t:t},e=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.accessor("__app",i.defaultAccessor),e.accessor(function(t){return this.get("__app."+Batman.helpers.titleize(t)+"Controller.sharedController")}),e}(n),r.accessor("controllers",function(){return new e({__app:this.get("app")})}),r.prototype.routeForParams=function(t){return t=this.constructor.paramsFromArgument(t),this.get("routeMap").routeForParams(t)},r.prototype.pathFromParams=function(t){var e;return"string"==typeof t?t:(t=this.constructor.paramsFromArgument(t),null!=(e=this.routeForParams(t))?e.pathFromParams(t):void 0)},r.prototype.dispatch=function(t,e){var r,n,o,i,s,a;if(n=this.constructor.paramsFromArgument(t),i=this.routeForParams(n))s=i.pathAndParamsFromArgument(n),o=s[0],t=s[1],e&&Batman.mixin(t,e),this.set("app.currentRoute",i),this.set("app.currentURL",o),this.get("app.currentParams").replace(t||{}),i.dispatch(t);else{if("Object"===Batman.typeOf(t)&&!this.constructor.canInferRoute(t))return this.get("app.currentParams").replace(t);if(this.get("app.currentParams").clear(),r={type:"404",isPrevented:!1,preventDefault:function(){return this.isPrevented=!0}},null!=(a=Batman.currentApp)&&a.fire("error",r),r.isPrevented)return t;if("/404"!==t)return Batman.redirect("/404")}return o},r}(n)},function(t,e,r){var n,o,i=function(t,e){return function(){return t.apply(e,arguments)}},s={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=r(151),t.exports=n=function(t){function e(){return this.detectHashChange=i(this.detectHashChange,this),this.handleHashChange=i(this.handleHashChange,this),e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.hashPrefix="#!","undefined"!=typeof window&&null!==window&&"onhashchange"in window?(e.prototype.startWatching=function(){return Batman.DOM.addEventListener(window,"hashchange",this.handleHashChange)},e.prototype.stopWatching=function(){return Batman.DOM.removeEventListener(window,"hashchange",this.handleHashChange)}):(e.prototype.startWatching=function(){return this.interval=setInterval(this.detectHashChange,100)},e.prototype.stopWatching=function(){return this.interval=clearInterval(this.interval)
}),e.prototype.handleHashChange=function(){return this.ignoreHashChange?this.ignoreHashChange=!1:this.handleCurrentLocation()},e.prototype.detectHashChange=function(){return this.previousHash!==window.location.hash?(this.previousHash=window.location.hash,this.handleHashChange()):void 0},e.prototype.pushState=function(t,e,r){var n;return n=this.linkTo(r),n!==window.location.hash?(this.ignoreHashChange=!0,window.location.hash=n):void 0},e.prototype.replaceState=function(t,e,r,n){var o;return null==n&&(n=window.location),o=this.linkTo(r),o!==n.hash?(this.ignoreHashChange=!0,n.replace(""+(n.pathname||"")+(n.search||"")+(o||""))):void 0},e.prototype.linkTo=function(t){return this.hashPrefix+t},e.prototype.pathFromLocation=function(t){var e,r;return e=t.hash,r=this.hashPrefix.length,(null!=e?e.substr(0,r):void 0)===this.hashPrefix?this.normalizePath(e.substr(r)):"/"},e.prototype.handleLocation=function(t){var r;return Batman.config.usePushState?(r=Batman.PushStateNavigator.prototype.pathFromLocation(t),"/"!==r?t.replace(this.normalizePath(""+Batman.config.pathToApp+this.linkTo(r)+(this.initialHash?"##BATMAN##"+this.initialHash:""))):e.__super__.handleLocation.apply(this,arguments)):e.__super__.handleLocation.apply(this,arguments)},e}(o)},function(t,e,r){var n,o,i,s,a={}.hasOwnProperty,u=function(t,e){function n(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};s=r(1),n=s.BatmanObject,i=s.Property,t.exports=o=function(t){function e(t,r){var n;null==r&&(r=[]),e.__super__.constructor.call(this,{routeMap:t,args:r});for(n in this.get("routeMap").childrenByName)this[n]=this._queryAccess.bind(this,n)}return u(e,t),e.prototype.isNamedRouteQuery=!0,e.accessor("route",function(){var t,e,r,n,o,i,s;for(i=this.get("routeMap"),e=i.memberRoute,t=i.collectionRoute,s=[e,t],n=0,o=s.length;o>n;n++)if(r=s[n],null!=r&&r.namedArguments.length===this.get("args").length)return r;return t||e}),e.accessor("path",function(){return this.path()}),e.accessor("routeMap","args","cardinality","hashValue",i.defaultAccessor),e.accessor({get:function(t){return null!=t?"string"==typeof t?this.nextQueryForName(t):this.nextQueryWithArgument(t):void 0},cache:!1}),e.accessor("withHash",function(){return new Batman.Accessible(function(t){return function(e){return t.withHash(e)}}(this))}),e.prototype.withHash=function(t){var e;return e=this.clone(),e.set("hashValue",t),e},e.prototype.nextQueryForName=function(t){var r;return(r=this.get("routeMap").childrenByName[t])?new e(r,this.args):Batman.developer.error("Couldn't find a route for the name "+t+"!")},e.prototype.nextQueryWithArgument=function(t){var e;return e=this.args.slice(0),e.push(t),this.clone(e)},e.prototype.path=function(){var t,e,r,n,o,i,s;for(o={},n=this.get("route.namedArguments"),r=i=0,s=n.length;s>i;r=++i)t=n[r],null!=(e=this.get("args")[r])&&(o[t]=this._toParam(e));return null!=this.get("hashValue")&&(o["#"]=this.get("hashValue")),this.get("route").pathFromParams(o)},e.prototype.toString=function(){return this.path()},e.prototype.clone=function(t){return null==t&&(t=this.args),new e(this.routeMap,t)},e.prototype._toParam=function(t){return t instanceof Batman.AssociationProxy&&(t=t.get("target")),null!=(null!=t?t.toParam:void 0)?t.toParam():t},e.prototype._queryAccess=function(t,e){var r;return r=this.nextQueryForName(t),null!=e&&(r=r.nextQueryWithArgument(e)),r},e}(n)},function(t){var n,o=function(t,e){return function(){return t.apply(e,arguments)}},i=[].slice;t.exports=n=function(){function t(t){this.app=t,this.handleCurrentLocation=o(this.handleCurrentLocation,this)}return t.forApp=function(t){return new(this.defaultClass())(t)},t.defaultClass=function(){return Batman.config.usePushState&&Batman.PushStateNavigator.isSupported()?Batman.PushStateNavigator:Batman.HashbangNavigator},t.prototype.start=function(){return"undefined"==typeof window||this.started?void 0:(this.started=!0,this.startWatching(),Batman.currentApp.prevent("ready"),Batman.setImmediate(function(t){return function(){return t.started&&Batman.currentApp?(t.checkInitialHash(),t.handleCurrentLocation(),Batman.currentApp.allowAndFire("ready")):void 0}}(this)))},t.prototype.stop=function(){return this.stopWatching(),this.started=!1},t.prototype.checkInitialHash=function(t){var e,r,n;return null==t&&(t=window.location),n=Batman.HashbangNavigator.prototype.hashPrefix,e=t.hash,e.length>n.length&&e.substr(0,n.length)!==n?this.initialHash=e.substr(n.length-1):-1!==(r=e.indexOf("##BATMAN##"))?(this.initialHash=e.substr(r+10),this.replaceState(null,"",e.substr(n.length,r-n.length),t)):void 0},t.prototype.handleCurrentLocation=function(){return this.handleLocation(window.location)},t.prototype.handleLocation=function(t){var e;return e=this.pathFromLocation(t),e!==this.cachedPath?this.dispatch(e):void 0},t.prototype.dispatch=function(t){var e,r;return e=this.app.get("dispatcher"),this.cachedPath=this.initialHash?(r={initialHash:this.initialHash},delete this.initialHash,e.dispatch(t,r)):e.dispatch(t),this.cachedPath},t.prototype.redirect=function(t,e){var r,n,o;return null==e&&(e=!1),n="function"==typeof(o=this.app.get("dispatcher")).pathFromParams?o.pathFromParams(t):void 0,n&&(this._lastRedirect=n),r=this.dispatch(t),this._lastRedirect&&(this.cachedPath=this._lastRedirect),this._lastRedirect&&this._lastRedirect!==r||this[e?"replaceState":"pushState"](null,"",r),r},t.prototype.push=function(t){return Batman.developer.deprecated("Navigator::push","Please use Batman.redirect({}) instead."),this.redirect(t)},t.prototype.replace=function(t){return Batman.developer.deprecated("Navigator::replace","Please use Batman.redirect({}, true) instead."),this.redirect(t,!0)},t.prototype.normalizePath=function(){var t,e,r;return r=arguments.length>=1?i.call(arguments,0):[],r=function(){var n,o,i;for(i=[],t=n=0,o=r.length;o>n;t=++n)e=r[t],i.push((""+e).replace(/^(?!\/)/,"/").replace(/\/+$/,""));return i}(),r.join("")||"/"},t.normalizePath=t.prototype.normalizePath,t}()},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(1).Hash,t.exports=o=function(t){function e(t,r){this.hash=t,this.navigator=r,e.__super__.constructor.call(this,this.hash),this.url=new Batman.UrlParams({},this.navigator,this)}return s(e,t),e.accessor("url",function(){return this.url}),e}(n)},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=r(154),t.exports=n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype.redirect=function(){return this.navigator.redirect(this.toObject())},e}(o)},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(1).BatmanObject,t.exports=o=function(t){function e(t,e){this.navigator=t,this.params=e}return s(e,t),e.prototype.redirect=function(){return this.navigator.redirect(this.toObject(),!0)},e.prototype.replace=function(t){return this.params.replace(t),this.redirect()},e.prototype.update=function(t){return this.params.update(t),this.redirect()},e.prototype.clear=function(){return this.params.clear(),this.redirect()},e.prototype.toObject=function(){return this.params.toObject()},e.accessor({get:function(t){return this.params.get(t)},set:function(t,e){var r,n;return r=this.params.get(t),n=this.params.set(t,e),r!==e&&this.redirect(),n},unset:function(t){var e,r;return e=this.params.hasKey(t),r=this.params.unset(t),e&&this.redirect(),r}}),e}(n)},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(151),t.exports=o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.isSupported=function(){var t;return null!=("undefined"!=typeof window&&null!==window?null!=(t=window.history)?t.pushState:void 0:void 0)},e.prototype.startWatching=function(){return Batman.DOM.addEventListener(window,"popstate",this.handleCurrentLocation)},e.prototype.stopWatching=function(){return Batman.DOM.removeEventListener(window,"popstate",this.handleCurrentLocation)},e.prototype.pushState=function(t,e,r){return r!==this.pathFromLocation(window.location)?window.history.pushState(t,e,this.linkTo(r)):void 0},e.prototype.replaceState=function(t,e,r){return r!==this.pathFromLocation(window.location)?window.history.replaceState(t,e,this.linkTo(r)):void 0},e.prototype.linkTo=function(t){return this.normalizePath(Batman.config.pathToApp,t)},e.prototype.pathFromLocation=function(t){var e,r;return e=""+(t.pathname||"")+(t.search||""),r=RegExp("^"+this.normalizePath(Batman.config.pathToApp)),this.normalizePath(e.replace(r,""))},e.prototype.handleLocation=function(t){var r,n;return n=this.pathFromLocation(t),r=Batman.HashbangNavigator.prototype.pathFromLocation(t),"/"===n&&"/"!==r?this.redirect(r,!0):e.__super__.handleLocation.apply(this,arguments)},e}(n)},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(1).BatmanObject,t.exports=o=function(t){function e(t,r){var n,o,i,s,a,u,c,p,l,h;for(c=this.constructor.regexps,0!==t.indexOf("/")&&(t="/"+t),s=t.replace(c.escapeRegExp,"\\$&"),u=RegExp("^"+s.replace(c.openOptParam,"(?:").replace(c.closeOptParam,")?").replace(c.namedParam,"([^/]+)").replace(c.splatParam,"(.*?)")+c.queryParam+"$"),c.namedOrSplat.lastIndex=0,i=function(){var t;for(t=[];o=c.namedOrSplat.exec(s);)t.push(o[1]);return t}(),a={templatePath:t,pattern:s,regexp:u,namedArguments:i,baseParams:r},h=this.optionKeys,p=0,l=h.length;l>p;p++)n=h[p],a[n]=r[n],delete r[n];e.__super__.constructor.call(this,a)}return s(e,t),e.regexps={namedParam:/:([\w\d]+)/g,splatParam:/\*([\w\d]+)/g,queryParam:"(?:\\?.+)?",namedOrSplat:/[:|\*]([\w\d]+)/g,namePrefix:"[:|*]",escapeRegExp:/[-[\]{}+?.,\\^$|#\s]/g,openOptParam:/\(/g,closeOptParam:/\)/g},e.prototype.optionKeys=["member","collection"],e.prototype.testKeys=["controller","action"],e.prototype.isRoute=!0,e.prototype.paramsFromPath=function(t){var e,r,n,o,i,s,a,u,c;for(a=new Batman.URI(t),i=this.get("namedArguments"),s=Batman.extend({path:a.path},this.get("baseParams")),n=this.get("regexp").exec(a.path).slice(1),e=u=0,c=n.length;c>u;e=++u)r=n[e],o=i[e],null!=r&&(s[o]=decodeURIComponent(r));return Batman.extend(s,a.queryParams)},e.prototype.pathFromParams=function(t){var e,r,n,o,i,s,a,u,c,p,l,h,f,d,y;for(i=Batman.extend({},t),s=this.get("templatePath"),c=this.constructor.regexps,d=this.get("namedArguments"),p=0,h=d.length;h>p;p++)n=d[p],u=RegExp(""+c.namePrefix+n),o=s.replace(u,null!=i[n]?i[n]:""),o!==s&&(delete i[n],s=o);for(s=s.replace(c.openOptParam,"").replace(c.closeOptParam,"").replace(/([^\/])\/+$/,"$1"),y=this.testKeys,l=0,f=y.length;f>l;l++)r=y[l],delete i[r];return i["#"]&&(e=i["#"],delete i["#"]),a=Batman.URI.queryFromParams(i),a&&(s+="?"+a),e&&(s+="#"+e),s},e.prototype.test=function(t){var e,r,n,o,i,s;if("string"==typeof t)r=t;else if(null!=t.path)r=t.path;else for(r=this.pathFromParams(t),s=this.testKeys,o=0,i=s.length;i>o;o++)if(e=s[o],null!=(n=this.get(e))&&t[e]!==n)return!1;return this.get("regexp").test(r)},e.prototype.pathAndParamsFromArgument=function(t){var e,r;return"string"==typeof t?(e=this.paramsFromPath(t),r=t):(e=t,r=this.pathFromParams(t)),[r,e]},e.prototype.dispatch=function(t){return this.test(t)?this.get("callback")(t):!1},e.prototype.callback=function(){throw new Batman.DevelopmentError("Override callback in a Route subclass")},e}(n)},function(t){var n;t.exports=n=function(){function t(){this.childrenByOrder=[],this.childrenByName={}}return t.prototype.memberRoute=null,t.prototype.collectionRoute=null,t.prototype.routeForParams=function(t){var e,r,n,o,i;if(this._cachedRoutes||(this._cachedRoutes={}),e=this.cacheKey(t),this._cachedRoutes[e])return this._cachedRoutes[e];for(i=this.childrenByOrder,n=0,o=i.length;o>n;n++)if(r=i[n],r.test(t))return this._cachedRoutes[e]=r},t.prototype.addRoute=function(e,r){var n,o;return this.childrenByOrder.push(r),e.length>0&&(o=e.split(".")).length>0?(n=o.shift(),this.childrenByName[n]||(this.childrenByName[n]=new t),this.childrenByName[n].addRoute(o.join("."),r)):r.get("member")?(Batman.developer["do"](function(t){return function(){return t.memberRoute?Batman.developer.error("Member route with name "+e+" already exists!"):void 0}}(this)),this.memberRoute=r):(Batman.developer["do"](function(t){return function(){return t.collectionRoute?Batman.developer.error("Collection route with name "+e+" already exists!"):void 0}}(this)),this.collectionRoute=r),!0},t.prototype.cacheKey=function(t){return"string"==typeof t?t:null!=t.path?t.path:""+t.controller+"#"+t.action},t}()},function(t){var n,o=[].slice;t.exports=n=function(){function t(t,e,r,n){this.app=t,this.routeMap=e,this.parent=r,this.baseOptions=null!=n?n:{},this.parent?(this.rootPath=this.parent._nestingPath(),this.rootName=this.parent._nestingName()):(this.rootPath="",this.rootName="")}return t.BUILDER_FUNCTIONS=["resources","member","collection","route","root"],t.ROUTES={index:{cardinality:"collection",path:function(t){return t},name:function(t){return t}},"new":{cardinality:"collection",path:function(t){return""+t+"/new"},name:function(t){return""+t+".new"}},show:{cardinality:"member",path:function(t){return""+t+"/:id"},name:function(t){return t}},edit:{cardinality:"member",path:function(t){return""+t+"/:id/edit"},name:function(t){return""+t+".edit"}},collection:{cardinality:"collection",path:function(t,e){return""+t+"/"+e},name:function(t,e){return""+t+"."+e}},member:{cardinality:"member",path:function(t,e){return""+t+"/:id/"+e},name:function(t,e){return""+t+"."+e}}},t.prototype.resources=function(){var t,e,r,n,i,s,a,u,c,p,l,h,f,d,y,m,g,v,_,b,w,x,O,B,A,E;if(n=arguments.length>=1?o.call(arguments,0):[],d=function(){var t,e,o;for(o=[],t=0,e=n.length;e>t;t++)r=n[t],"string"==typeof r&&o.push(r);return o}(),"function"==typeof n[n.length-1]&&(s=n.pop()),l="object"==typeof n[n.length-1]?n.pop():{},e={index:!0,"new":!0,show:!0,edit:!0},l.except){for(A=l.except,_=0,x=A.length;x>_;_++)p=A[_],e[p]=!1;delete l.except}else if(l.only){for(p in e)v=e[p],e[p]=!1;for(E=l.only,b=0,O=E.length;O>b;b++)p=E[b],e[p]=!0;delete l.only}for(w=0,B=d.length;B>w;w++){f=d[w],y=Batman.helpers.pluralize(f),u=Batman.helpers.camelize(y,!0),a=this._childBuilder({controller:u}),null!=s&&s.call(a);for(t in e)c=e[t],c&&(g=this.constructor.ROUTES[t],i=g.name(y),h=g.path(y),m=Batman.extend({controller:u,action:t,path:h,as:i},l),a[g.cardinality](t,m))}return!0},t.prototype.member=function(){return this._addRoutesWithCardinality.apply(this,["member"].concat(o.call(arguments)))},t.prototype.collection=function(){return this._addRoutesWithCardinality.apply(this,["collection"].concat(o.call(arguments)))},t.prototype.root=function(t,e){return null==e&&(e={}),this.route("/",t,e)},t.prototype.route=function(t,e,r,n){return n||("function"==typeof r?(n=r,r=void 0):"function"==typeof e&&(n=e,e=void 0)),r?e&&(r.signature=e):(r="string"==typeof e?{signature:e}:e,r||(r={})),n&&(r.callback=n),r.as||(r.as=this._nameFromPath(t)),r.path=t,this._addRoute(r)},t.prototype._addRoutesWithCardinality=function(){var t,e,r,n,i,s,a,u,c,p;for(t=arguments[0],r=arguments.length>=3?o.call(arguments,1,u=arguments.length-1):(u=1,[]),n=arguments[u++],"string"==typeof n&&(r.push(n),n={}),n=Batman.extend({},this.baseOptions,n),n[t]=!0,a=this.constructor.ROUTES[t],i=Batman.helpers.underscore(n.controller),c=0,p=r.length;p>c;c++)e=r[c],s=Batman.extend({action:e},n),null==s.path&&(s.path=a.path(i,e)),null==s.as&&(s.as=a.name(i,e)),this._addRoute(s);return!0},t.prototype._addRoute=function(t){var e,r,n,o;return null==t&&(t={}),n=this.rootPath+t.path,r=this.rootName+Batman.helpers.camelize(t.as,!0),delete t.as,delete t.path,e=t.callback?Batman.CallbackActionRoute:Batman.ControllerActionRoute,t.app=this.app,o=new e(n,t),this.routeMap.addRoute(r,o),""===r?this.routeMap.addRoute("root",o):void 0},t.prototype._nameFromPath=function(t){return t=t.replace(Batman.Route.regexps.namedOrSplat,"").replace(/\/+/g,".").replace(/(^\.)|(\.$)/g,"")},t.prototype._nestingPath=function(){var t,e;return this.parent?(t=":"+Batman.helpers.singularize(this.baseOptions.controller)+"Id",e=Batman.helpers.underscore(this.baseOptions.controller),""+this.parent._nestingPath()+e+"/"+t+"/"):""},t.prototype._nestingName=function(){return this.parent?this.parent._nestingName()+this.baseOptions.controller+".":""},t.prototype._childBuilder=function(e){return null==e&&(e={}),new t(this.app,this.routeMap,this,e)},t}()},function(t,e,r){var n,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=r(1).Hash,t.exports=o=function(t){function e(t,r,n){this.hash=t,this.navigator=r,this.params=n,e.__super__.constructor.call(this,this.hash),this.replace(this._paramsFromUri()),this._updateParams(),this.on("change",function(t){return t._updateUrl(),t._updateParams()})}return s(e,t),e.prototype._updateUrl=function(){return this.navigator.pushState(null,"",this._pathFromParams())},e.prototype._updateParams=function(){return this.params.update(this.toObject())},e.prototype._paramsFromUri=function(){return this._currentUri().queryParams},e.prototype._currentPath=function(){return this.params.get("path")},e.prototype._currentUri=function(){return new Batman.URI(this._currentPath())},e.prototype._pathFromRoutes=function(){var t,e;return e=this.navigator.app.get("currentRoute"),t={controller:e.controller,action:e.action},Batman.mixin(t,this.toObject()),this.navigator.app.get("dispatcher").pathFromParams(t)},e.prototype._pathFromParams=function(){var t,e;return(t=this._pathFromRoutes())?t:(e=this._currentUri(),e.queryParams=this.toObject(),""+e)},e}(n)},function(t){function o(){}var n=t.exports={};n.nextTick=function(){var t="undefined"!=typeof window&&window.setImmediate,e="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(t)return function(t){return window.setImmediate(t)};if(e){var r=[];return window.addEventListener("message",function(t){var e=t.source;if((e===window||null===e)&&"process-tick"===t.data&&(t.stopPropagation(),r.length>0)){var n=r.shift();n()}},!0),function(t){r.push(t),window.postMessage("process-tick","*")}}return function(t){setTimeout(t,0)}}(),n.title="browser",n.browser=!0,n.env={},n.argv=[],n.on=o,n.addListener=o,n.once=o,n.off=o,n.removeListener=o,n.removeAllListeners=o,n.emit=o,n.binding=function(){throw Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(){throw Error("process.chdir is not supported")}}]);